<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¹€ì—„ë§ˆë…ì„œì‹¤ ê²°ì œ ê³„ì‚°ê¸° v2</title>
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ê¹€ì—„ë§ˆë…ì„œì‹¤">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --primary-light: #dbeafe;
            --secondary: #f97316;
            --secondary-light: #ffedd5;
            --success: #10b981;
            --success-light: #d1fae5;
            --danger: #ef4444;
            --danger-light: #fee2e2;
            --warning: #f59e0b;
            --warning-light: #fef3c7;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --floor-7: #8b5cf6;
            --floor-7-light: #ede9fe;
            --floor-8: #0891b2;
            --floor-8-light: #cffafe;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
            --radius: 12px;
            --radius-lg: 16px;
        }

        [data-theme="dark"] {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --primary-light: #1e3a5f;
            --gray-50: #111827;
            --gray-100: #1f2937;
            --gray-200: #374151;
            --gray-300: #4b5563;
            --gray-400: #6b7280;
            --gray-500: #9ca3af;
            --gray-600: #d1d5db;
            --gray-700: #e5e7eb;
            --gray-800: #f3f4f6;
            --gray-900: #f9fafb;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 50%, #f0fdf4 100%);
            min-height: 100vh;
            color: var(--gray-800);
            line-height: 1.6;
            transition: background 0.3s ease, color 0.3s ease;
        }

        [data-theme="dark"] body {
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #0f172a 100%);
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 16px;
            padding-bottom: 100px;
        }

        .header {
            text-align: center;
            padding: 24px 0;
            margin-bottom: 16px;
            position: relative;
        }

        .header h1 {
            font-size: 1.75rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary) 0%, var(--floor-7) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 4px;
        }

        .header .version {
            font-size: 0.875rem;
            color: var(--gray-500);
            font-weight: 500;
        }

        .header-actions {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            width: 40px;
            height: 40px;
            border: none;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-600);
            box-shadow: var(--shadow);
            transition: all 0.2s ease;
        }

        .icon-btn:hover {
            background: var(--gray-100);
            transform: scale(1.05);
        }

        [data-theme="dark"] .icon-btn {
            background: var(--gray-100);
        }

        .nav-tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 16px;
            background: white;
            padding: 4px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
        }

        [data-theme="dark"] .nav-tabs { background: var(--gray-100); }

        .nav-tab {
            flex: 1;
            padding: 12px 8px;
            border: none;
            border-radius: var(--radius);
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            background: transparent;
            color: var(--gray-500);
        }

        .nav-tab.active {
            background: var(--primary);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .nav-tab:not(.active):hover { background: var(--gray-100); }

        .section { display: none; }
        .section.active { display: block; }

        .floor-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            background: white;
            padding: 6px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
        }

        [data-theme="dark"] .floor-tabs { background: var(--gray-100); }

        .floor-tab {
            flex: 1;
            padding: 14px 16px;
            border: none;
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background: var(--gray-100);
            color: var(--gray-600);
        }

        .floor-tab.floor-8.active {
            background: var(--floor-8);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .floor-tab.floor-7.active {
            background: var(--floor-7);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .floor-tab .count {
            background: rgba(255,255,255,0.3);
            padding: 2px 8px;
            border-radius: 20px;
            font-size: 0.75rem;
        }

        .floor-tab:not(.active) .count { background: var(--gray-200); }

        .card {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
            margin-bottom: 16px;
            overflow: hidden;
        }

        [data-theme="dark"] .card { background: var(--gray-100); }

        .card-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-header h2 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--gray-800);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-header .icon { width: 20px; height: 20px; }
        .card-body { padding: 16px 20px; }

        .seat-filter {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }

        .seat-filter-btn {
            padding: 8px 14px;
            border: 1px solid var(--gray-200);
            border-radius: 20px;
            background: white;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--gray-600);
        }

        [data-theme="dark"] .seat-filter-btn {
            background: var(--gray-200);
            border-color: var(--gray-300);
        }

        .seat-filter-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .seat-filter-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .search-box {
            position: relative;
            margin-bottom: 12px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 16px 12px 44px;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius);
            font-size: 0.9375rem;
            outline: none;
            transition: all 0.2s ease;
            background: white;
            color: var(--gray-800);
        }

        [data-theme="dark"] .search-box input {
            background: var(--gray-200);
            border-color: var(--gray-300);
        }

        .search-box input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-light);
        }

        .search-box .search-icon {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            color: var(--gray-400);
        }

        .student-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius);
        }

        .student-item {
            padding: 12px 16px;
            border-bottom: 1px solid var(--gray-100);
            cursor: pointer;
            transition: all 0.15s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .student-item:last-child { border-bottom: none; }
        .student-item:hover { background: var(--gray-50); }
        .student-item.selected { background: var(--primary-light); }

        .student-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .student-name {
            font-weight: 600;
            font-size: 0.9375rem;
            color: var(--gray-800);
        }

        .student-detail {
            font-size: 0.8125rem;
            color: var(--gray-500);
        }

        .student-actions {
            display: flex;
            gap: 4px;
        }

        .student-action-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: var(--gray-100);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-500);
            transition: all 0.2s ease;
        }

        .student-action-btn:hover { background: var(--gray-200); }
        .student-action-btn.edit:hover { background: var(--primary-light); color: var(--primary); }
        .student-action-btn.delete:hover { background: var(--danger-light); color: var(--danger); }

        .seat-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 8px;
        }

        .seat-badge.ììœ ì„ { background: #fef3c7; color: #92400e; }
        .seat-badge.ì˜¤í”ˆí˜• { background: #dbeafe; color: #1e40af; }
        .seat-badge.ì¹¸ë§‰ì´ { background: #d1fae5; color: #065f46; }
        .seat-badge.í”„ë¦¬ë¯¸ì—„ { background: #fce7f3; color: #9d174d; }
        .seat-badge.ì§€ì •ì„_ì—¬ { background: #dbeafe; color: #1e40af; }
        .seat-badge.ì§€ì •ì„_ë‚¨ { background: #dbeafe; color: #1e40af; }
        .seat-badge.ì§€ì •ì„ { background: #dbeafe; color: #1e40af; }

        .selected-student-card {
            background: linear-gradient(135deg, var(--primary-light) 0%, #eff6ff 100%);
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 16px;
            border: 1px solid var(--primary);
        }

        [data-theme="dark"] .selected-student-card {
            background: linear-gradient(135deg, var(--primary-light) 0%, #1e3a5f 100%);
        }

        .selected-student-card .name {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .selected-student-card .details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            font-size: 0.875rem;
            color: var(--gray-600);
        }

        .period-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .period-btn {
            padding: 12px 8px;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius);
            background: white;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            color: var(--gray-700);
        }

        [data-theme="dark"] .period-btn {
            background: var(--gray-200);
            border-color: var(--gray-300);
        }

        .period-btn:hover {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .period-btn.selected {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .period-btn .weeks {
            display: block;
            font-size: 0.75rem;
            color: var(--gray-500);
            margin-top: 2px;
        }

        .period-btn.selected .weeks { color: rgba(255,255,255,0.8); }

        /* ì˜µì…˜ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .options-section {
            background: var(--gray-50);
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 16px;
        }

        [data-theme="dark"] .options-section { background: var(--gray-200); }

        .options-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .option-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            border: 1px solid var(--gray-200);
            transition: all 0.2s;
        }

        [data-theme="dark"] .option-item { background: var(--gray-100); }

        .option-item:hover { border-color: var(--primary); }

        .option-item.active {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .option-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--primary);
            cursor: pointer;
        }

        .option-item .option-label {
            flex: 1;
            font-size: 0.9375rem;
            color: var(--gray-700);
        }

        .option-item .option-value {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--primary);
        }

        .discount-btn-group {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .discount-btn {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            background: white;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            text-align: center;
            color: var(--gray-600);
            transition: all 0.2s;
        }

        [data-theme="dark"] .discount-btn { background: var(--gray-100); }

        .discount-btn:hover {
            border-color: var(--warning);
            color: var(--warning);
        }

        .discount-btn.active {
            background: var(--warning);
            border-color: var(--warning);
            color: white;
        }

        .option-input-group {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            background: white;
            border-radius: 8px;
            border: 1px solid var(--gray-200);
        }

        [data-theme="dark"] .option-input-group { background: var(--gray-100); }

        .option-input-group label {
            font-size: 0.875rem;
            color: var(--gray-600);
            white-space: nowrap;
        }

        .option-input-group input {
            flex: 1;
            padding: 8px 10px;
            border: 1px solid var(--gray-200);
            border-radius: 6px;
            font-size: 0.875rem;
            outline: none;
            background: var(--gray-50);
            max-width: 120px;
        }

        .option-input-group input:focus { border-color: var(--primary); }

        .price-display {
            background: linear-gradient(135deg, var(--gray-800) 0%, var(--gray-900) 100%);
            border-radius: var(--radius-lg);
            padding: 24px;
            text-align: center;
            color: white;
            margin-bottom: 16px;
        }

        .price-label {
            font-size: 0.875rem;
            color: var(--gray-400);
            margin-bottom: 8px;
        }

        .price-amount {
            font-size: 2.5rem;
            font-weight: 700;
            letter-spacing: -1px;
        }

        .price-breakdown {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--gray-700);
            font-size: 0.8125rem;
            color: var(--gray-400);
            text-align: left;
        }

        .price-breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
        }

        .price-breakdown-item.discount { color: var(--warning); }
        .price-breakdown-item.add { color: var(--success); }
        .price-breakdown-item.total {
            border-top: 1px solid var(--gray-600);
            margin-top: 8px;
            padding-top: 8px;
            font-weight: 600;
            color: white;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .action-btn {
            padding: 16px;
            border: none;
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .action-btn.primary { background: var(--primary); color: white; }
        .action-btn.primary:hover { background: var(--primary-dark); transform: translateY(-1px); box-shadow: var(--shadow-md); }
        .action-btn.kakao { background: #FEE500; color: #191919; }
        .action-btn.kakao:hover { background: #E6CF00; transform: translateY(-1px); }
        .action-btn.success { background: var(--success); color: white; }
        .action-btn.success:hover { background: #059669; transform: translateY(-1px); }
        .action-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none !important; }

        .add-student-btn {
            width: 100%;
            padding: 12px;
            border: 2px dashed var(--gray-300);
            border-radius: var(--radius);
            background: transparent;
            color: var(--gray-500);
            font-size: 0.9375rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 12px;
        }

        .add-student-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
            background: var(--primary-light);
        }

        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 16px;
        }

        .modal-overlay.active { display: flex; }

        .modal {
            background: white;
            border-radius: var(--radius-lg);
            width: 100%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }

        [data-theme="dark"] .modal { background: var(--gray-100); }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-header h3 {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--gray-800);
        }

        .modal-close {
            width: 32px; height: 32px;
            border: none;
            background: var(--gray-100);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-500);
            transition: all 0.2s ease;
        }

        .modal-close:hover { background: var(--gray-200); color: var(--gray-700); }
        .modal-body { padding: 20px; }

        .form-group { margin-bottom: 16px; }

        .form-group label {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 6px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius);
            font-size: 0.9375rem;
            outline: none;
            transition: all 0.2s ease;
            background: white;
            color: var(--gray-800);
        }

        [data-theme="dark"] .form-group input,
        [data-theme="dark"] .form-group select {
            background: var(--gray-200);
            border-color: var(--gray-300);
        }

        .form-group input:focus,
        .form-group select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-light);
        }

        .modal-footer {
            padding: 16px 20px;
            border-top: 1px solid var(--gray-200);
            display: flex;
            gap: 12px;
        }

        .modal-footer button {
            flex: 1;
            padding: 12px;
            border-radius: var(--radius);
            font-size: 0.9375rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-cancel { background: var(--gray-100); border: none; color: var(--gray-600); }
        .btn-cancel:hover { background: var(--gray-200); }
        .btn-submit { background: var(--primary); border: none; color: white; }
        .btn-submit:hover { background: var(--primary-dark); }
        .btn-danger { background: var(--danger); border: none; color: white; }
        .btn-danger:hover { background: #dc2626; }

        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--gray-800);
            color: white;
            padding: 14px 24px;
            border-radius: var(--radius);
            font-size: 0.9375rem;
            font-weight: 500;
            box-shadow: var(--shadow-lg);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        .toast.success { background: var(--success); }
        .toast.error { background: var(--danger); }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray-500);
        }

        .empty-state .icon {
            width: 48px; height: 48px;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        .price-table { margin-top: 8px; }

        .price-table-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--gray-100);
            font-size: 0.875rem;
        }

        .price-table-row:last-child { border-bottom: none; }
        .price-table-row .label { color: var(--gray-600); }
        .price-table-row .value { font-weight: 600; color: var(--gray-800); }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        .stat-card {
            background: white;
            border-radius: var(--radius);
            padding: 16px;
            text-align: center;
            box-shadow: var(--shadow);
        }

        [data-theme="dark"] .stat-card { background: var(--gray-100); }

        .stat-card .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-card .stat-label {
            font-size: 0.8125rem;
            color: var(--gray-500);
            margin-top: 4px;
        }

        .stat-card.floor-8 .stat-value { color: var(--floor-8); }
        .stat-card.floor-7 .stat-value { color: var(--floor-7); }

        .seat-chart { margin-top: 16px; }

        .seat-chart-row {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .seat-chart-label {
            width: 80px;
            font-size: 0.8125rem;
            color: var(--gray-600);
        }

        .seat-chart-bar-bg {
            flex: 1;
            height: 24px;
            background: var(--gray-100);
            border-radius: 12px;
            overflow: hidden;
        }

        .seat-chart-bar {
            height: 100%;
            border-radius: 12px;
            transition: width 0.5s ease;
        }

        .seat-chart-bar.ììœ ì„ { background: linear-gradient(90deg, #fbbf24, #f59e0b); }
        .seat-chart-bar.ì˜¤í”ˆí˜• { background: linear-gradient(90deg, #3b82f6, #2563eb); }
        .seat-chart-bar.ì¹¸ë§‰ì´ { background: linear-gradient(90deg, #10b981, #059669); }
        .seat-chart-bar.í”„ë¦¬ë¯¸ì—„ { background: linear-gradient(90deg, #f59e0b, #d97706); }

        .seat-chart-count {
            width: 50px;
            text-align: right;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--gray-700);
        }

        .history-item {
            padding: 16px;
            border-bottom: 1px solid var(--gray-100);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-item:last-child { border-bottom: none; }

        .history-info h4 {
            font-size: 0.9375rem;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 4px;
        }

        .history-info p {
            font-size: 0.8125rem;
            color: var(--gray-500);
        }

        .history-amount {
            font-size: 1rem;
            font-weight: 700;
            color: var(--primary);
        }

        .history-delete {
            margin-left: 12px;
            width: 28px; height: 28px;
            border: none;
            background: var(--gray-100);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-400);
            transition: all 0.2s ease;
        }

        .history-delete:hover { background: var(--danger-light); color: var(--danger); }

        .recent-students {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            overflow-x: auto;
            padding-bottom: 8px;
        }

        .recent-student-chip {
            flex-shrink: 0;
            padding: 8px 14px;
            background: var(--primary-light);
            border: 1px solid var(--primary);
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--primary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .recent-student-chip:hover { background: var(--primary); color: white; }

        .student-list::-webkit-scrollbar,
        .recent-students::-webkit-scrollbar { width: 6px; height: 6px; }

        .student-list::-webkit-scrollbar-track,
        .recent-students::-webkit-scrollbar-track { background: var(--gray-100); border-radius: 3px; }

        .student-list::-webkit-scrollbar-thumb,
        .recent-students::-webkit-scrollbar-thumb { background: var(--gray-300); border-radius: 3px; }

        /* ë§Œë£Œ ì˜ˆì • ì•Œë¦¼ ìŠ¤íƒ€ì¼ */
        .expiry-card { border: 2px solid #f59e0b; }
        
        .expiry-count {
            background: #ef4444;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .expiry-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 20px;
            border-bottom: 1px solid var(--gray-100);
        }

        .expiry-item:last-child { border-bottom: none; }

        .expiry-item .info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .expiry-item .name {
            font-weight: 600;
            font-size: 0.9375rem;
            color: var(--gray-800);
        }

        .expiry-item .detail {
            font-size: 0.8125rem;
            color: var(--gray-500);
        }

        .expiry-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .expiry-badge.expired {
            background: #fee2e2;
            color: #dc2626;
        }

        .expiry-badge.today {
            background: #fee2e2;
            color: #dc2626;
        }

        .expiry-badge.soon {
            background: #fef3c7;
            color: #d97706;
        }

        .expiry-badge.upcoming {
            background: #dbeafe;
            color: #2563eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š ê¹€ì—„ë§ˆë…ì„œì‹¤</h1>
            <div class="version">ê²°ì œ ê³„ì‚°ê¸° v2</div>
            <div class="header-actions">
                <button class="icon-btn" onclick="toggleTheme()" title="ë‹¤í¬ëª¨ë“œ">
                    <svg id="theme-icon" width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
                    </svg>
                </button>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchSection('calculator')">ğŸ’° ê³„ì‚°ê¸°</button>
            <button class="nav-tab" onclick="switchSection('stats')">ğŸ“Š í†µê³„</button>
            <button class="nav-tab" onclick="switchSection('history')">ğŸ“‹ ë‚´ì—­</button>
        </div>

        <!-- Calculator Section -->
        <div class="section active" id="section-calculator">
            <!-- ë§Œë£Œ ì˜ˆì • ì•Œë¦¼ -->
            <div class="card expiry-card" id="expiry-card" style="display: none;">
                <div class="card-header" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-bottom: none;">
                    <h2 style="color: #92400e;">
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        ê²°ì œ ë§Œë£Œ ì˜ˆì •
                    </h2>
                    <span class="expiry-count" id="expiry-count">0ëª…</span>
                </div>
                <div class="card-body" style="padding: 0;">
                    <div id="expiry-list"></div>
                </div>
            </div>

            <div class="floor-tabs">
                <button class="floor-tab floor-8 active" onclick="selectFloor(8)">
                    <span>8ì¸µ</span>
                    <span class="count" id="floor8-count">115ëª…</span>
                </button>
                <button class="floor-tab floor-7" onclick="selectFloor(7)">
                    <span>7ì¸µ</span>
                    <span class="count" id="floor7-count">46ëª…</span>
                </button>
            </div>

            <div class="recent-students" id="recent-students" style="display: none;"></div>

            <div class="card">
                <div class="card-header">
                    <h2>
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        í•™ìƒ ì„ íƒ
                    </h2>
                </div>
                <div class="card-body">
                    <div class="seat-filter" id="seat-filter"></div>
                    <div class="search-box">
                        <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                        <input type="text" id="student-search" placeholder="í•™ìƒ ì´ë¦„ ê²€ìƒ‰..." oninput="filterStudents()">
                    </div>
                    <div class="student-list" id="student-list"></div>
                    <button class="add-student-btn" onclick="openAddModal()">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                        </svg>
                        ì‹ ê·œ í•™ìƒ ì¶”ê°€
                    </button>
                </div>
            </div>

            <div class="card" id="calculation-card" style="display: none;">
                <div class="card-header">
                    <h2>
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                        </svg>
                        ê²°ì œ ê³„ì‚°
                    </h2>
                </div>
                <div class="card-body">
                    <div class="selected-student-card" id="selected-student-info"></div>
                    
                    <div class="form-group">
                        <label>ì´ìš© ê¸°ê°„</label>
                        <div class="period-grid">
                            <button class="period-btn" onclick="selectPeriod(1)" data-period="1">1ê°œì›”<span class="weeks">4ì£¼</span></button>
                            <button class="period-btn" onclick="selectPeriod(2)" data-period="2">2ê°œì›”<span class="weeks">8ì£¼</span></button>
                            <button class="period-btn" onclick="selectPeriod(3)" data-period="3">3ê°œì›”<span class="weeks">12ì£¼</span></button>
                        </div>
                    </div>

                    <!-- ë“±ì›ì¼ ì„ íƒ -->
                    <div class="form-group">
                        <label>ë“±ì› ì‹œì‘ì¼</label>
                        <select id="start-day" onchange="calculatePrice()">
                            <option value="1">1ì¼</option>
                            <option value="2">2ì¼</option>
                            <option value="3">3ì¼</option>
                            <option value="4">4ì¼</option>
                            <option value="5">5ì¼</option>
                            <option value="6">6ì¼</option>
                            <option value="7">7ì¼</option>
                            <option value="8">8ì¼</option>
                            <option value="9">9ì¼</option>
                            <option value="10">10ì¼</option>
                            <option value="11">11ì¼</option>
                            <option value="12">12ì¼</option>
                            <option value="13">13ì¼</option>
                            <option value="14">14ì¼</option>
                            <option value="15">15ì¼</option>
                            <option value="16">16ì¼</option>
                            <option value="17">17ì¼</option>
                            <option value="18">18ì¼</option>
                            <option value="19">19ì¼</option>
                            <option value="20">20ì¼</option>
                            <option value="21">21ì¼</option>
                            <option value="22">22ì¼</option>
                            <option value="23">23ì¼</option>
                            <option value="24">24ì¼</option>
                            <option value="25">25ì¼</option>
                            <option value="26">26ì¼</option>
                            <option value="27">27ì¼</option>
                            <option value="28">28ì¼</option>
                            <option value="29">29ì¼</option>
                            <option value="30">30ì¼</option>
                            <option value="31">31ì¼</option>
                        </select>
                        <p style="font-size: 0.75rem; color: var(--gray-500); margin-top: 4px;">* ë‚ ì§œë³„ ê¸ˆì•¡ì´ ìë™ ì ìš©ë©ë‹ˆë‹¤</p>
                    </div>

                    <!-- ì¶”ê°€ ì˜µì…˜ ì„¹ì…˜ -->
                    <div class="options-section">
                        <div class="options-title">âš™ï¸ ì´ìš©ê¶Œ ì„ íƒ</div>
                        
                        <!-- ì¢…ì¼ê¶Œ/ì˜¤í›„ê¶Œ ì„ íƒ -->
                        <div class="discount-btn-group">
                            <button class="discount-btn ticket-btn active" data-ticket="ì¢…ì¼ê¶Œ" onclick="selectTicketType('ì¢…ì¼ê¶Œ')">ğŸŒ ì¢…ì¼ê¶Œ</button>
                            <button class="discount-btn ticket-btn" data-ticket="ì˜¤í›„ê¶Œ" onclick="selectTicketType('ì˜¤í›„ê¶Œ')">ğŸŒ™ ì˜¤í›„ê¶Œ</button>
                        </div>
                        <p style="font-size: 0.75rem; color: var(--gray-500); margin-bottom: 12px;">* ë°©í•™: ì¢…ì¼ê¶Œ / í•™ê¸°ì¤‘: ì˜¤í›„ê¶Œ (Nìˆ˜ìƒ ì œì™¸)</p>
                        
                        <!-- ë©˜í† ë§ í¬í•¨ -->
                        <div class="option-item" id="mentoring-option" onclick="toggleOption('mentoring')">
                            <input type="checkbox" id="opt-mentoring" onchange="calculatePrice()">
                            <span class="option-label">ğŸ“ ë©˜í† ë§ ì„œë¹„ìŠ¤ í¬í•¨</span>
                            <span class="option-value" id="mentoring-price">+4ë§Œì›</span>
                        </div>

                        <!-- ì‚¬ë¬¼í•¨ -->
                        <div class="option-item" onclick="toggleOption('locker')">
                            <input type="checkbox" id="opt-locker" onchange="calculatePrice()">
                            <span class="option-label">ğŸ” ì‚¬ë¬¼í•¨</span>
                            <span class="option-value">+2ë§Œì›/ì›”</span>
                        </div>

                        <!-- ìµœì´ˆê°€ì…ë¹„ -->
                        <div class="option-item" onclick="toggleOption('register')">
                            <input type="checkbox" id="opt-register" onchange="calculatePrice()">
                            <span class="option-label">ğŸ†• ìµœì´ˆê°€ì…ë¹„</span>
                            <span class="option-value">+10ë§Œì›</span>
                        </div>

                        <!-- í• ì¸ -->
                        <div class="options-title" style="margin-top: 12px; border: none; padding: 0;">ğŸ·ï¸ í• ì¸ ì ìš©</div>
                        <div class="discount-btn-group">
                            <button class="discount-btn active" data-discount="0" onclick="selectDiscount(0)">ì—†ìŒ</button>
                            <button class="discount-btn" data-discount="10" onclick="selectDiscount(10)">10%</button>
                            <button class="discount-btn" data-discount="20" onclick="selectDiscount(20)">20%</button>
                        </div>
                    </div>

                    <div class="price-display">
                        <div class="price-label">ì´ ê²°ì œ ê¸ˆì•¡</div>
                        <div class="price-amount" id="total-price">â‚©0</div>
                        <div class="price-breakdown" id="price-breakdown"></div>
                    </div>

                    <div class="action-buttons">
                        <button class="action-btn primary" id="copy-btn" onclick="copyPrice()" disabled>
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"/>
                            </svg>
                            ê¸ˆì•¡ ë³µì‚¬
                        </button>
                        <button class="action-btn kakao" id="kakao-btn" onclick="copyKakaoMessage()" disabled>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 3C6.48 3 2 6.58 2 11c0 2.82 1.86 5.29 4.65 6.71-.15.53-.54 1.92-.62 2.22-.1.37.14.37.29.27.12-.08 1.89-1.28 2.65-1.8.67.1 1.36.15 2.03.15 5.52 0 10-3.58 10-8C22 6.58 17.52 3 12 3z"/>
                            </svg>
                            ì¹´í†¡ ë©”ì‹œì§€
                        </button>
                    </div>
                    <button class="action-btn success" id="save-btn" onclick="savePayment()" disabled style="margin-top: 12px; width: 100%;">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                        ê²°ì œ ë‚´ì—­ ì €ì¥
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2>
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        <span id="price-table-title">ğŸ“… ë‚ ì§œë³„ ìš”ê¸ˆí‘œ</span>
                    </h2>
                </div>
                <div class="card-body">
                    <div class="price-table" id="price-table"></div>
                </div>
            </div>
        </div>

        <!-- Stats Section -->
        <div class="section" id="section-stats">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="stat-total">161</div>
                    <div class="stat-label">ì „ì²´ í•™ìƒ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-payments">0</div>
                    <div class="stat-label">ì´ë²ˆ ë‹¬ ê²°ì œ</div>
                </div>
                <div class="stat-card floor-8">
                    <div class="stat-value" id="stat-floor8">115</div>
                    <div class="stat-label">8ì¸µ í•™ìƒ</div>
                </div>
                <div class="stat-card floor-7">
                    <div class="stat-value" id="stat-floor7">46</div>
                    <div class="stat-label">7ì¸µ í•™ìƒ</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header"><h2>ğŸ“Š 8ì¸µ ì¢Œì„ í˜„í™©</h2></div>
                <div class="card-body"><div class="seat-chart" id="chart-floor8"></div></div>
            </div>

            <div class="card">
                <div class="card-header"><h2>ğŸ“Š 7ì¸µ ì¢Œì„ í˜„í™©</h2></div>
                <div class="card-body"><div class="seat-chart" id="chart-floor7"></div></div>
            </div>
        </div>

        <!-- History Section -->
        <div class="section" id="section-history">
            <!-- ë°±ì—…/ë³µì› ì¹´ë“œ -->
            <div class="card">
                <div class="card-header">
                    <h2>ğŸ’¾ ë°ì´í„° ë°±ì—…</h2>
                </div>
                <div class="card-body">
                    <p style="font-size: 0.875rem; color: var(--gray-600); margin-bottom: 16px;">
                        í•™ìƒ ë°ì´í„°ì™€ ê²°ì œ ë‚´ì—­ì„ íŒŒì¼ë¡œ ì €ì¥í•˜ê³  ë³µì›í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                    <div class="action-buttons">
                        <button class="action-btn primary" onclick="exportBackup()">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
                            </svg>
                            ë°±ì—… íŒŒì¼ ì €ì¥
                        </button>
                        <button class="action-btn kakao" onclick="document.getElementById('restore-file').click()">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                            </svg>
                            ë°±ì—… íŒŒì¼ ë³µì›
                        </button>
                        <input type="file" id="restore-file" accept=".json" style="display:none;" onchange="importBackup(event)">
                    </div>
                    <div class="backup-info" style="margin-top: 16px; padding: 12px; background: var(--warning-light); border-radius: 8px; font-size: 0.8125rem; color: #92400e;">
                        ğŸ’¡ <strong>ê¶Œì¥:</strong> ì£¼ 1íšŒ ë°±ì—… íŒŒì¼ ì €ì¥í•´ë‘ì„¸ìš”!
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2>ğŸ“‹ ê²°ì œ ë‚´ì—­</h2>
                    <button class="icon-btn" onclick="exportHistory()" title="CSV ë‚´ë³´ë‚´ê¸°">
                        <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
                        </svg>
                    </button>
                </div>
                <div class="card-body" style="padding: 0;">
                    <div id="history-list"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Modal -->
    <div class="modal-overlay" id="student-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modal-title">ì‹ ê·œ í•™ìƒ ì¶”ê°€</h3>
                <button class="modal-close" onclick="closeStudentModal()">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="edit-index">
                <div class="form-group">
                    <label>í•™ìƒ ì´ë¦„ *</label>
                    <input type="text" id="modal-name" placeholder="í™ê¸¸ë™">
                </div>
                <div class="form-group">
                    <label>ì¸µ</label>
                    <select id="modal-floor" onchange="updateModalSeatTypes()">
                        <option value="8">8ì¸µ</option>
                        <option value="7">7ì¸µ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ì¢Œì„ ìœ í˜• *</label>
                    <select id="modal-seat-type"></select>
                </div>
                <div class="form-group">
                    <label>ì¢Œì„ ë²ˆí˜¸</label>
                    <input type="text" id="modal-seat-number" placeholder="ì˜ˆ: 101">
                </div>
                <div class="form-group">
                    <label>í•™ìƒ ì „í™”ë²ˆí˜¸</label>
                    <input type="tel" id="modal-student-phone" placeholder="010-0000-0000">
                </div>
                <div class="form-group">
                    <label>í•™ë¶€ëª¨ ì „í™”ë²ˆí˜¸</label>
                    <input type="tel" id="modal-parent-phone" placeholder="010-0000-0000">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeStudentModal()">ì·¨ì†Œ</button>
                <button class="btn-submit" id="modal-submit" onclick="saveStudent()">ì¶”ê°€í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <!-- Delete Modal -->
    <div class="modal-overlay" id="delete-modal">
        <div class="modal">
            <div class="modal-header">
                <h3>í•™ìƒ ì‚­ì œ</h3>
                <button class="modal-close" onclick="closeDeleteModal()">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <p id="delete-message">ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeDeleteModal()">ì·¨ì†Œ</button>
                <button class="btn-danger" onclick="confirmDelete()">ì‚­ì œ</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast">
        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
        </svg>
        <span id="toast-message">ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤</span>
    </div>

    <script>
        // ì›” ê¸°ë³¸ ìš”ê¸ˆí‘œ
        const monthlyPrices = {
            ì¢…ì¼ê¶Œ: {
                'í”„ë¦¬ë¯¸ì—„': 790000,      // Nìˆ˜ìƒ
                'ì¹¸ë§‰ì´': 690000,
                'ì¹¸ë§‰ì´_ë©˜í† ë§': 730000,
                'ì˜¤í”ˆí˜•': 630000,
                'ììœ ì„': 490000
            },
            ì˜¤í›„ê¶Œ: {
                'ì¹¸ë§‰ì´': 550000,
                'ì¹¸ë§‰ì´_ë©˜í† ë§': 650000,
                'ì˜¤í”ˆí˜•': 530000,
                'ì˜¤í”ˆí˜•_ë©˜í† ë§': 590000,
                'ììœ ì„': 390000
            }
        };

        // 8ì¸µ ì¼í• ê³„ì‚° ìš”ê¸ˆí‘œ (12ì›” ê¸°ì¤€, ì‚¬ë¬¼í•¨ ì œì™¸)
        const dailyPriceTable_8F = {
            'ììœ ì„': {
                1: 390000, 2: 377000, 3: 364000, 4: 351000, 5: 338000,
                6: 325000, 7: 312000, 8: 299000, 9: 286000, 10: 273000,
                11: 260000, 12: 247000, 13: 234000, 14: 221000, 15: 221000,
                16: 208000, 17: 195000, 18: 182000, 19: 169000, 20: 156000,
                21: 143000, 22: 130000, 23: 117000, 24: 104000, 25: 91000,
                26: 78000, 27: 65000, 28: 52000, 29: 39000, 30: 26000, 31: 13000
            },
            'ì˜¤í”ˆí˜•': {
                1: 490000, 2: 475600, 3: 459200, 4: 442800, 5: 426400,
                6: 410000, 7: 393600, 8: 377200, 9: 360800, 10: 344400,
                11: 328000, 12: 311600, 13: 295200, 14: 278800, 15: 278800,
                16: 262400, 17: 246000, 18: 229600, 19: 213200, 20: 196800,
                21: 180400, 22: 164000, 23: 147600, 24: 131200, 25: 114800,
                26: 98400, 27: 82000, 28: 65600, 29: 49200, 30: 32800, 31: 16400
            },
            'ì¹¸ë§‰ì´': {
                1: 555000, 2: 536500, 3: 518000, 4: 499500, 5: 481000,
                6: 462500, 7: 444000, 8: 425500, 9: 407000, 10: 388500,
                11: 370000, 12: 351500, 13: 333000, 14: 314500, 15: 314500,
                16: 296000, 17: 277500, 18: 259000, 19: 240500, 20: 222000,
                21: 203500, 22: 185000, 23: 166500, 24: 148000, 25: 129500,
                26: 111000, 27: 92500, 28: 74000, 29: 55500, 30: 37000, 31: 18500
            }
        };

        // 7ì¸µ ì¼í• ê³„ì‚° ìš”ê¸ˆí‘œ (19ì¼~31ì¼, ë°©í•™ ê¸°ì¤€)
        const dailyPriceTable_7F = {
            'ì˜¤í”ˆí˜•': {
                19: 273000, 20: 252000, 21: 231000, 22: 210000, 23: 189000,
                24: 168000, 25: 147000, 26: 126000, 27: 105000, 28: 84000,
                29: 63000, 30: 42000, 31: 21000
            },
            'ì¹¸ë§‰ì´': {
                19: 299000, 20: 276000, 21: 253000, 22: 230000, 23: 207000,
                24: 184000, 25: 161000, 26: 138000, 27: 115000, 28: 92000,
                29: 69000, 30: 46000, 31: 23000
            }
        };

        const LOCKER_FEE = 20000;      // ì‚¬ë¬¼í•¨ ì›” ë¹„ìš©
        const REGISTER_FEE = 100000;   // ìµœì´ˆê°€ì…ë¹„

        const seatTypes = {
            8: ['ì „ì²´', 'ììœ ì„', 'ì˜¤í”ˆí˜•', 'ì¹¸ë§‰ì´'],
            7: ['ì „ì²´', 'í”„ë¦¬ë¯¸ì—„', 'ì˜¤í”ˆí˜•', 'ì¹¸ë§‰ì´']
        };

        // ì¢Œì„ìœ í˜• ë§¤í•‘ (ê¸°ì¡´ ë°ì´í„° í˜¸í™˜)
        const seatTypeMapping = {
            'ì§€ì •ì„_ì—¬': 'ì˜¤í”ˆí˜•',
            'ì§€ì •ì„_ë‚¨': 'ì˜¤í”ˆí˜•',
            'ì§€ì •ì„': 'ì˜¤í”ˆí˜•'
        };

        function normalizeSeatType(type) {
            return seatTypeMapping[type] || type;
        }

        // 8ì¸µ í•™ìƒ 115ëª…
        const defaultStudents = {
            8: [
                { name: 'ì–‘ì¤€ë¹ˆ', phone: '010-5029-5112', parentPhone: '010-7652-5112', seatType: 'ììœ ì„', seatNumber: '101' },
                { name: 'ìµœì¤€ì„œ', phone: '010-3085-7594', parentPhone: '010-3082-7594', seatType: 'ììœ ì„', seatNumber: '102' },
                { name: 'ì´í˜œë¯¼', phone: '010-2234-4376', parentPhone: '010-2553-4376', seatType: 'ììœ ì„', seatNumber: '105' },
                { name: 'ê¹€ìˆ˜ì˜', phone: '010-5859-8232', parentPhone: '010-2958-8232', seatType: 'ììœ ì„', seatNumber: '113' },
                { name: 'ê¹€ì—°ì¤€', phone: '010-6516-4711', parentPhone: '010-3894-4711', seatType: 'ììœ ì„', seatNumber: '116' },
                { name: 'ë³€ìš°ì„', phone: '', parentPhone: '', seatType: 'ììœ ì„', seatNumber: '117' },
                { name: 'ìœ ìŠ¹ì°¬', phone: '', parentPhone: '', seatType: 'ììœ ì„', seatNumber: '120' },
                { name: 'ì¶”ì—¬ë¦¼', phone: '010-3982-9377', parentPhone: '010-7339-9377', seatType: 'ììœ ì„', seatNumber: '123' },
                { name: 'ì´ì±„ìœ¤', phone: '010-8464-2920', parentPhone: '010-8374-2920', seatType: 'ììœ ì„', seatNumber: '125' },
                { name: 'ì£¼ì§€ì›', phone: '000-000-0000', parentPhone: '010-4164-3132', seatType: 'ììœ ì„', seatNumber: '127' },
                { name: 'ë°•í˜„í¬', phone: '010-5295-3128', parentPhone: '010-9253-4998', seatType: 'ììœ ì„', seatNumber: '128' },
                { name: 'ê¹€í˜œë¯¼', phone: '000-000-0000', parentPhone: '010-9123-3702', seatType: 'ììœ ì„', seatNumber: '131' },
                { name: 'ì´ì§€íš¨', phone: '010-9296-1532', parentPhone: '010-6286-1532', seatType: 'ììœ ì„', seatNumber: '133' },
                { name: 'ê¹€ë„ì›', phone: '010-9704-7060', parentPhone: '010-4255-7060', seatType: 'ììœ ì„', seatNumber: '134' },
                { name: 'ë¥˜ë³´ë¯¼', phone: '010-3005-9754', parentPhone: '010-8990-9754', seatType: 'ììœ ì„', seatNumber: '135' },
                { name: 'ì •ì±„ì—°', phone: '010-6322-0235', parentPhone: '010-2962-6335', seatType: 'ììœ ì„', seatNumber: '136' },
                { name: 'í•œê±´í¬', phone: '010-4864-7963', parentPhone: '010-4118-7963', seatType: 'ììœ ì„', seatNumber: '140' },
                { name: 'ë°•ì§€ë¯¼', phone: '010-3141-6192', parentPhone: '010-9093-6192', seatType: 'ììœ ì„', seatNumber: '141' },
                { name: 'ê¹€ë‹¤ì€', phone: '010-3767-9187', parentPhone: '010-9357-9187', seatType: 'ììœ ì„', seatNumber: '144' },
                { name: 'ë°±ì¤€í•˜', phone: '000-0000-0000', parentPhone: '010-9571-0705', seatType: 'ììœ ì„', seatNumber: '145' },
                { name: 'ì´í˜„ìš°', phone: '', parentPhone: '010-7338-1417', seatType: 'ììœ ì„', seatNumber: '146' },
                { name: 'ê°•ì„±ì¤€', phone: '010-5287-4067', parentPhone: '010-4156-5067', seatType: 'ììœ ì„', seatNumber: '147' },
                { name: 'ì„±ë¯¼ì§„', phone: '010-8688-0857', parentPhone: '010-3205-6126', seatType: 'ììœ ì„', seatNumber: '148' },
                { name: 'ì¡°ì¬ì›', phone: '010-2940-6749', parentPhone: '010-3009-6749', seatType: 'ììœ ì„', seatNumber: '153' },
                { name: 'ì—°ì„œì§„', phone: '010-2823-8842', parentPhone: '010-9059-4132', seatType: 'ììœ ì„', seatNumber: '158' },
                { name: 'ì´ìœ í™˜', phone: '010-3398-7769', parentPhone: '010-2264-7769', seatType: 'ììœ ì„', seatNumber: '103' },
                { name: 'ì˜¤ì˜ˆë¦°', phone: '010-9656-8849', parentPhone: '010-7662-8849', seatType: 'ììœ ì„', seatNumber: '104' },
                { name: 'ë°•ì„œì§„', phone: '010-5909-7240', parentPhone: '010-2433-7249', seatType: 'ììœ ì„', seatNumber: '106' },
                { name: 'ìµœìˆ˜ë¹ˆ', phone: '010-2973-9856', parentPhone: '010-2619-9856', seatType: 'ììœ ì„', seatNumber: '107' },
                { name: 'ê¹€íƒœìš±', phone: '010-9508-5976', parentPhone: '010-9528-5976', seatType: 'ììœ ì„', seatNumber: '108' },
                { name: 'ì´ìœ ë‹´', phone: '010-7928-6947', parentPhone: '010-8788-6947', seatType: 'ììœ ì„', seatNumber: '109' },
                { name: 'ê¹€ì£¼í˜•', phone: '010-6471-5419', parentPhone: '010-9396-1274', seatType: 'ììœ ì„', seatNumber: '110' },
                { name: 'ì„ì†”ìš°', phone: '010-8863-8325', parentPhone: '010-8564-8325', seatType: 'ììœ ì„', seatNumber: '111' },
                { name: 'ê¹€ë¯¼ì°¬', phone: '010-2847-0155', parentPhone: '010-7351-0155', seatType: 'ììœ ì„', seatNumber: '112' },
                { name: 'ë°•ì„œì¤€', phone: '010-9814-3463', parentPhone: '010-5873-3466', seatType: 'ììœ ì„', seatNumber: '114' },
                { name: 'ì´ì‹œìš°', phone: '010-9078-3190', parentPhone: '010-5272-0088', seatType: 'ììœ ì„', seatNumber: '115' },
                { name: 'ì‹¬ì˜ˆë‚˜', phone: '000-000-0000', parentPhone: '010-9104-5891', seatType: 'ììœ ì„', seatNumber: '118' },
                { name: 'ê¹€ì§€ìˆ˜', phone: '010-2771-2301', parentPhone: '010-4821-2301', seatType: 'ììœ ì„', seatNumber: '119' },
                { name: 'ìµœìœ¤í•˜', phone: '010-8028-5433', parentPhone: '010-3723-3777', seatType: 'ììœ ì„', seatNumber: '121' },
                { name: 'ì‹ ì¬í¬', phone: '010-2412-6310', parentPhone: '010-5187-6310', seatType: 'ììœ ì„', seatNumber: '122' },
                { name: 'ìµœì‹œì€', phone: '010-3782-5548', parentPhone: '010-9077-5558', seatType: 'ììœ ì„', seatNumber: '124' },
                { name: 'ë°•ê²½ì¤€', phone: '010-9564-2104', parentPhone: '010-2298-2104', seatType: 'ììœ ì„', seatNumber: '126' },
                { name: 'ê¹€ê°€ì˜', phone: '010-6427-9130', parentPhone: '010-6311-9130', seatType: 'ììœ ì„', seatNumber: '129' },
                { name: 'ê¹€ì†Œì •', phone: '010-3012-7898', parentPhone: '010-5466-7898', seatType: 'ììœ ì„', seatNumber: '130' },
                { name: 'ìµœì •í˜', phone: '010-6797-3708', parentPhone: '010-2797-3708', seatType: 'ììœ ì„', seatNumber: '132' },
                { name: 'ì •ì§€ìš°', phone: '010-4934-7935', parentPhone: '010-6829-1219', seatType: 'ììœ ì„', seatNumber: '137' },
                { name: 'ì¡°ìŠ¹ì°¬', phone: '010-8895-8478', parentPhone: '010-3219-2151', seatType: 'ììœ ì„', seatNumber: '138' },
                { name: 'ì´ì—°ìš°', phone: '010-4872-2510', parentPhone: '010-2854-0924', seatType: 'ììœ ì„', seatNumber: '139' },
                { name: 'ê¸ˆì¤€ì„œ', phone: '010-8694-9636', parentPhone: '010-7194-9636', seatType: 'ììœ ì„', seatNumber: '142' },
                { name: 'ê¹€ì„œì—°', phone: '010-4794-0038', parentPhone: '010-8608-0252', seatType: 'ììœ ì„', seatNumber: '143' },
                { name: 'ê³ í•œë¹ˆ', phone: '010-9130-5182', parentPhone: '010-9173-5182', seatType: 'ììœ ì„', seatNumber: '149' },
                { name: 'ì¥ì€ì†¡', phone: '010-9427-3143', parentPhone: '010-9788-8661', seatType: 'ììœ ì„', seatNumber: '151' },
                { name: 'ìµœì„í˜„', phone: '010-9315-2412', parentPhone: '010-3296-4370', seatType: 'ììœ ì„', seatNumber: '152' },
                { name: 'ì¥ì§€í›„', phone: '010-2134-5865', parentPhone: '010-3489-5865', seatType: 'ììœ ì„', seatNumber: '154' },
                { name: 'ê³½ì§€ìš°', phone: '010-2585-9417', parentPhone: '010-8267-9417', seatType: 'ììœ ì„', seatNumber: '155' },
                { name: 'ì´ì†Œì •', phone: '010-3955-2245', parentPhone: '010-8819-9555', seatType: 'ììœ ì„', seatNumber: '156' },
                { name: 'ì •ê·œí—Œ', phone: '010-7671-2883', parentPhone: '010-8516-9520', seatType: 'ììœ ì„', seatNumber: '157' },
                { name: 'ê°•ì˜ˆì›', phone: '010-6243-2643', parentPhone: '010-6277-2643', seatType: 'ììœ ì„', seatNumber: '160' },
                { name: 'ì´í˜„ìŠ¹', phone: '010-5233-3295', parentPhone: '010-9265-3295', seatType: 'ììœ ì„', seatNumber: '161' },
                { name: 'ê¹€ì—°ì„œ', phone: '010-2396-0796', parentPhone: '010-6315-0796', seatType: 'ì¹¸ë§‰ì´', seatNumber: '1' },
                { name: 'ì´ìœ¤ì§€', phone: '010-5676-1065', parentPhone: '010-5207-1065', seatType: 'ì¹¸ë§‰ì´', seatNumber: '2' },
                { name: 'ì„±ì˜ˆì¤€', phone: '010-4062-7663', parentPhone: '010-2611-4881', seatType: 'ì¹¸ë§‰ì´', seatNumber: '3' },
                { name: 'ë°±ì£¼í˜¸', phone: '010-6696-5001', parentPhone: '010-9945-5000', seatType: 'ì¹¸ë§‰ì´', seatNumber: '4' },
                { name: 'í•˜ì¤€ìš°', phone: '000-0000-0000', parentPhone: '010-9172-8400', seatType: 'ì¹¸ë§‰ì´', seatNumber: '5' },
                { name: 'ì†¡ë‚˜í˜„', phone: '010-4674-0132', parentPhone: '010-3083-7856', seatType: 'ì¹¸ë§‰ì´', seatNumber: '6' },
                { name: 'í™©ì§€ìœ¤', phone: '010-8927-8179', parentPhone: '010-8936-8179', seatType: 'ì¹¸ë§‰ì´', seatNumber: '7' },
                { name: 'ìœ¤ì˜ˆì„œ', phone: '010-9403-0773', parentPhone: '010-4631-7740', seatType: 'ì¹¸ë§‰ì´', seatNumber: '8' },
                { name: 'ê¹€ë¯¼ìš°', phone: '010-4005-7508', parentPhone: '010-7299-7508', seatType: 'ì¹¸ë§‰ì´', seatNumber: '9' },
                { name: 'ë°•ì§€ì›', phone: '010-8767-5827', parentPhone: '010-8735-5827', seatType: 'ì¹¸ë§‰ì´', seatNumber: '10' },
                { name: 'ì˜¤ì¢…í˜„', phone: '010-4670-7925', parentPhone: '010-5090-7925', seatType: 'ì¹¸ë§‰ì´', seatNumber: '11' },
                { name: 'ê¹€ì˜ˆë‚˜', phone: '010-3277-5128', parentPhone: '010-5327-5128', seatType: 'ì¹¸ë§‰ì´', seatNumber: '12' },
                { name: 'ì‹ ìœ ë¹ˆ', phone: '010-4102-5364', parentPhone: '010-9532-5362', seatType: 'ì¹¸ë§‰ì´', seatNumber: '13' },
                { name: 'ê¹€ìš©í¬', phone: '010-3713-1890', parentPhone: '010-3713-1890', seatType: 'ì¹¸ë§‰ì´', seatNumber: '14' },
                { name: 'ê¹€í˜„ì¤€', phone: '010-6296-9810', parentPhone: '010-5582-4384', seatType: 'ì¹¸ë§‰ì´', seatNumber: '15' },
                { name: 'ê¶Œì¤€ìš°', phone: '010-9145-1829', parentPhone: '010-8699-1829', seatType: 'ì¹¸ë§‰ì´', seatNumber: '16' },
                { name: 'ì¡°ì˜ì¤€', phone: '010-4647-7630', parentPhone: '010-9449-6047', seatType: 'ì¹¸ë§‰ì´', seatNumber: '17' },
                { name: 'í•œìŠ¹ì£¼', phone: '010-4940-3633', parentPhone: '010-8893-3633', seatType: 'ì¹¸ë§‰ì´', seatNumber: '18' },
                { name: 'ê¹€ê·œíƒœ', phone: '010-7591-2747', parentPhone: '010-5163-7714', seatType: 'ì¹¸ë§‰ì´', seatNumber: '19' },
                { name: 'ì¡°ì˜ˆì›', phone: '010-9915-5683', parentPhone: '010-8834-5683', seatType: 'ì¹¸ë§‰ì´', seatNumber: '20' },
                { name: 'ë°°ì°½ë¯¼', phone: '010-6860-8832', parentPhone: '010-3414-8832', seatType: 'ì¹¸ë§‰ì´', seatNumber: '21' },
                { name: 'ì‹ ì›ì¤€', phone: '010-8912-9704', parentPhone: '010-2382-9704', seatType: 'ì¹¸ë§‰ì´', seatNumber: '22' },
                { name: 'ë°©ì†Œì—°', phone: '010-3675-8697', parentPhone: '010-3358-0688', seatType: 'ì¹¸ë§‰ì´', seatNumber: '23' },
                { name: 'ì†¡ì€ì„œ', phone: '010-5570-9186', parentPhone: '010-2563-9168', seatType: 'ì¹¸ë§‰ì´', seatNumber: '24' },
                { name: 'í•œì„±íš¨', phone: '010-4761-2409', parentPhone: '010-4623-0568', seatType: 'ì¹¸ë§‰ì´', seatNumber: '25' },
                { name: 'ê¹€ì±„ì›', phone: '010-6637-7632', parentPhone: '010-3613-7632', seatType: 'ì¹¸ë§‰ì´', seatNumber: '26' },
                { name: 'ì´ì„ì •', phone: '010-9558-2653', parentPhone: '010-4753-2653', seatType: 'ì¹¸ë§‰ì´', seatNumber: '27' },
                { name: 'ì´í•´ì„±', phone: '010-2173-2035', parentPhone: '010-6652-2035', seatType: 'ì¹¸ë§‰ì´', seatNumber: '28' },
                { name: 'ì¥ì—°ìš°', phone: '010-6854-1040', parentPhone: '010-8875-3377', seatType: 'ì§€ì •ì„_ì—¬', seatNumber: '29' },
                { name: 'ìµœì£¼ì›', phone: '014-8911-6292', parentPhone: '010-6318-0945', seatType: 'ì§€ì •ì„_ì—¬', seatNumber: '30' },
                { name: 'ì´ì„œì—°', phone: '010-6235-3867', parentPhone: '010-6330-9299', seatType: 'ì§€ì •ì„_ì—¬', seatNumber: '31' },
                { name: 'ìœ ë¯¼ì„œ', phone: '010-2123-5792', parentPhone: '010-3657-5792', seatType: 'ì§€ì •ì„_ì—¬', seatNumber: '32' },
                { name: 'ê°•ì˜ˆì„œ', phone: '010-2636-2826', parentPhone: '010-6495-0328', seatType: 'ì§€ì •ì„_ì—¬', seatNumber: '33' },
                { name: 'ë°•ì„œìœ¤', phone: '010-6449-4562', parentPhone: '010-9333-4562', seatType: 'ì§€ì •ì„_ì—¬', seatNumber: '34' },
                { name: 'ë°°ì„±ì˜', phone: '010-6233-5457', parentPhone: '010-6553-1472', seatType: 'ì§€ì •ì„_ì—¬', seatNumber: '35' },
                { name: 'ì˜¤ìœ¤ì£¼', phone: '010-4677-6482', parentPhone: '010-2977-4066', seatType: 'ì§€ì •ì„_ì—¬', seatNumber: '36' },
                { name: 'ì†¡ë‹¤ë¯¸', phone: '010-7466-7087', parentPhone: '010-8518-7332', seatType: 'ì§€ì •ì„_ì—¬', seatNumber: '37' },
                { name: 'ì •ì˜ˆë¦¼', phone: '010-5294-5329', parentPhone: '010-5290-5329', seatType: 'ì§€ì •ì„_ì—¬', seatNumber: '38' },
                { name: 'ê¹€ë‚˜í˜„', phone: '010-4331-9741', parentPhone: '010-8957-2920', seatType: 'ì§€ì •ì„_ì—¬', seatNumber: '39' },
                { name: 'ì†¡ìˆ˜ë¦°', phone: '010-2479-8014', parentPhone: '010-5738-8014', seatType: 'ì§€ì •ì„_ì—¬', seatNumber: '40' },
                { name: 'ë°•ì€ì„œ', phone: '010-3390-6592', parentPhone: '010-2654-0937', seatType: 'ì§€ì •ì„_ì—¬', seatNumber: '41' },
                { name: 'ì´ì„ ë¯¼', phone: '010-7679-8044', parentPhone: '010-6352-8044', seatType: 'ì§€ì •ì„_ì—¬', seatNumber: '42' },
                { name: 'ë°±ì§„í™˜', phone: '010-4021-1592', parentPhone: '010-5005-1204', seatType: 'ì§€ì •ì„_ë‚¨', seatNumber: '43' },
                { name: 'ìœ¤ìˆ˜í˜', phone: '010-3107-4890', parentPhone: '010-4149-4890', seatType: 'ì§€ì •ì„_ë‚¨', seatNumber: '44' },
                { name: 'ì˜¤ìŠ¹ì¤€', phone: '010-8466-0849', parentPhone: '010-8957-0849', seatType: 'ì§€ì •ì„_ë‚¨', seatNumber: '45' },
                { name: 'ë°±ì •ì¤€', phone: '010-4992-1082', parentPhone: '010-4943-1082', seatType: 'ì§€ì •ì„_ë‚¨', seatNumber: '46' },
                { name: 'ë°•ì§„ê· ', phone: '010-9106-4316', parentPhone: '010-9446-4316', seatType: 'ì§€ì •ì„_ë‚¨', seatNumber: '47' },
                { name: 'ë¬¸ì„œì§„', phone: '010-9230-3782', parentPhone: '010-9031-7577', seatType: 'ì§€ì •ì„_ë‚¨', seatNumber: '48' },
                { name: 'ê°•ì¤€í˜', phone: '010-6542-7286', parentPhone: '010-2710-7286', seatType: 'ì§€ì •ì„_ë‚¨', seatNumber: '49' },
                { name: 'ì†ì œí›ˆ', phone: '010-5104-0657', parentPhone: '010-5104-0657', seatType: 'ì§€ì •ì„_ë‚¨', seatNumber: '50' },
                { name: 'ì´ì„¸í˜„', phone: '010-3064-2498', parentPhone: '010-9170-2498', seatType: 'ì§€ì •ì„_ë‚¨', seatNumber: '51' },
                { name: 'ë°•ì„±ì§„', phone: '010-4248-3890', parentPhone: '010-9872-0112', seatType: 'ì§€ì •ì„_ë‚¨', seatNumber: '52' },
                { name: 'ìµœì„í˜„(ì§€ì •)', phone: '010-9315-2412', parentPhone: '010-3296-4370', seatType: 'ì§€ì •ì„_ë‚¨', seatNumber: '53' },
                { name: 'ì´ë„í—Œ', phone: '010-5676-1408', parentPhone: '', seatType: 'ì§€ì •ì„_ë‚¨', seatNumber: '54' },
                { name: 'ì‹¬íƒœìš©', phone: '010-2419-3398', parentPhone: '010-2854-0829', seatType: 'ì§€ì •ì„_ë‚¨', seatNumber: '55' },
                { name: 'ë¬¸í•˜ë¯¼', phone: '010-7116-8120', parentPhone: '010-2716-8120', seatType: 'ì§€ì •ì„_ë‚¨', seatNumber: '56' }
            ],
            7: [
                { name: 'ê¹€í•œë‚˜', phone: '010-5701-6330', parentPhone: '010-9117-3737', seatType: 'í”„ë¦¬ë¯¸ì—„', seatNumber: '1' },
                { name: 'ìœ¤ì„œì¤€', phone: '010-5861-5654', parentPhone: '010-2546-3622', seatType: 'í”„ë¦¬ë¯¸ì—„', seatNumber: '2' },
                { name: 'ë°•ì°¬ìš°', phone: '010-7531-9073', parentPhone: '010-4606-1607', seatType: 'í”„ë¦¬ë¯¸ì—„', seatNumber: '3' },
                { name: 'ì„±ì§€ì›', phone: '010-9269-3446', parentPhone: '010-8826-3446', seatType: 'í”„ë¦¬ë¯¸ì—„', seatNumber: '4' },
                { name: 'ê¶ŒëŒ€í¬', phone: '010-3012-0936', parentPhone: '010-2509-6280', seatType: 'í”„ë¦¬ë¯¸ì—„', seatNumber: '5' },
                { name: 'í™©ìˆ˜ì§„', phone: '010-5460-1051', parentPhone: '010-6621-1051', seatType: 'í”„ë¦¬ë¯¸ì—„', seatNumber: '6' },
                { name: 'ì†ìœ ì£¼', phone: '010-4644-2055', parentPhone: '010-2731-2055', seatType: 'í”„ë¦¬ë¯¸ì—„', seatNumber: '7' },
                { name: 'ê¹€í¬ì§„', phone: '010-7386-5651', parentPhone: '010-3257-5651', seatType: 'ì§€ì •ì„_ì—¬', seatNumber: '8' },
                { name: 'ì¡°ì„œì—°', phone: '010-2577-4062', parentPhone: '010-4524-4062', seatType: 'ì§€ì •ì„_ì—¬', seatNumber: '9' },
                { name: 'ê¹€ì¤€í¬', phone: '010-8348-9302', parentPhone: '010-3382-9302', seatType: 'ì§€ì •ì„_ì—¬', seatNumber: '10' },
                { name: 'ê¹€ì±„ì´', phone: '010-3765-7528', parentPhone: '010-5191-7528', seatType: 'ì§€ì •ì„_ì—¬', seatNumber: '11' },
                { name: 'ì´ì€êµ', phone: '010-4624-4576', parentPhone: '010-4569-4576', seatType: 'ì§€ì •ì„_ì—¬', seatNumber: '12' },
                { name: 'ì´ì„œì›', phone: '010-2407-9830', parentPhone: '010-3808-1799', seatType: 'ì§€ì •ì„_ì—¬', seatNumber: '13' },
                { name: 'ì´ê°•ìš°', phone: '010-9397-4649', parentPhone: '010-2744-4649', seatType: 'ì§€ì •ì„_ë‚¨', seatNumber: '14' },
                { name: 'ì„œê°•ë•', phone: '010-9160-2996', parentPhone: '010-5333-2996', seatType: 'ì§€ì •ì„_ë‚¨', seatNumber: '15' },
                { name: 'ë°•ìƒì–¸', phone: '010-5534-6518', parentPhone: '010-6275-6518', seatType: 'ì§€ì •ì„_ë‚¨', seatNumber: '16' },
                { name: 'ì¡°ì¸ì„±', phone: '010-7109-5804', parentPhone: '010-6604-5804', seatType: 'ì§€ì •ì„_ë‚¨', seatNumber: '17' },
                { name: 'ë°•ì„¸ì§„', phone: '010-3723-3890', parentPhone: '010-9429-3890', seatType: 'ì§€ì •ì„_ë‚¨', seatNumber: '18' },
                { name: 'ê¹€ë™ì¤€', phone: '010-6790-6263', parentPhone: '010-2792-6263', seatType: 'ì§€ì •ì„_ë‚¨', seatNumber: '19' },
                { name: 'ê³µíƒœë¯¼', phone: '010-5112-5372', parentPhone: '010-3275-5372', seatType: 'ì¹¸ë§‰ì´', seatNumber: '20' },
                { name: 'ì‹¬ê·œë¯¼', phone: '000-0000-0000', parentPhone: '010-2389-0123', seatType: 'ì¹¸ë§‰ì´', seatNumber: '21' },
                { name: 'ì´ì¬ë¹ˆ', phone: '010-6790-6264', parentPhone: '010-5645-3521', seatType: 'ì¹¸ë§‰ì´', seatNumber: '22' },
                { name: 'ê¹€íƒœìœ¤', phone: '000-0000-0000', parentPhone: '010-6471-2138', seatType: 'ì¹¸ë§‰ì´', seatNumber: '23' },
                { name: 'ìœ¤ì±„ì›', phone: '010-9842-2012', parentPhone: '010-9008-5012', seatType: 'ì¹¸ë§‰ì´', seatNumber: '24' },
                { name: 'ì •ì„±í˜¸', phone: '010-5093-6224', parentPhone: '010-6246-6224', seatType: 'ì¹¸ë§‰ì´', seatNumber: '25' },
                { name: 'í™ì§„ìš°', phone: '010-9927-6721', parentPhone: '010-9192-6721', seatType: 'ì¹¸ë§‰ì´', seatNumber: '26' },
                { name: 'ì¡°ê²½ìœ¨', phone: '010-4002-7196', parentPhone: '010-5480-9885', seatType: 'ì¹¸ë§‰ì´', seatNumber: '26' },
                { name: 'ì„ìŠ¹ì›', phone: '010-4085-4508', parentPhone: '010-4718-4508', seatType: 'ì¹¸ë§‰ì´', seatNumber: '27' },
                { name: 'ê°•ìœ ì˜¨', phone: '000-000-0000', parentPhone: '010-4575-6218', seatType: 'ì¹¸ë§‰ì´', seatNumber: '28' },
                { name: 'ìµœìœ¤í•˜', phone: '010-5028-5433', parentPhone: '010-3723-3777', seatType: 'ì¹¸ë§‰ì´', seatNumber: '29' },
                { name: 'ì´ë¯¼í˜', phone: '010-5909-6051', parentPhone: '010-3072-6051', seatType: 'ì¹¸ë§‰ì´', seatNumber: '31' },
                { name: 'ì´ì§„ìš°', phone: '010-7645-1273', parentPhone: '010-6663-1273', seatType: 'ì¹¸ë§‰ì´', seatNumber: '32' },
                { name: 'ì´ì„±ë¡', phone: '010-5792-7820', parentPhone: '010-2617-2575', seatType: 'ì¹¸ë§‰ì´', seatNumber: '33' },
                { name: 'ê¹€ë„ìœ¤', phone: '010-4594-1497', parentPhone: '010-4549-1497', seatType: 'ì¹¸ë§‰ì´', seatNumber: '35' },
                { name: 'ê¹€ì˜ˆë‚˜', phone: '010-7102-6607', parentPhone: '010-6695-6607', seatType: 'ì¹¸ë§‰ì´', seatNumber: '36' },
                { name: 'ê¹€ì‹œì™„', phone: '010-4995-3361', parentPhone: '010-3762-1861', seatType: 'ì¹¸ë§‰ì´', seatNumber: '37' },
                { name: 'ì „í˜¸ê²½', phone: '010-5942-7842', parentPhone: '010-4427-7842', seatType: 'ì¹¸ë§‰ì´', seatNumber: '38' },
                { name: 'í•œì˜ì§€', phone: '010-3488-8096', parentPhone: '010-2728-8096', seatType: 'ì¹¸ë§‰ì´', seatNumber: '39' },
                { name: 'ì´í˜¸ë¦¼', phone: '010-8079-3041', parentPhone: '010-3243-3041', seatType: 'ì¹¸ë§‰ì´', seatNumber: '40' },
                { name: 'êµ¬í˜„', phone: '010-2568-1852', parentPhone: '010-7523-1852', seatType: 'ì¹¸ë§‰ì´', seatNumber: '41' },
                { name: 'ì˜¤í˜„ì§€', phone: '010-4390-3265', parentPhone: '010-4371-0622', seatType: 'ì¹¸ë§‰ì´', seatNumber: '42' },
                { name: 'í™ìŠ¹ì›', phone: '010-5139-2970', parentPhone: '010-5156-4015', seatType: 'ì¹¸ë§‰ì´', seatNumber: '43' },
                { name: 'ê¹€ì°¬ì§„', phone: '010-9315-7387', parentPhone: '010-2216-7387', seatType: 'ì¹¸ë§‰ì´', seatNumber: '44' },
                { name: 'ê³ ê°€ë ¹', phone: '010-9011-3243', parentPhone: '010-5290-3243', seatType: 'ì¹¸ë§‰ì´', seatNumber: '45' },
                { name: 'ì „í˜„ì„œ', phone: '010-9882-8116', parentPhone: '010-3336-8116', seatType: 'ì¹¸ë§‰ì´', seatNumber: '46' },
                { name: 'ì§€í˜•ë¯¼', phone: '010-8799-6398', parentPhone: '010-8728-6398', seatType: 'ì¹¸ë§‰ì´', seatNumber: '47' }
            ]
        };

        let students = JSON.parse(JSON.stringify(defaultStudents));
        let paymentHistory = [];
        let recentStudents = [];
        let currentFloor = 8;
        let selectedStudent = null;
        let selectedPeriod = null;
        let selectedSeatFilter = 'ì „ì²´';
        let selectedDiscount = 0;
        let selectedTicketType = 'ì¢…ì¼ê¶Œ';
        let deleteTarget = null;

        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            updateCounts();
            renderSeatFilter();
            renderStudentList();
            renderPriceTable();
            renderRecentStudents();
            updateStats();
            renderHistory();
            updateModalSeatTypes();
            checkExpiringPayments(); // ë§Œë£Œ ì˜ˆì • ì²´í¬ ì¶”ê°€
            
            const savedTheme = localStorage.getItem('kimomma_theme');
            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                updateThemeIcon();
            }
        });

        // ë§Œë£Œ ì˜ˆì • ì²´í¬ í•¨ìˆ˜
        function checkExpiringPayments() {
            const now = new Date();
            const expiringList = [];
            
            paymentHistory.forEach(payment => {
                let endDate;
                
                // endDateê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ê³„ì‚°
                if (payment.endDate) {
                    endDate = new Date(payment.endDate);
                } else {
                    const startDate = new Date(payment.createdAt);
                    endDate = new Date(startDate);
                    endDate.setMonth(endDate.getMonth() + payment.period);
                }
                
                const daysLeft = Math.ceil((endDate - now) / (1000 * 60 * 60 * 24));
                
                // ë§Œë£Œë¨, ì˜¤ëŠ˜, 7ì¼ ì´ë‚´
                if (daysLeft <= 7) {
                    expiringList.push({
                        ...payment,
                        endDate: endDate,
                        daysLeft: daysLeft
                    });
                }
            });
            
            // ì¤‘ë³µ ì œê±° (ê°™ì€ í•™ìƒì˜ ìµœì‹  ê²°ì œë§Œ)
            const uniqueExpiring = [];
            const seenNames = new Set();
            expiringList.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            for (const item of expiringList) {
                const key = `${item.floor}-${item.name}`;
                if (!seenNames.has(key)) {
                    seenNames.add(key);
                    uniqueExpiring.push(item);
                }
            }
            
            // ë§Œë£Œì¼ ìˆœ ì •ë ¬
            uniqueExpiring.sort((a, b) => a.daysLeft - b.daysLeft);
            
            renderExpiringList(uniqueExpiring);
        }

        function renderExpiringList(list) {
            const card = document.getElementById('expiry-card');
            const container = document.getElementById('expiry-list');
            const countEl = document.getElementById('expiry-count');
            
            if (!list.length) {
                card.style.display = 'none';
                return;
            }
            
            card.style.display = 'block';
            countEl.textContent = `${list.length}ëª…`;
            
            container.innerHTML = list.map(item => {
                let badgeClass, badgeText;
                
                if (item.daysLeft < 0) {
                    badgeClass = 'expired';
                    badgeText = `${Math.abs(item.daysLeft)}ì¼ ì§€ë‚¨`;
                } else if (item.daysLeft === 0) {
                    badgeClass = 'today';
                    badgeText = 'ì˜¤ëŠ˜ ë§Œë£Œ';
                } else if (item.daysLeft <= 3) {
                    badgeClass = 'soon';
                    badgeText = `${item.daysLeft}ì¼ ë‚¨ìŒ`;
                } else {
                    badgeClass = 'upcoming';
                    badgeText = `${item.daysLeft}ì¼ ë‚¨ìŒ`;
                }
                
                const endStr = `${item.endDate.getMonth()+1}/${item.endDate.getDate()}`;
                
                return `
                    <div class="expiry-item">
                        <div class="info">
                            <span class="name">${item.name} (${item.floor}ì¸µ)</span>
                            <span class="detail">${item.seatType} Â· ë§Œë£Œì¼: ${endStr}</span>
                        </div>
                        <span class="expiry-badge ${badgeClass}">${badgeText}</span>
                    </div>
                `;
            }).join('');
        }

        function loadData() {
            const saved = localStorage.getItem('kimomma_students_v3');
            if (saved) students = JSON.parse(saved);
            const hist = localStorage.getItem('kimomma_history');
            if (hist) paymentHistory = JSON.parse(hist);
            const recent = localStorage.getItem('kimomma_recent');
            if (recent) recentStudents = JSON.parse(recent);
        }

        function saveData() {
            localStorage.setItem('kimomma_students_v3', JSON.stringify(students));
            localStorage.setItem('kimomma_history', JSON.stringify(paymentHistory));
            localStorage.setItem('kimomma_recent', JSON.stringify(recentStudents));
        }

        function switchSection(section) {
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(`section-${section}`).classList.add('active');
            if (section === 'stats') updateStats();
            if (section === 'history') renderHistory();
        }

        function selectFloor(floor) {
            currentFloor = floor;
            selectedStudent = null;
            selectedPeriod = null;
            selectedSeatFilter = 'ì „ì²´';
            document.querySelectorAll('.floor-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`.floor-tab.floor-${floor}`).classList.add('active');
            document.getElementById('calculation-card').style.display = 'none';
            renderSeatFilter();
            renderStudentList();
            renderPriceTable();
        }

        function updateCounts() {
            document.getElementById('floor8-count').textContent = `${students[8].length}ëª…`;
            document.getElementById('floor7-count').textContent = `${students[7].length}ëª…`;
        }

        function renderSeatFilter() {
            const container = document.getElementById('seat-filter');
            container.innerHTML = seatTypes[currentFloor].map(type => `
                <button class="seat-filter-btn ${selectedSeatFilter === type ? 'active' : ''}" 
                        onclick="filterBySeatType('${type}')">${type}</button>
            `).join('');
        }

        function filterBySeatType(type) {
            selectedSeatFilter = type;
            renderSeatFilter();
            renderStudentList();
        }

        function filterStudents() { renderStudentList(); }

        function renderStudentList() {
            const container = document.getElementById('student-list');
            const search = document.getElementById('student-search').value.toLowerCase();
            
            let filtered = students[currentFloor].filter((s, i) => {
                s._index = i;
                const normalizedType = normalizeSeatType(s.seatType);
                const matchesFilter = selectedSeatFilter === 'ì „ì²´' || 
                                      normalizedType === selectedSeatFilter ||
                                      s.seatType === selectedSeatFilter;
                return s.name.toLowerCase().includes(search) && matchesFilter;
            });
            
            if (!filtered.length) {
                container.innerHTML = '<div class="empty-state"><p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</p></div>';
                return;
            }
            
            container.innerHTML = filtered.map(s => {
                const displayType = normalizeSeatType(s.seatType);
                return `
                <div class="student-item ${selectedStudent?.name === s.name ? 'selected' : ''}" onclick="selectStudent(${s._index})">
                    <div class="student-info">
                        <span class="student-name">${s.name}</span>
                        <span class="student-detail">${s.seatNumber}ë²ˆ ì¢Œì„</span>
                    </div>
                    <div style="display:flex;align-items:center;">
                        <span class="seat-badge ${displayType}">${displayType}</span>
                        <div class="student-actions" onclick="event.stopPropagation()">
                            <button class="student-action-btn edit" onclick="openEditModal(${s._index})">
                                <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                </svg>
                            </button>
                            <button class="student-action-btn delete" onclick="openDeleteModal(${s._index}, '${s.name}')">
                                <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            `}).join('');
        }

        function selectStudent(index) {
            selectedStudent = students[currentFloor][index];
            selectedStudent._floor = currentFloor;
            selectedPeriod = null;
            selectedDiscount = 0;
            addToRecent(selectedStudent.name, currentFloor);
            
            document.getElementById('calculation-card').style.display = 'block';
            document.getElementById('selected-student-info').innerHTML = `
                <div class="name">${selectedStudent.name} (${currentFloor}ì¸µ)</div>
                <div class="details">
                    <div>ğŸ“ ${selectedStudent.seatType} ${selectedStudent.seatNumber}ë²ˆ</div>
                    <div>ğŸ“± ${selectedStudent.parentPhone || 'ë¯¸ë“±ë¡'}</div>
                </div>
            `;
            
            // ì´ˆê¸°í™”
            document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('selected'));
            document.getElementById('start-day').value = '1';
            document.getElementById('opt-locker').checked = false;
            document.getElementById('opt-mentoring').checked = false;
            document.getElementById('opt-register').checked = false;
            selectedTicketType = 'ì¢…ì¼ê¶Œ';
            document.querySelectorAll('.ticket-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.ticket === 'ì¢…ì¼ê¶Œ');
            });
            selectDiscount(0);
            updateMentoringPrice();
            document.getElementById('total-price').textContent = 'â‚©0';
            document.getElementById('price-breakdown').innerHTML = '';
            document.getElementById('copy-btn').disabled = true;
            document.getElementById('kakao-btn').disabled = true;
            document.getElementById('save-btn').disabled = true;
            
            renderStudentList();
            document.getElementById('calculation-card').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function addToRecent(name, floor) {
            const key = `${floor}-${name}`;
            recentStudents = recentStudents.filter(r => `${r.floor}-${r.name}` !== key);
            recentStudents.unshift({ name, floor });
            if (recentStudents.length > 5) recentStudents.pop();
            saveData();
            renderRecentStudents();
        }

        function renderRecentStudents() {
            const container = document.getElementById('recent-students');
            if (!recentStudents.length) { container.style.display = 'none'; return; }
            container.style.display = 'flex';
            container.innerHTML = recentStudents.map(r => `
                <div class="recent-student-chip" onclick="selectRecentStudent('${r.name}', ${r.floor})">${r.name} (${r.floor}ì¸µ)</div>
            `).join('');
        }

        function selectRecentStudent(name, floor) {
            if (currentFloor !== floor) selectFloor(floor);
            const idx = students[floor].findIndex(s => s.name === name);
            if (idx >= 0) selectStudent(idx);
        }

        function selectPeriod(months) {
            if (!selectedStudent) return;
            selectedPeriod = months;
            document.querySelectorAll('.period-btn').forEach(b => b.classList.toggle('selected', b.dataset.period == months));
            calculatePrice();
        }

        function toggleOption(type) {
            const checkbox = document.getElementById(`opt-${type}`);
            checkbox.checked = !checkbox.checked;
            const optionItem = checkbox.closest('.option-item');
            if (optionItem) {
                optionItem.classList.toggle('active', checkbox.checked);
            }
            calculatePrice();
        }

        function selectDiscount(rate) {
            selectedDiscount = rate;
            document.querySelectorAll('.discount-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.discount == rate);
            });
            calculatePrice();
        }

        function calculatePrice() {
            if (!selectedStudent || !selectedPeriod) return;
            
            const startDay = parseInt(document.getElementById('start-day').value);
            const hasLocker = document.getElementById('opt-locker').checked;
            const hasMentoring = document.getElementById('opt-mentoring').checked;
            const hasRegister = document.getElementById('opt-register').checked;
            const seatType = normalizeSeatType(selectedStudent.seatType);
            
            let seatPrice = 0;
            let seatPriceLabel = '';
            
            // 12ì›” ì¼í• ê³„ì‚° vs 1ì›”~ ì›”ì •ì•¡
            if (startDay === 1) {
                // 1ì¼ ì‹œì‘ = ì›”ì •ì•¡
                if (seatType === 'í”„ë¦¬ë¯¸ì—„') {
                    seatPrice = monthlyPrices.ì¢…ì¼ê¶Œ['í”„ë¦¬ë¯¸ì—„'];
                    seatPriceLabel = 'í”„ë¦¬ë¯¸ì—„';
                } else if (hasMentoring && (seatType === 'ì¹¸ë§‰ì´' || seatType === 'ì˜¤í”ˆí˜•')) {
                    const key = seatType + '_ë©˜í† ë§';
                    seatPrice = monthlyPrices[selectedTicketType][key] || monthlyPrices[selectedTicketType][seatType];
                    seatPriceLabel = `${seatType} (ë©˜í† ë§)`;
                } else {
                    seatPrice = monthlyPrices[selectedTicketType][seatType] || 0;
                    seatPriceLabel = seatType;
                }
            } else {
                // ì¼í• ê³„ì‚° (12ì›”)
                if (currentFloor === 8) {
                    const tableType = seatType === 'ì˜¤í”ˆí˜•' ? 'ì˜¤í”ˆí˜•' : seatType;
                    seatPrice = dailyPriceTable_8F[tableType] ? dailyPriceTable_8F[tableType][startDay] : 0;
                } else {
                    // 7ì¸µ (19ì¼~)
                    const tableType = seatType === 'ì˜¤í”ˆí˜•' ? 'ì˜¤í”ˆí˜•' : seatType;
                    seatPrice = dailyPriceTable_7F[tableType] ? dailyPriceTable_7F[tableType][startDay] : 0;
                }
                seatPriceLabel = `${seatType} (${startDay}ì¼ ì‹œì‘)`;
            }
            
            // ê¸°ê°„ì— ë”°ë¥¸ ê³„ì‚°
            let totalSeatPrice = seatPrice;
            if (selectedPeriod === 2) {
                // 2ê°œì›”: ì¼í•  + ë‹¤ìŒë‹¬ ì „ì²´
                let fullMonthPrice;
                if (seatType === 'í”„ë¦¬ë¯¸ì—„') {
                    fullMonthPrice = monthlyPrices.ì¢…ì¼ê¶Œ['í”„ë¦¬ë¯¸ì—„'];
                } else if (hasMentoring) {
                    const key = seatType + '_ë©˜í† ë§';
                    fullMonthPrice = monthlyPrices[selectedTicketType][key] || monthlyPrices[selectedTicketType][seatType];
                } else {
                    fullMonthPrice = monthlyPrices[selectedTicketType][seatType] || 0;
                }
                totalSeatPrice = seatPrice + fullMonthPrice;
            } else if (selectedPeriod === 3) {
                // 3ê°œì›”
                let fullMonthPrice;
                if (seatType === 'í”„ë¦¬ë¯¸ì—„') {
                    fullMonthPrice = monthlyPrices.ì¢…ì¼ê¶Œ['í”„ë¦¬ë¯¸ì—„'];
                } else if (hasMentoring) {
                    const key = seatType + '_ë©˜í† ë§';
                    fullMonthPrice = monthlyPrices[selectedTicketType][key] || monthlyPrices[selectedTicketType][seatType];
                } else {
                    fullMonthPrice = monthlyPrices[selectedTicketType][seatType] || 0;
                }
                totalSeatPrice = seatPrice + (fullMonthPrice * 2);
            }
            
            // í• ì¸ ì ìš© (ì¢Œì„ìš”ê¸ˆì—ë§Œ)
            const discountAmount = Math.round(totalSeatPrice * selectedDiscount / 100);
            const discountedSeatPrice = totalSeatPrice - discountAmount;
            
            // ì¶”ê°€ ì˜µì…˜
            const lockerFee = hasLocker ? LOCKER_FEE * selectedPeriod : 0;
            const registerFee = hasRegister ? REGISTER_FEE : 0;
            
            // ì´ì•¡
            const totalPrice = discountedSeatPrice + lockerFee + registerFee;
            
            document.getElementById('total-price').textContent = `â‚©${totalPrice.toLocaleString()}`;
            
            // ìƒì„¸ ë‚´ì—­
            let breakdown = `<div class="price-breakdown-item"><span>${selectedTicketType} ${seatPriceLabel} ${selectedPeriod}ê°œì›”</span><span>${totalSeatPrice.toLocaleString()}ì›</span></div>`;
            
            if (selectedDiscount > 0) {
                breakdown += `<div class="price-breakdown-item discount"><span>ğŸ·ï¸ í• ì¸ (${selectedDiscount}%)</span><span>-${discountAmount.toLocaleString()}ì›</span></div>`;
            }
            
            if (hasLocker) {
                breakdown += `<div class="price-breakdown-item add"><span>ğŸ” ì‚¬ë¬¼í•¨ (${selectedPeriod}ê°œì›”)</span><span>+${lockerFee.toLocaleString()}ì›</span></div>`;
            }
            
            if (hasRegister) {
                breakdown += `<div class="price-breakdown-item add"><span>ğŸ†• ìµœì´ˆê°€ì…ë¹„</span><span>+${registerFee.toLocaleString()}ì›</span></div>`;
            }
            
            breakdown += `<div class="price-breakdown-item total"><span>ì´ ê²°ì œê¸ˆì•¡</span><span>${totalPrice.toLocaleString()}ì›</span></div>`;
            
            document.getElementById('price-breakdown').innerHTML = breakdown;
            document.getElementById('copy-btn').disabled = false;
            document.getElementById('kakao-btn').disabled = false;
            document.getElementById('save-btn').disabled = false;
        }
        
        function selectTicketType(type) {
            selectedTicketType = type;
            document.querySelectorAll('.ticket-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.ticket === type);
            });
            
            // ë©˜í† ë§ ê°€ê²© ì—…ë°ì´íŠ¸
            updateMentoringPrice();
            calculatePrice();
        }
        
        function updateMentoringPrice() {
            const seatType = selectedStudent ? normalizeSeatType(selectedStudent.seatType) : 'ì¹¸ë§‰ì´';
            let priceDiff = 0;
            
            if (seatType === 'ì¹¸ë§‰ì´') {
                priceDiff = selectedTicketType === 'ì¢…ì¼ê¶Œ' ? 40000 : 100000;
            } else if (seatType === 'ì˜¤í”ˆí˜•') {
                priceDiff = selectedTicketType === 'ì¢…ì¼ê¶Œ' ? 0 : 60000;
            }
            
            const priceEl = document.getElementById('mentoring-price');
            if (priceEl) {
                priceEl.textContent = priceDiff > 0 ? `+${(priceDiff/10000).toFixed(0)}ë§Œì›` : 'í¬í•¨ì•ˆë¨';
            }
            
            // ë©˜í† ë§ ì˜µì…˜ í‘œì‹œ/ìˆ¨ê¹€
            const mentoringOption = document.getElementById('mentoring-option');
            if (mentoringOption) {
                if (seatType === 'í”„ë¦¬ë¯¸ì—„' || seatType === 'ììœ ì„') {
                    mentoringOption.style.display = 'none';
                } else {
                    mentoringOption.style.display = 'flex';
                }
            }
        }

        function getTotalPrice() {
            if (!selectedStudent || !selectedPeriod) return 0;
            
            const startDay = parseInt(document.getElementById('start-day').value);
            const hasLocker = document.getElementById('opt-locker').checked;
            const hasMentoring = document.getElementById('opt-mentoring').checked;
            const hasRegister = document.getElementById('opt-register').checked;
            const seatType = normalizeSeatType(selectedStudent.seatType);
            
            let seatPrice = 0;
            
            if (startDay === 1) {
                if (seatType === 'í”„ë¦¬ë¯¸ì—„') {
                    seatPrice = monthlyPrices.ì¢…ì¼ê¶Œ['í”„ë¦¬ë¯¸ì—„'];
                } else if (hasMentoring && (seatType === 'ì¹¸ë§‰ì´' || seatType === 'ì˜¤í”ˆí˜•')) {
                    const key = seatType + '_ë©˜í† ë§';
                    seatPrice = monthlyPrices[selectedTicketType][key] || monthlyPrices[selectedTicketType][seatType];
                } else {
                    seatPrice = monthlyPrices[selectedTicketType][seatType] || 0;
                }
            } else {
                if (currentFloor === 8) {
                    const tableType = seatType === 'ì˜¤í”ˆí˜•' ? 'ì˜¤í”ˆí˜•' : seatType;
                    seatPrice = dailyPriceTable_8F[tableType] ? dailyPriceTable_8F[tableType][startDay] : 0;
                } else {
                    const tableType = seatType === 'ì˜¤í”ˆí˜•' ? 'ì˜¤í”ˆí˜•' : seatType;
                    seatPrice = dailyPriceTable_7F[tableType] ? dailyPriceTable_7F[tableType][startDay] : 0;
                }
            }
            
            let totalSeatPrice = seatPrice;
            if (selectedPeriod === 2) {
                let fullMonthPrice;
                if (seatType === 'í”„ë¦¬ë¯¸ì—„') {
                    fullMonthPrice = monthlyPrices.ì¢…ì¼ê¶Œ['í”„ë¦¬ë¯¸ì—„'];
                } else if (hasMentoring) {
                    const key = seatType + '_ë©˜í† ë§';
                    fullMonthPrice = monthlyPrices[selectedTicketType][key] || monthlyPrices[selectedTicketType][seatType];
                } else {
                    fullMonthPrice = monthlyPrices[selectedTicketType][seatType] || 0;
                }
                totalSeatPrice = seatPrice + fullMonthPrice;
            } else if (selectedPeriod === 3) {
                let fullMonthPrice;
                if (seatType === 'í”„ë¦¬ë¯¸ì—„') {
                    fullMonthPrice = monthlyPrices.ì¢…ì¼ê¶Œ['í”„ë¦¬ë¯¸ì—„'];
                } else if (hasMentoring) {
                    const key = seatType + '_ë©˜í† ë§';
                    fullMonthPrice = monthlyPrices[selectedTicketType][key] || monthlyPrices[selectedTicketType][seatType];
                } else {
                    fullMonthPrice = monthlyPrices[selectedTicketType][seatType] || 0;
                }
                totalSeatPrice = seatPrice + (fullMonthPrice * 2);
            }
            
            const discountedSeatPrice = totalSeatPrice - Math.round(totalSeatPrice * selectedDiscount / 100);
            const lockerFee = hasLocker ? LOCKER_FEE * selectedPeriod : 0;
            const registerFee = hasRegister ? REGISTER_FEE : 0;
            
            return discountedSeatPrice + lockerFee + registerFee;
        }

        function copyPrice() {
            if (!selectedStudent || !selectedPeriod) return;
            const totalPrice = getTotalPrice();
            const startDay = parseInt(document.getElementById('start-day').value);
            const seatType = normalizeSeatType(selectedStudent.seatType);
            let text = `${selectedStudent.name} ${currentFloor}ì¸µ ${seatType} ${selectedTicketType} ${selectedPeriod}ê°œì›” (${startDay}ì¼ ì‹œì‘): ${totalPrice.toLocaleString()}ì›`;
            if (selectedDiscount > 0) text += ` (${selectedDiscount}% í• ì¸)`;
            navigator.clipboard.writeText(text);
            showToast('ê¸ˆì•¡ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤');
        }

        function copyKakaoMessage() {
            if (!selectedStudent || !selectedPeriod) return;
            
            const startDay = parseInt(document.getElementById('start-day').value);
            const hasLocker = document.getElementById('opt-locker').checked;
            const hasMentoring = document.getElementById('opt-mentoring').checked;
            const hasRegister = document.getElementById('opt-register').checked;
            const totalPrice = getTotalPrice();
            const seatType = normalizeSeatType(selectedStudent.seatType);
            
            const today = new Date();
            const startDate = new Date(today.getFullYear(), today.getMonth(), startDay);
            const endDate = new Date(startDate);
            endDate.setMonth(endDate.getMonth() + selectedPeriod);
            const fmt = d => `${d.getFullYear()}ë…„ ${d.getMonth()+1}ì›” ${d.getDate()}ì¼`;
            
            let details = `â€¢ ì´ìš©ê¶Œ: ${selectedTicketType}`;
            details += `\nâ€¢ ì¢Œì„: ${seatType}`;
            if (hasMentoring) details += ` (ë©˜í† ë§ í¬í•¨)`;
            if (selectedDiscount > 0) {
                details += `\nâ€¢ í• ì¸: ${selectedDiscount}%`;
            }
            if (hasLocker) {
                details += `\nâ€¢ ì‚¬ë¬¼í•¨: +${(LOCKER_FEE * selectedPeriod).toLocaleString()}ì›`;
            }
            if (hasRegister) {
                details += `\nâ€¢ ìµœì´ˆê°€ì…ë¹„: +${REGISTER_FEE.toLocaleString()}ì›`;
            }
            
            const msg = `ì•ˆë…•í•˜ì„¸ìš”, ê¹€ì—„ë§ˆë…ì„œì‹¤ì…ë‹ˆë‹¤ ğŸ“š

${selectedStudent.name} í•™ìƒ ì´ìš©ë£Œ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ ì´ìš© ì •ë³´
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ ì¸µ: ${currentFloor}ì¸µ
â€¢ ì¢Œì„ë²ˆí˜¸: ${selectedStudent.seatNumber}ë²ˆ
â€¢ ê¸°ê°„: ${selectedPeriod}ê°œì›”
â€¢ ë“±ì›ì¼: ${startDay}ì¼

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’° ê²°ì œ ë‚´ì—­
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
${details}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’³ ì´ ê²°ì œê¸ˆì•¡: ${totalPrice.toLocaleString()}ì›
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“… ì´ìš© ê¸°ê°„
${fmt(startDate)} ~ ${fmt(endDate)}

ê°ì‚¬í•©ë‹ˆë‹¤ ğŸ™`;
            navigator.clipboard.writeText(msg);
            showToast('ì¹´ì¹´ì˜¤í†¡ ë©”ì‹œì§€ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        }

        function savePayment() {
            if (!selectedStudent || !selectedPeriod) return;
            const totalPrice = getTotalPrice();
            const hasLocker = document.getElementById('opt-locker').checked;
            const hasMentoring = document.getElementById('opt-mentoring').checked;
            const hasRegister = document.getElementById('opt-register').checked;
            const startDay = parseInt(document.getElementById('start-day').value);
            const today = new Date();
            
            // ì‹œì‘ì¼ ê³„ì‚° (ì´ë²ˆë‹¬ì˜ startDayì¼)
            const startDate = new Date(today.getFullYear(), today.getMonth(), startDay);
            const endDate = new Date(startDate);
            endDate.setMonth(endDate.getMonth() + selectedPeriod);
            
            paymentHistory.unshift({
                id: Date.now(),
                name: selectedStudent.name,
                floor: currentFloor,
                seatType: normalizeSeatType(selectedStudent.seatType),
                seatNumber: selectedStudent.seatNumber,
                period: selectedPeriod,
                startDay: startDay,
                ticketType: selectedTicketType,
                amount: totalPrice,
                discount: selectedDiscount,
                locker: hasLocker,
                mentoring: hasMentoring,
                register: hasRegister,
                startDate: startDate.toISOString(),
                endDate: endDate.toISOString(),
                createdAt: today.toISOString()
            });
            saveData();
            showToast('ê²°ì œ ë‚´ì—­ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
            updateStats();
            checkExpiringPayments(); // ë§Œë£Œ ì˜ˆì • ë‹¤ì‹œ ì²´í¬
        }

        function renderPriceTable() {
            const container = document.getElementById('price-table');
            
            let html = `
            <div style="margin-bottom: 16px;">
                <div style="font-weight: 600; color: var(--primary); margin-bottom: 8px;">ğŸŒ ì¢…ì¼ê¶Œ (ë°©í•™)</div>
                <div class="price-table-row"><span class="label">í”„ë¦¬ë¯¸ì—„ (Nìˆ˜)</span><span class="value">79ë§Œì›</span></div>
                <div class="price-table-row"><span class="label">ì¹¸ë§‰ì´</span><span class="value">69ë§Œì›</span></div>
                <div class="price-table-row"><span class="label">ì¹¸ë§‰ì´ + ë©˜í† ë§</span><span class="value">73ë§Œì›</span></div>
                <div class="price-table-row"><span class="label">ì˜¤í”ˆí˜•</span><span class="value">63ë§Œì›</span></div>
                <div class="price-table-row"><span class="label">ììœ ì„</span><span class="value">49ë§Œì›</span></div>
            </div>
            
            <div style="margin-bottom: 16px;">
                <div style="font-weight: 600; color: var(--floor-7); margin-bottom: 8px;">ğŸŒ™ ì˜¤í›„ê¶Œ (í•™ê¸°ì¤‘)</div>
                <div class="price-table-row"><span class="label">ì¹¸ë§‰ì´</span><span class="value">55ë§Œì›</span></div>
                <div class="price-table-row"><span class="label">ì¹¸ë§‰ì´ + ë©˜í† ë§</span><span class="value">65ë§Œì›</span></div>
                <div class="price-table-row"><span class="label">ì˜¤í”ˆí˜•</span><span class="value">53ë§Œì›</span></div>
                <div class="price-table-row"><span class="label">ì˜¤í”ˆí˜• + ë©˜í† ë§</span><span class="value">59ë§Œì›</span></div>
                <div class="price-table-row"><span class="label">ììœ ì„</span><span class="value">39ë§Œì›</span></div>
            </div>
            
            <div style="padding: 12px; background: var(--gray-50); border-radius: 8px; font-size: 0.8125rem; color: var(--gray-600);">
                <strong>â• ì¶”ê°€ ì˜µì…˜</strong><br>
                â€¢ ğŸ†• ìµœì´ˆê°€ì…ë¹„: 10ë§Œì› (1íšŒ)<br>
                â€¢ ğŸ” ì‚¬ë¬¼í•¨: 2ë§Œì›/ì›”<br>
                â€¢ ğŸ·ï¸ í• ì¸: 10% / 20%<br><br>
                <strong>ğŸ“… ê³„ì‚° ê·œì¹™</strong><br>
                â€¢ 12ì›”: ë“±ì›ì¼ ê¸°ì¤€ ì¼í• ê³„ì‚°<br>
                â€¢ 1ì›”~: ì›”ì •ì•¡
            </div>`;
            
            container.innerHTML = html;
        }

        function updateStats() {
            document.getElementById('stat-total').textContent = students[7].length + students[8].length;
            document.getElementById('stat-floor7').textContent = students[7].length;
            document.getElementById('stat-floor8').textContent = students[8].length;
            
            const now = new Date();
            const monthPayments = paymentHistory.filter(p => {
                const d = new Date(p.createdAt);
                return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
            });
            document.getElementById('stat-payments').textContent = monthPayments.length;
            
            renderSeatChart(8, 'chart-floor8');
            renderSeatChart(7, 'chart-floor7');
        }

        function renderSeatChart(floor, containerId) {
            const container = document.getElementById(containerId);
            const types = seatTypes[floor].filter(t => t !== 'ì „ì²´');
            
            // ì¢Œì„ ìœ í˜•ë³„ ì¹´ìš´íŠ¸ (ë§¤í•‘ ì ìš©)
            const counts = {};
            types.forEach(type => counts[type] = 0);
            
            students[floor].forEach(s => {
                const normalizedType = normalizeSeatType(s.seatType);
                if (counts.hasOwnProperty(normalizedType)) {
                    counts[normalizedType]++;
                } else if (types.includes(s.seatType)) {
                    counts[s.seatType]++;
                }
            });
            
            const max = Math.max(...Object.values(counts), 1);
            
            container.innerHTML = types.map(type => {
                const count = counts[type] || 0;
                return `
                    <div class="seat-chart-row">
                        <span class="seat-chart-label">${type}</span>
                        <div class="seat-chart-bar-bg">
                            <div class="seat-chart-bar ${type}" style="width: ${(count/max)*100}%"></div>
                        </div>
                        <span class="seat-chart-count">${count}ëª…</span>
                    </div>
                `;
            }).join('');
        }

        function renderHistory() {
            const container = document.getElementById('history-list');
            if (!paymentHistory.length) {
                container.innerHTML = '<div class="empty-state"><p>ê²°ì œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</p></div>';
                return;
            }
            container.innerHTML = paymentHistory.map((item, i) => {
                const d = new Date(item.createdAt);
                const endDate = item.endDate ? new Date(item.endDate) : null;
                let extras = [];
                if (item.ticketType) extras.push(item.ticketType);
                if (item.discount) extras.push(`${item.discount}%í• ì¸`);
                if (item.locker) extras.push('ì‚¬ë¬¼í•¨');
                if (item.mentoring) extras.push('ë©˜í† ë§');
                if (item.register) extras.push('ê°€ì…ë¹„');
                const extrasText = extras.length ? ` (${extras.join(', ')})` : '';
                const startDayText = item.startDay ? `${item.startDay}ì¼ ì‹œì‘` : '';
                const endDateText = endDate ? ` â†’ ${endDate.getMonth()+1}/${endDate.getDate()} ë§Œë£Œ` : '';
                return `
                    <div class="history-item">
                        <div class="history-info">
                            <h4>${item.name} (${item.floor}ì¸µ)</h4>
                            <p>${item.seatType} ${item.seatNumber}ë²ˆ Â· ${item.period}ê°œì›”${extrasText}</p>
                            <p style="font-size: 0.75rem; color: var(--gray-400);">${d.getMonth()+1}/${d.getDate()} ${startDayText}${endDateText}</p>
                        </div>
                        <div style="display:flex;align-items:center;">
                            <span class="history-amount">â‚©${item.amount.toLocaleString()}</span>
                            <button class="history-delete" onclick="deleteHistory(${i})">
                                <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function deleteHistory(index) {
            paymentHistory.splice(index, 1);
            saveData();
            renderHistory();
            updateStats();
            checkExpiringPayments(); // ë§Œë£Œ ì˜ˆì • ë‹¤ì‹œ ì²´í¬
            showToast('ë‚´ì—­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
        }

        function exportHistory() {
            if (!paymentHistory.length) { showToast('ë‚´ë³´ë‚¼ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤', 'error'); return; }
            let csv = 'ì´ë¦„,ì¸µ,ì¢Œì„ìœ í˜•,ì¢Œì„ë²ˆí˜¸,ê¸°ê°„(ê°œì›”),ë“±ì›ì¼,ì´ìš©ê¶Œ,ê¸ˆì•¡,í• ì¸ìœ¨,ì‚¬ë¬¼í•¨,ë©˜í† ë§,ê°€ì…ë¹„,ê²°ì œì¼,ë§Œë£Œì¼\n';
            paymentHistory.forEach(item => {
                const d = new Date(item.createdAt);
                const endDate = item.endDate ? new Date(item.endDate) : null;
                const endStr = endDate ? `${endDate.getFullYear()}-${endDate.getMonth()+1}-${endDate.getDate()}` : '';
                csv += `${item.name},${item.floor}ì¸µ,${item.seatType},${item.seatNumber},${item.period},${item.startDay || 1}ì¼,${item.ticketType || 'ì¢…ì¼ê¶Œ'},${item.amount},${item.discount||0}%,${item.locker?'O':'X'},${item.mentoring?'O':'X'},${item.register?'O':'X'},${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()},${endStr}\n`;
            });
            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `ê¹€ì—„ë§ˆë…ì„œì‹¤_ê²°ì œë‚´ì—­_${new Date().toISOString().slice(0,10)}.csv`;
            link.click();
            showToast('CSV íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë©ë‹ˆë‹¤', 'success');
        }

        // ë°±ì—… ë‚´ë³´ë‚´ê¸°
        function exportBackup() {
            const backupData = {
                version: 'v2',
                exportDate: new Date().toISOString(),
                students: students,
                paymentHistory: paymentHistory,
                recentStudents: recentStudents
            };
            
            const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            const date = new Date().toISOString().slice(0,10);
            link.download = `ê¹€ì—„ë§ˆë…ì„œì‹¤_ë°±ì—…_${date}.json`;
            link.click();
            showToast('ë°±ì—… íŒŒì¼ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }

        // ë°±ì—… ë³µì›
        function importBackup(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬
                    if (!data.students || !data.students[7] || !data.students[8]) {
                        showToast('ì˜¬ë°”ë¥¸ ë°±ì—… íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤', 'error');
                        return;
                    }
                    
                    // í™•ì¸ ë©”ì‹œì§€
                    const studentCount = data.students[7].length + data.students[8].length;
                    const historyCount = data.paymentHistory ? data.paymentHistory.length : 0;
                    
                    if (confirm(`ë°±ì—… ë°ì´í„°ë¥¼ ë³µì›í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n` +
                               `â€¢ í•™ìƒ ìˆ˜: ${studentCount}ëª…\n` +
                               `â€¢ ê²°ì œ ë‚´ì—­: ${historyCount}ê±´\n` +
                               `â€¢ ë°±ì—… ë‚ ì§œ: ${data.exportDate ? data.exportDate.slice(0,10) : 'ì•Œ ìˆ˜ ì—†ìŒ'}\n\n` +
                               `âš ï¸ í˜„ì¬ ë°ì´í„°ê°€ ë®ì–´ì”Œì›Œì§‘ë‹ˆë‹¤!`)) {
                        
                        students = data.students;
                        paymentHistory = data.paymentHistory || [];
                        recentStudents = data.recentStudents || [];
                        
                        saveData();
                        updateCounts();
                        renderStudentList();
                        renderHistory();
                        updateStats();
                        renderRecentStudents();
                        checkExpiringPayments(); // ë§Œë£Œ ì˜ˆì • ì²´í¬ ì¶”ê°€
                        
                        showToast(`ë³µì› ì™„ë£Œ! (í•™ìƒ ${studentCount}ëª…, ë‚´ì—­ ${historyCount}ê±´)`, 'success');
                    }
                } catch (err) {
                    showToast('íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
                    console.error(err);
                }
            };
            reader.readAsText(file);
            event.target.value = ''; // ê°™ì€ íŒŒì¼ ë‹¤ì‹œ ì„ íƒ ê°€ëŠ¥í•˜ë„ë¡
        }

        function openAddModal() {
            document.getElementById('modal-title').textContent = 'ì‹ ê·œ í•™ìƒ ì¶”ê°€';
            document.getElementById('modal-submit').textContent = 'ì¶”ê°€í•˜ê¸°';
            document.getElementById('edit-index').value = '';
            document.getElementById('modal-name').value = '';
            document.getElementById('modal-floor').value = currentFloor;
            document.getElementById('modal-seat-number').value = '';
            document.getElementById('modal-student-phone').value = '';
            document.getElementById('modal-parent-phone').value = '';
            updateModalSeatTypes();
            document.getElementById('student-modal').classList.add('active');
        }

        function openEditModal(index) {
            const s = students[currentFloor][index];
            document.getElementById('modal-title').textContent = 'í•™ìƒ ì •ë³´ ìˆ˜ì •';
            document.getElementById('modal-submit').textContent = 'ì €ì¥í•˜ê¸°';
            document.getElementById('edit-index').value = index;
            document.getElementById('modal-name').value = s.name;
            document.getElementById('modal-floor').value = currentFloor;
            document.getElementById('modal-seat-number').value = s.seatNumber;
            document.getElementById('modal-student-phone').value = s.phone;
            document.getElementById('modal-parent-phone').value = s.parentPhone;
            updateModalSeatTypes();
            document.getElementById('modal-seat-type').value = s.seatType;
            document.getElementById('student-modal').classList.add('active');
        }

        function closeStudentModal() { document.getElementById('student-modal').classList.remove('active'); }

        function updateModalSeatTypes() {
            const floor = parseInt(document.getElementById('modal-floor').value);
            const sel = document.getElementById('modal-seat-type');
            sel.innerHTML = seatTypes[floor].filter(t => t !== 'ì „ì²´').map(t => `<option value="${t}">${t}</option>`).join('');
        }

        function saveStudent() {
            const editIdx = document.getElementById('edit-index').value;
            const name = document.getElementById('modal-name').value.trim();
            const floor = parseInt(document.getElementById('modal-floor').value);
            const seatType = document.getElementById('modal-seat-type').value;
            const seatNumber = document.getElementById('modal-seat-number').value.trim() || 'ë¯¸ì •';
            const phone = document.getElementById('modal-student-phone').value.trim();
            const parentPhone = document.getElementById('modal-parent-phone').value.trim();
            
            if (!name) { showToast('í•™ìƒ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error'); return; }
            
            const data = { name, phone, parentPhone, seatType, seatNumber };
            
            if (editIdx !== '') {
                students[currentFloor][parseInt(editIdx)] = data;
                showToast('í•™ìƒ ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
            } else {
                students[floor].push(data);
                showToast(`${name} í•™ìƒì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤`, 'success');
            }
            
            saveData();
            updateCounts();
            renderStudentList();
            updateStats();
            closeStudentModal();
        }

        function openDeleteModal(index, name) {
            deleteTarget = { index, floor: currentFloor };
            document.getElementById('delete-message').textContent = `"${name}" í•™ìƒì„ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
            document.getElementById('delete-modal').classList.add('active');
        }

        function closeDeleteModal() {
            document.getElementById('delete-modal').classList.remove('active');
            deleteTarget = null;
        }

        function confirmDelete() {
            if (!deleteTarget) return;
            students[deleteTarget.floor].splice(deleteTarget.index, 1);
            saveData();
            updateCounts();
            renderStudentList();
            updateStats();
            closeDeleteModal();
            showToast('í•™ìƒì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
        }

        function toggleTheme() {
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            document.documentElement.setAttribute('data-theme', isDark ? '' : 'dark');
            localStorage.setItem('kimomma_theme', isDark ? '' : 'dark');
            updateThemeIcon();
        }

        function updateThemeIcon() {
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            document.getElementById('theme-icon').innerHTML = isDark 
                ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>'
                : '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>';
        }

        function showToast(message, type = '') {
            const toast = document.getElementById('toast');
            toast.className = 'toast';
            if (type) toast.classList.add(type);
            document.getElementById('toast-message').textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2500);
        }
    </script>
</body>
</html>
