<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÍπÄÏóÑÎßàÎèÖÏÑúÏã§ Í≤∞Ï†ú Í≥ÑÏÇ∞Í∏∞ v2</title>
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ÍπÄÏóÑÎßàÎèÖÏÑúÏã§">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --primary-light: #dbeafe;
            --secondary: #f97316;
            --secondary-light: #ffedd5;
            --success: #10b981;
            --success-light: #d1fae5;
            --danger: #ef4444;
            --danger-light: #fee2e2;
            --warning: #f59e0b;
            --warning-light: #fef3c7;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --floor-7: #8b5cf6;
            --floor-7-light: #ede9fe;
            --floor-8: #0891b2;
            --floor-8-light: #cffafe;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
            --radius: 12px;
            --radius-lg: 16px;
        }

        [data-theme="dark"] {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --primary-light: #1e3a5f;
            --gray-50: #111827;
            --gray-100: #1f2937;
            --gray-200: #374151;
            --gray-300: #4b5563;
            --gray-400: #6b7280;
            --gray-500: #9ca3af;
            --gray-600: #d1d5db;
            --gray-700: #e5e7eb;
            --gray-800: #f3f4f6;
            --gray-900: #f9fafb;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 50%, #f0fdf4 100%);
            min-height: 100vh;
            color: var(--gray-800);
            line-height: 1.6;
            transition: background 0.3s ease, color 0.3s ease;
        }

        [data-theme="dark"] body {
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #0f172a 100%);
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 16px;
            padding-bottom: 100px;
        }

        .header {
            text-align: center;
            padding: 24px 0;
            margin-bottom: 16px;
            position: relative;
        }

        .header h1 {
            font-size: 1.75rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary) 0%, var(--floor-7) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 4px;
        }

        /* ÎØ∏ÎÇ©Ïûê ÌòÑÌô© Ïä§ÌÉÄÏùº */
        .payment-status-card {
            background: white;
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: var(--shadow);
        }
        
        .payment-status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .payment-status-title {
            font-weight: 600;
            font-size: 1rem;
            color: var(--gray-800);
        }
        
        .sync-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.8125rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .sync-btn:hover {
            background: var(--primary-dark);
        }
        
        .sync-btn:disabled {
            background: var(--gray-300);
            cursor: not-allowed;
        }
        
        .sync-btn.syncing {
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        .payment-summary {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .summary-box {
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }
        
        .summary-box.paid {
            background: var(--success-light);
            border: 1px solid var(--success);
        }
        
        .summary-box.unpaid {
            background: var(--danger-light);
            border: 1px solid var(--danger);
        }
        
        .summary-box .count {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .summary-box.paid .count { color: var(--success); }
        .summary-box.unpaid .count { color: var(--danger); }
        
        .summary-box .label {
            font-size: 0.75rem;
            color: var(--gray-600);
        }
        
        .unpaid-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--gray-200);
            border-radius: 8px;
        }
        
        .unpaid-item {
            padding: 10px 12px;
            border-bottom: 1px solid var(--gray-100);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.875rem;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .unpaid-item:hover {
            background: var(--gray-50);
        }
        
        .unpaid-item:last-child {
            border-bottom: none;
        }
        
        .unpaid-item .name {
            font-weight: 500;
        }
        
        .unpaid-item .info {
            color: var(--gray-500);
            font-size: 0.75rem;
        }
        
        .unpaid-item .amount {
            color: var(--danger);
            font-weight: 600;
        }
        
        .unpaid-item .copy-msg-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.6875rem;
            cursor: pointer;
            margin-left: 8px;
        }
        
        .unpaid-item .copy-msg-btn:hover {
            background: var(--primary-dark);
        }
        
        .unpaid-all-btn {
            width: 100%;
            background: var(--danger);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            margin-top: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .unpaid-all-btn:hover {
            background: #dc2626;
        }
        
        .sync-settings {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--gray-200);
        }
        
        .sync-url-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            font-size: 0.8125rem;
            margin-top: 8px;
        }
        
        .sync-status {
            font-size: 0.75rem;
            color: var(--gray-500);
            margin-top: 8px;
        }
        
        .student-payment-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.6875rem;
            font-weight: 500;
            margin-left: 6px;
        }
        
        .student-payment-badge.paid {
            background: var(--success-light);
            color: var(--success);
        }
        
        .student-payment-badge.unpaid {
            background: var(--danger-light);
            color: var(--danger);
        }
        
        .student-sheet-amount {
            font-size: 0.75rem;
            color: var(--gray-500);
        }

        .header .version {
            font-size: 0.875rem;
            color: var(--gray-500);
            font-weight: 500;
        }

        .header-actions {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            width: 40px;
            height: 40px;
            border: none;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-600);
            box-shadow: var(--shadow);
            transition: all 0.2s ease;
        }

        .icon-btn:hover {
            background: var(--gray-100);
            transform: scale(1.05);
        }

        [data-theme="dark"] .icon-btn {
            background: var(--gray-100);
        }

        .nav-tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 16px;
            background: white;
            padding: 4px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
        }

        [data-theme="dark"] .nav-tabs { background: var(--gray-100); }

        .nav-tab {
            flex: 1;
            padding: 12px 8px;
            border: none;
            border-radius: var(--radius);
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            background: transparent;
            color: var(--gray-500);
        }

        .nav-tab.active {
            background: var(--primary);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .nav-tab:not(.active):hover { background: var(--gray-100); }

        .section { display: none; }
        .section.active { display: block; }

        .floor-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            background: white;
            padding: 6px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
        }

        [data-theme="dark"] .floor-tabs { background: var(--gray-100); }

        .floor-tab {
            flex: 1;
            padding: 14px 16px;
            border: none;
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background: var(--gray-100);
            color: var(--gray-600);
        }

        .floor-tab.floor-8.active {
            background: var(--floor-8);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .floor-tab.floor-7.active {
            background: var(--floor-7);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .floor-tab .count {
            background: rgba(255,255,255,0.3);
            padding: 2px 8px;
            border-radius: 20px;
            font-size: 0.75rem;
        }

        .floor-tab:not(.active) .count { background: var(--gray-200); }

        .card {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
            margin-bottom: 16px;
            overflow: hidden;
        }

        [data-theme="dark"] .card { background: var(--gray-100); }

        .card-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-header h2 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--gray-800);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-header .icon { width: 20px; height: 20px; }
        .card-body { padding: 16px 20px; }

        .seat-filter {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }

        .seat-filter-btn {
            padding: 8px 14px;
            border: 1px solid var(--gray-200);
            border-radius: 20px;
            background: white;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--gray-600);
        }

        [data-theme="dark"] .seat-filter-btn {
            background: var(--gray-200);
            border-color: var(--gray-300);
        }

        .seat-filter-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .seat-filter-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .search-box {
            position: relative;
            margin-bottom: 12px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 16px 12px 44px;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius);
            font-size: 0.9375rem;
            outline: none;
            transition: all 0.2s ease;
            background: white;
            color: var(--gray-800);
        }

        [data-theme="dark"] .search-box input {
            background: var(--gray-200);
            border-color: var(--gray-300);
        }

        .search-box input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-light);
        }

        .search-box .search-icon {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            color: var(--gray-400);
        }

        .student-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius);
        }

        .student-item {
            padding: 12px 16px;
            border-bottom: 1px solid var(--gray-100);
            cursor: pointer;
            transition: all 0.15s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .student-item:last-child { border-bottom: none; }
        .student-item:hover { background: var(--gray-50); }
        .student-item.selected { background: var(--primary-light); }

        .student-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .student-name {
            font-weight: 600;
            font-size: 0.9375rem;
            color: var(--gray-800);
        }

        .student-detail {
            font-size: 0.8125rem;
            color: var(--gray-500);
        }

        .student-actions {
            display: flex;
            gap: 4px;
        }

        .student-action-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: var(--gray-100);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-500);
            transition: all 0.2s ease;
        }

        .student-action-btn:hover { background: var(--gray-200); }
        .student-action-btn.edit:hover { background: var(--primary-light); color: var(--primary); }
        .student-action-btn.delete:hover { background: var(--danger-light); color: var(--danger); }

        .seat-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 8px;
        }

        .seat-badge.ÏûêÏú†ÏÑù { background: #fef3c7; color: #92400e; }
        .seat-badge.Ïò§ÌîàÌòï { background: #dbeafe; color: #1e40af; }
        .seat-badge.Ïπ∏ÎßâÏù¥ { background: #d1fae5; color: #065f46; }
        .seat-badge.ÌîÑÎ¶¨ÎØ∏ÏóÑ { background: #fce7f3; color: #9d174d; }
        .seat-badge.ÏßÄÏ†ïÏÑù_Ïó¨ { background: #dbeafe; color: #1e40af; }
        .seat-badge.ÏßÄÏ†ïÏÑù_ÎÇ® { background: #dbeafe; color: #1e40af; }
        .seat-badge.ÏßÄÏ†ïÏÑù { background: #dbeafe; color: #1e40af; }

        .selected-student-card {
            background: linear-gradient(135deg, var(--primary-light) 0%, #eff6ff 100%);
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 16px;
            border: 1px solid var(--primary);
        }

        [data-theme="dark"] .selected-student-card {
            background: linear-gradient(135deg, var(--primary-light) 0%, #1e3a5f 100%);
        }

        .selected-student-card .name {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .selected-student-card .details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            font-size: 0.875rem;
            color: var(--gray-600);
        }

        .period-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .period-btn {
            padding: 12px 8px;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius);
            background: white;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            color: var(--gray-700);
        }

        [data-theme="dark"] .period-btn {
            background: var(--gray-200);
            border-color: var(--gray-300);
        }

        .period-btn:hover {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .period-btn.selected {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .period-btn .weeks {
            display: block;
            font-size: 0.75rem;
            color: var(--gray-500);
            margin-top: 2px;
        }

        .period-btn.selected .weeks { color: rgba(255,255,255,0.8); }

        /* ÏòµÏÖò ÏÑπÏÖò Ïä§ÌÉÄÏùº */
        .options-section {
            background: var(--gray-50);
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 16px;
        }

        [data-theme="dark"] .options-section { background: var(--gray-200); }

        .options-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .option-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            border: 1px solid var(--gray-200);
            transition: all 0.2s;
        }

        [data-theme="dark"] .option-item { background: var(--gray-100); }

        .option-item:hover { border-color: var(--primary); }

        .option-item.active {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .option-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--primary);
            cursor: pointer;
        }

        .option-item .option-label {
            flex: 1;
            font-size: 0.9375rem;
            color: var(--gray-700);
        }

        .option-item .option-value {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--primary);
        }

        .discount-btn-group {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .discount-btn {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            background: white;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            text-align: center;
            color: var(--gray-600);
            transition: all 0.2s;
        }

        [data-theme="dark"] .discount-btn { background: var(--gray-100); }

        .discount-btn:hover {
            border-color: var(--warning);
            color: var(--warning);
        }

        .discount-btn.active {
            background: var(--warning);
            border-color: var(--warning);
            color: white;
        }

        .option-input-group {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            background: white;
            border-radius: 8px;
            border: 1px solid var(--gray-200);
        }

        [data-theme="dark"] .option-input-group { background: var(--gray-100); }

        .option-input-group label {
            font-size: 0.875rem;
            color: var(--gray-600);
            white-space: nowrap;
        }

        .option-input-group input {
            flex: 1;
            padding: 8px 10px;
            border: 1px solid var(--gray-200);
            border-radius: 6px;
            font-size: 0.875rem;
            outline: none;
            background: var(--gray-50);
            max-width: 120px;
        }

        .option-input-group input:focus { border-color: var(--primary); }

        .price-display {
            background: linear-gradient(135deg, var(--gray-800) 0%, var(--gray-900) 100%);
            border-radius: var(--radius-lg);
            padding: 24px;
            text-align: center;
            color: white;
            margin-bottom: 16px;
        }

        .price-label {
            font-size: 0.875rem;
            color: var(--gray-400);
            margin-bottom: 8px;
        }

        .price-amount {
            font-size: 2.5rem;
            font-weight: 700;
            letter-spacing: -1px;
        }

        .price-breakdown {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--gray-700);
            font-size: 0.8125rem;
            color: var(--gray-400);
            text-align: left;
        }

        .price-breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
        }

        .price-breakdown-item.discount { color: var(--warning); }
        .price-breakdown-item.add { color: var(--success); }
        .price-breakdown-item.total {
            border-top: 1px solid var(--gray-600);
            margin-top: 8px;
            padding-top: 8px;
            font-weight: 600;
            color: white;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .action-btn {
            padding: 16px;
            border: none;
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .action-btn.primary { background: var(--primary); color: white; }
        .action-btn.primary:hover { background: var(--primary-dark); transform: translateY(-1px); box-shadow: var(--shadow-md); }
        .action-btn.kakao { background: #FEE500; color: #191919; }
        .action-btn.kakao:hover { background: #E6CF00; transform: translateY(-1px); }
        .action-btn.success { background: var(--success); color: white; }
        .action-btn.success:hover { background: #059669; transform: translateY(-1px); }
        .action-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none !important; }

        .add-student-btn {
            width: 100%;
            padding: 12px;
            border: 2px dashed var(--gray-300);
            border-radius: var(--radius);
            background: transparent;
            color: var(--gray-500);
            font-size: 0.9375rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 12px;
        }

        .add-student-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
            background: var(--primary-light);
        }

        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 16px;
        }

        .modal-overlay.active { display: flex; }

        .modal {
            background: white;
            border-radius: var(--radius-lg);
            width: 100%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }

        [data-theme="dark"] .modal { background: var(--gray-100); }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-header h3 {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--gray-800);
        }

        .modal-close {
            width: 32px; height: 32px;
            border: none;
            background: var(--gray-100);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-500);
            transition: all 0.2s ease;
        }

        .modal-close:hover { background: var(--gray-200); color: var(--gray-700); }
        .modal-body { padding: 20px; }

        .form-group { margin-bottom: 16px; }

        .form-group label {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 6px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius);
            font-size: 0.9375rem;
            outline: none;
            transition: all 0.2s ease;
            background: white;
            color: var(--gray-800);
        }

        [data-theme="dark"] .form-group input,
        [data-theme="dark"] .form-group select {
            background: var(--gray-200);
            border-color: var(--gray-300);
        }

        .form-group input:focus,
        .form-group select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-light);
        }

        .modal-footer {
            padding: 16px 20px;
            border-top: 1px solid var(--gray-200);
            display: flex;
            gap: 12px;
        }

        .modal-footer button {
            flex: 1;
            padding: 12px;
            border-radius: var(--radius);
            font-size: 0.9375rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-cancel { background: var(--gray-100); border: none; color: var(--gray-600); }
        .btn-cancel:hover { background: var(--gray-200); }
        .btn-submit { background: var(--primary); border: none; color: white; }
        .btn-submit:hover { background: var(--primary-dark); }
        .btn-danger { background: var(--danger); border: none; color: white; }
        .btn-danger:hover { background: #dc2626; }

        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--gray-800);
            color: white;
            padding: 14px 24px;
            border-radius: var(--radius);
            font-size: 0.9375rem;
            font-weight: 500;
            box-shadow: var(--shadow-lg);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        .toast.success { background: var(--success); }
        .toast.error { background: var(--danger); }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray-500);
        }

        .empty-state .icon {
            width: 48px; height: 48px;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        .price-table { margin-top: 8px; }

        .price-table-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--gray-100);
            font-size: 0.875rem;
        }

        .price-table-row:last-child { border-bottom: none; }
        .price-table-row .label { color: var(--gray-600); }
        .price-table-row .value { font-weight: 600; color: var(--gray-800); }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        .stat-card {
            background: white;
            border-radius: var(--radius);
            padding: 16px;
            text-align: center;
            box-shadow: var(--shadow);
        }

        [data-theme="dark"] .stat-card { background: var(--gray-100); }

        .stat-card .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-card .stat-label {
            font-size: 0.8125rem;
            color: var(--gray-500);
            margin-top: 4px;
        }

        .stat-card.floor-8 .stat-value { color: var(--floor-8); }
        .stat-card.floor-7 .stat-value { color: var(--floor-7); }

        .seat-chart { margin-top: 16px; }

        .seat-chart-row {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .seat-chart-label {
            width: 80px;
            font-size: 0.8125rem;
            color: var(--gray-600);
        }

        .seat-chart-bar-bg {
            flex: 1;
            height: 24px;
            background: var(--gray-100);
            border-radius: 12px;
            overflow: hidden;
        }

        .seat-chart-bar {
            height: 100%;
            border-radius: 12px;
            transition: width 0.5s ease;
        }

        .seat-chart-bar.ÏûêÏú†ÏÑù { background: linear-gradient(90deg, #fbbf24, #f59e0b); }
        .seat-chart-bar.Ïò§ÌîàÌòï { background: linear-gradient(90deg, #3b82f6, #2563eb); }
        .seat-chart-bar.Ïπ∏ÎßâÏù¥ { background: linear-gradient(90deg, #10b981, #059669); }
        .seat-chart-bar.ÌîÑÎ¶¨ÎØ∏ÏóÑ { background: linear-gradient(90deg, #f59e0b, #d97706); }

        .seat-chart-count {
            width: 50px;
            text-align: right;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--gray-700);
        }

        .history-item {
            padding: 16px;
            border-bottom: 1px solid var(--gray-100);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-item:last-child { border-bottom: none; }

        .history-info h4 {
            font-size: 0.9375rem;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 4px;
        }

        .history-info p {
            font-size: 0.8125rem;
            color: var(--gray-500);
        }

        .history-amount {
            font-size: 1rem;
            font-weight: 700;
            color: var(--primary);
        }

        .history-delete {
            margin-left: 12px;
            width: 28px; height: 28px;
            border: none;
            background: var(--gray-100);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-400);
            transition: all 0.2s ease;
        }

        .history-delete:hover { background: var(--danger-light); color: var(--danger); }

        .recent-students {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            overflow-x: auto;
            padding-bottom: 8px;
        }

        .recent-student-chip {
            flex-shrink: 0;
            padding: 8px 14px;
            background: var(--primary-light);
            border: 1px solid var(--primary);
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--primary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .recent-student-chip:hover { background: var(--primary); color: white; }

        .student-list::-webkit-scrollbar,
        .recent-students::-webkit-scrollbar { width: 6px; height: 6px; }

        .student-list::-webkit-scrollbar-track,
        .recent-students::-webkit-scrollbar-track { background: var(--gray-100); border-radius: 3px; }

        .student-list::-webkit-scrollbar-thumb,
        .recent-students::-webkit-scrollbar-thumb { background: var(--gray-300); border-radius: 3px; }

        /* ÎßåÎ£å ÏòàÏ†ï ÏïåÎ¶º Ïä§ÌÉÄÏùº */
        .expiry-card { border: 2px solid #f59e0b; }
        
        .expiry-count {
            background: #ef4444;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .expiry-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 20px;
            border-bottom: 1px solid var(--gray-100);
        }

        .expiry-item:last-child { border-bottom: none; }

        .expiry-item .info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .expiry-item .name {
            font-weight: 600;
            font-size: 0.9375rem;
            color: var(--gray-800);
        }

        .expiry-item .detail {
            font-size: 0.8125rem;
            color: var(--gray-500);
        }

        .expiry-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .expiry-badge.expired {
            background: #fee2e2;
            color: #dc2626;
        }

        .expiry-badge.today {
            background: #fee2e2;
            color: #dc2626;
        }

        .expiry-badge.soon {
            background: #fef3c7;
            color: #d97706;
        }

        .expiry-badge.upcoming {
            background: #dbeafe;
            color: #2563eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö ÍπÄÏóÑÎßàÎèÖÏÑúÏã§</h1>
            <div class="version">Í≤∞Ï†ú Í≥ÑÏÇ∞Í∏∞ v2</div>
            <div class="header-actions">
                <button class="icon-btn" onclick="toggleTheme()" title="Îã§ÌÅ¨Î™®Îìú">
                    <svg id="theme-icon" width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- ÎØ∏ÎÇ©Ïûê ÌòÑÌô© Ïπ¥Îìú -->
        <div class="payment-status-card" id="payment-status-card">
            <div class="payment-status-header">
                <span class="payment-status-title">üí∞ Í≤∞Ï†ú ÌòÑÌô© (<span id="current-floor-status">8Ï∏µ</span>)</span>
                <button class="sync-btn" id="sync-btn" onclick="syncWithSheet()">
                    üîÑ ÎèôÍ∏∞Ìôî
                </button>
            </div>
            
            <div class="payment-summary">
                <div class="summary-box paid">
                    <div class="count" id="paid-count">-</div>
                    <div class="label">ÏàòÎÇ© ÏôÑÎ£å</div>
                </div>
                <div class="summary-box unpaid">
                    <div class="count" id="unpaid-count">-</div>
                    <div class="label">ÎØ∏ÎÇ©</div>
                </div>
            </div>
            
            <div id="unpaid-section" style="display: none;">
                <div style="font-size: 0.8125rem; font-weight: 600; margin-bottom: 8px; color: var(--danger);">‚ö†Ô∏è ÎØ∏ÎÇ©Ïûê Î™©Î°ù</div>
                <div class="unpaid-list" id="unpaid-list"></div>
            </div>
            
            <div class="sync-settings">
                <details>
                    <summary style="cursor: pointer; font-size: 0.8125rem; color: var(--gray-600);">‚öôÔ∏è ÎèôÍ∏∞Ìôî ÏÑ§Ï†ï</summary>
                    <input type="text" class="sync-url-input" id="sync-url" placeholder="Google Apps Script URL ÏûÖÎ†•" onchange="saveSyncUrl()">
                    <div class="sync-status" id="sync-status">ÎèôÍ∏∞ÌôîÎêòÏßÄ ÏïäÏùå</div>
                </details>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchSection('calculator')">üí∞ Í≥ÑÏÇ∞Í∏∞</button>
            <button class="nav-tab" onclick="switchSection('stats')">üìä ÌÜµÍ≥Ñ</button>
            <button class="nav-tab" onclick="switchSection('history')">üìã ÎÇ¥Ïó≠</button>
        </div>

        <!-- Calculator Section -->
        <div class="section active" id="section-calculator">
            <!-- ÎßåÎ£å ÏòàÏ†ï ÏïåÎ¶º -->
            <div class="card expiry-card" id="expiry-card" style="display: none;">
                <div class="card-header" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-bottom: none;">
                    <h2 style="color: #92400e;">
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        Í≤∞Ï†ú ÎßåÎ£å ÏòàÏ†ï
                    </h2>
                    <span class="expiry-count" id="expiry-count">0Î™Ö</span>
                </div>
                <div class="card-body" style="padding: 0;">
                    <div id="expiry-list"></div>
                </div>
            </div>

            <div class="floor-tabs">
                <button class="floor-tab floor-8 active" onclick="selectFloor(8)">
                    <span>8Ï∏µ</span>
                    <span class="count" id="floor8-count">115Î™Ö</span>
                </button>
                <button class="floor-tab floor-7" onclick="selectFloor(7)">
                    <span>7Ï∏µ</span>
                    <span class="count" id="floor7-count">46Î™Ö</span>
                </button>
            </div>

            <div class="recent-students" id="recent-students" style="display: none;"></div>

            <div class="card">
                <div class="card-header">
                    <h2>
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        ÌïôÏÉù ÏÑ†ÌÉù
                    </h2>
                </div>
                <div class="card-body">
                    <div class="seat-filter" id="seat-filter"></div>
                    <div class="search-box">
                        <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                        <input type="text" id="student-search" placeholder="ÌïôÏÉù Ïù¥Î¶Ñ Í≤ÄÏÉâ..." oninput="filterStudents()">
                    </div>
                    <div class="student-list" id="student-list"></div>
                    <button class="add-student-btn" onclick="openAddModal()">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                        </svg>
                        Ïã†Í∑ú ÌïôÏÉù Ï∂îÍ∞Ä
                    </button>
                </div>
            </div>

            <div class="card" id="calculation-card" style="display: none;">
                <div class="card-header">
                    <h2>
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                        </svg>
                        Í≤∞Ï†ú Í≥ÑÏÇ∞
                    </h2>
                </div>
                <div class="card-body">
                    <div class="selected-student-card" id="selected-student-info"></div>
                    
                    <div class="form-group">
                        <label>Ïù¥Ïö© Í∏∞Í∞Ñ</label>
                        <div class="period-grid">
                            <button class="period-btn" onclick="selectPeriod(1)" data-period="1">1Í∞úÏõî<span class="weeks">4Ï£º</span></button>
                            <button class="period-btn" onclick="selectPeriod(2)" data-period="2">2Í∞úÏõî<span class="weeks">8Ï£º</span></button>
                            <button class="period-btn" onclick="selectPeriod(3)" data-period="3">3Í∞úÏõî<span class="weeks">12Ï£º</span></button>
                        </div>
                    </div>

                    <!-- Í≥ÑÏÇ∞ Î∞©Ïãù ÏÑ†ÌÉù -->
                    <div class="form-group">
                        <label>Í≥ÑÏÇ∞ Î∞©Ïãù</label>
                        <div class="discount-btn-group">
                            <button class="discount-btn calc-type-btn active" data-calc="daily" onclick="selectCalcType('daily')">üìÖ ÏùºÌï†Í≥ÑÏÇ∞</button>
                            <button class="discount-btn calc-type-btn" data-calc="monthly" onclick="selectCalcType('monthly')">üìÜ ÏõîÍ≥ÑÏÇ∞</button>
                        </div>
                    </div>

                    <!-- Îì±ÏõêÏùº ÏÑ†ÌÉù (ÏùºÌï†Í≥ÑÏÇ∞Ïö©) -->
                    <div class="form-group" id="start-day-group">
                        <label>Îì±Ïõê ÏãúÏûëÏùº</label>
                        <select id="start-day" onchange="calculatePrice()">
                            <option value="1">1Ïùº</option>
                            <option value="2">2Ïùº</option>
                            <option value="3">3Ïùº</option>
                            <option value="4">4Ïùº</option>
                            <option value="5">5Ïùº</option>
                            <option value="6">6Ïùº</option>
                            <option value="7">7Ïùº</option>
                            <option value="8">8Ïùº</option>
                            <option value="9">9Ïùº</option>
                            <option value="10">10Ïùº</option>
                            <option value="11">11Ïùº</option>
                            <option value="12">12Ïùº</option>
                            <option value="13">13Ïùº</option>
                            <option value="14">14Ïùº</option>
                            <option value="15">15Ïùº</option>
                            <option value="16">16Ïùº</option>
                            <option value="17">17Ïùº</option>
                            <option value="18">18Ïùº</option>
                            <option value="19">19Ïùº</option>
                            <option value="20">20Ïùº</option>
                            <option value="21">21Ïùº</option>
                            <option value="22">22Ïùº</option>
                            <option value="23">23Ïùº</option>
                            <option value="24">24Ïùº</option>
                            <option value="25">25Ïùº</option>
                            <option value="26">26Ïùº</option>
                            <option value="27">27Ïùº</option>
                            <option value="28">28Ïùº</option>
                            <option value="29">29Ïùº</option>
                            <option value="30">30Ïùº</option>
                            <option value="31">31Ïùº</option>
                        </select>
                        <p style="font-size: 0.75rem; color: var(--gray-500); margin-top: 4px;">* Ìï¥Îãπ ÏõîÏùò ÎÇ®ÏùÄ ÏùºÏàòÎ°ú Í≥ÑÏÇ∞Îê©ÎãàÎã§</p>
                    </div>

                    <!-- Ï∂îÍ∞Ä ÏòµÏÖò ÏÑπÏÖò -->
                    <div class="options-section">
                        <div class="options-title">‚öôÔ∏è Ïù¥Ïö©Í∂å ÏÑ†ÌÉù</div>
                        
                        <!-- Ï¢ÖÏùºÍ∂å/Ïò§ÌõÑÍ∂å ÏÑ†ÌÉù -->
                        <div class="discount-btn-group">
                            <button class="discount-btn ticket-btn active" data-ticket="Ï¢ÖÏùºÍ∂å" onclick="selectTicketType('Ï¢ÖÏùºÍ∂å')">üåû Ï¢ÖÏùºÍ∂å</button>
                            <button class="discount-btn ticket-btn" data-ticket="Ïò§ÌõÑÍ∂å" onclick="selectTicketType('Ïò§ÌõÑÍ∂å')">üåô Ïò§ÌõÑÍ∂å</button>
                        </div>
                        <p style="font-size: 0.75rem; color: var(--gray-500); margin-bottom: 12px;">* Î∞©Ìïô: Ï¢ÖÏùºÍ∂å / ÌïôÍ∏∞Ï§ë: Ïò§ÌõÑÍ∂å (NÏàòÏÉù Ï†úÏô∏)</p>
                        
                        <!-- Ïò¨ÏºÄÏñ¥ ÏÑ†ÌÉù -->
                        <div class="options-title" style="margin-top: 4px;">üè• Ïò¨ÏºÄÏñ¥ ÏÑ†ÌÉù</div>
                        <div class="option-input-group">
                            <label>Ïò¨ÏºÄÏñ¥ Í∏àÏï°</label>
                            <select id="allcare-select" onchange="selectAllcare(this.value)" style="max-width: 150px;">
                                <option value="0">ÏóÜÏùå</option>
                                <option value="10000">1ÎßåÏõê</option>
                                <option value="20000">2ÎßåÏõê</option>
                                <option value="30000">3ÎßåÏõê</option>
                                <option value="40000">4ÎßåÏõê</option>
                                <option value="50000">5ÎßåÏõê</option>
                                <option value="60000">6ÎßåÏõê</option>
                                <option value="70000">7ÎßåÏõê</option>
                                <option value="80000">8ÎßåÏõê</option>
                                <option value="90000">9ÎßåÏõê</option>
                                <option value="100000">10ÎßåÏõê</option>
                                <option value="110000">11ÎßåÏõê</option>
                                <option value="120000">12ÎßåÏõê</option>
                                <option value="130000">13ÎßåÏõê</option>
                                <option value="140000">14ÎßåÏõê</option>
                                <option value="150000">15ÎßåÏõê</option>
                                <option value="160000">16ÎßåÏõê</option>
                                <option value="170000">17ÎßåÏõê</option>
                                <option value="180000">18ÎßåÏõê</option>
                                <option value="190000">19ÎßåÏõê</option>
                                <option value="200000">20ÎßåÏõê</option>
                            </select>
                            <span style="font-size: 0.8rem; color: var(--gray-500);">/Ïõî</span>
                        </div>

                        <!-- ÏÇ¨Î¨ºÌï® -->
                        <div class="option-item" onclick="toggleOption('locker')">
                            <input type="checkbox" id="opt-locker" onchange="calculatePrice()">
                            <span class="option-label">üîê ÏÇ¨Î¨ºÌï®</span>
                            <span class="option-value">+2ÎßåÏõê/Ïõî</span>
                        </div>

                        <!-- ÏµúÏ¥àÍ∞ÄÏûÖÎπÑ -->
                        <div class="option-item" onclick="toggleOption('register')">
                            <input type="checkbox" id="opt-register" onchange="calculatePrice()">
                            <span class="option-label">üÜï ÏµúÏ¥àÍ∞ÄÏûÖÎπÑ</span>
                            <span class="option-value">+10ÎßåÏõê</span>
                        </div>

                        <!-- Ìï†Ïù∏ -->
                        <div class="options-title" style="margin-top: 12px; border: none; padding: 0;">üè∑Ô∏è Ìï†Ïù∏ Ï†ÅÏö©</div>
                        <div class="discount-btn-group">
                            <button class="discount-btn active" data-discount="0" onclick="selectDiscount(0)">ÏóÜÏùå</button>
                            <button class="discount-btn" data-discount="10" onclick="selectDiscount(10)">10%</button>
                            <button class="discount-btn" data-discount="20" onclick="selectDiscount(20)">20%</button>
                        </div>
                    </div>

                    <div class="price-display">
                        <div class="price-label">Ï¥ù Í≤∞Ï†ú Í∏àÏï°</div>
                        <div class="price-amount" id="total-price">‚Ç©0</div>
                        <div class="price-breakdown" id="price-breakdown"></div>
                    </div>

                    <div class="action-buttons">
                        <button class="action-btn primary" id="copy-btn" onclick="copyPrice()" disabled>
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"/>
                            </svg>
                            Í∏àÏï° Î≥µÏÇ¨
                        </button>
                        <button class="action-btn kakao" id="kakao-btn" onclick="copyKakaoMessage()" disabled>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 3C6.48 3 2 6.58 2 11c0 2.82 1.86 5.29 4.65 6.71-.15.53-.54 1.92-.62 2.22-.1.37.14.37.29.27.12-.08 1.89-1.28 2.65-1.8.67.1 1.36.15 2.03.15 5.52 0 10-3.58 10-8C22 6.58 17.52 3 12 3z"/>
                            </svg>
                            Ïπ¥ÌÜ° Î©îÏãúÏßÄ
                        </button>
                    </div>
                    <button class="action-btn success" id="save-btn" onclick="savePayment()" disabled style="margin-top: 12px; width: 100%;">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                        Í≤∞Ï†ú ÎÇ¥Ïó≠ Ï†ÄÏû•
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2>
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        <span id="price-table-title">üìÖ ÎÇ†ÏßúÎ≥Ñ ÏöîÍ∏àÌëú</span>
                    </h2>
                </div>
                <div class="card-body">
                    <div class="price-table" id="price-table"></div>
                </div>
            </div>
        </div>

        <!-- Stats Section -->
        <div class="section" id="section-stats">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="stat-total">161</div>
                    <div class="stat-label">Ï†ÑÏ≤¥ ÌïôÏÉù</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-payments">0</div>
                    <div class="stat-label">Ïù¥Î≤à Îã¨ Í≤∞Ï†ú</div>
                </div>
                <div class="stat-card floor-8">
                    <div class="stat-value" id="stat-floor8">115</div>
                    <div class="stat-label">8Ï∏µ ÌïôÏÉù</div>
                </div>
                <div class="stat-card floor-7">
                    <div class="stat-value" id="stat-floor7">46</div>
                    <div class="stat-label">7Ï∏µ ÌïôÏÉù</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header"><h2>üìä 8Ï∏µ Ï¢åÏÑù ÌòÑÌô©</h2></div>
                <div class="card-body"><div class="seat-chart" id="chart-floor8"></div></div>
            </div>

            <div class="card">
                <div class="card-header"><h2>üìä 7Ï∏µ Ï¢åÏÑù ÌòÑÌô©</h2></div>
                <div class="card-body"><div class="seat-chart" id="chart-floor7"></div></div>
            </div>
        </div>

        <!-- History Section -->
        <div class="section" id="section-history">
            <!-- Î∞±ÏóÖ/Î≥µÏõê Ïπ¥Îìú -->
            <div class="card">
                <div class="card-header">
                    <h2>üíæ Îç∞Ïù¥ÌÑ∞ Î∞±ÏóÖ</h2>
                </div>
                <div class="card-body">
                    <p style="font-size: 0.875rem; color: var(--gray-600); margin-bottom: 16px;">
                        ÌïôÏÉù Îç∞Ïù¥ÌÑ∞ÏôÄ Í≤∞Ï†ú ÎÇ¥Ïó≠ÏùÑ ÌååÏùºÎ°ú Ï†ÄÏû•ÌïòÍ≥† Î≥µÏõêÌï† Ïàò ÏûàÏäµÎãàÎã§.
                    </p>
                    <div class="action-buttons">
                        <button class="action-btn primary" onclick="exportBackup()">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
                            </svg>
                            Î∞±ÏóÖ ÌååÏùº Ï†ÄÏû•
                        </button>
                        <button class="action-btn kakao" onclick="document.getElementById('restore-file').click()">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                            </svg>
                            Î∞±ÏóÖ ÌååÏùº Î≥µÏõê
                        </button>
                        <input type="file" id="restore-file" accept=".json" style="display:none;" onchange="importBackup(event)">
                    </div>
                    <div class="backup-info" style="margin-top: 16px; padding: 12px; background: var(--warning-light); border-radius: 8px; font-size: 0.8125rem; color: #92400e;">
                        üí° <strong>Í∂åÏû•:</strong> Ï£º 1Ìöå Î∞±ÏóÖ ÌååÏùº Ï†ÄÏû•Ìï¥ÎëêÏÑ∏Ïöî!
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2>üìã Í≤∞Ï†ú ÎÇ¥Ïó≠</h2>
                    <button class="icon-btn" onclick="exportHistory()" title="CSV ÎÇ¥Î≥¥ÎÇ¥Í∏∞">
                        <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
                        </svg>
                    </button>
                </div>
                <div class="card-body" style="padding: 0;">
                    <div id="history-list"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Modal -->
    <div class="modal-overlay" id="student-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modal-title">Ïã†Í∑ú ÌïôÏÉù Ï∂îÍ∞Ä</h3>
                <button class="modal-close" onclick="closeStudentModal()">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="edit-index">
                <div class="form-group">
                    <label>ÌïôÏÉù Ïù¥Î¶Ñ *</label>
                    <input type="text" id="modal-name" placeholder="ÌôçÍ∏∏Îèô">
                </div>
                <div class="form-group">
                    <label>Ï∏µ</label>
                    <select id="modal-floor" onchange="updateModalSeatTypes()">
                        <option value="8">8Ï∏µ</option>
                        <option value="7">7Ï∏µ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ï¢åÏÑù Ïú†Ìòï *</label>
                    <select id="modal-seat-type"></select>
                </div>
                <div class="form-group">
                    <label>Ï¢åÏÑù Î≤àÌò∏</label>
                    <input type="text" id="modal-seat-number" placeholder="Ïòà: 101">
                </div>
                <div class="form-group">
                    <label>ÌïôÏÉù Ï†ÑÌôîÎ≤àÌò∏</label>
                    <input type="tel" id="modal-student-phone" placeholder="010-0000-0000">
                </div>
                <div class="form-group">
                    <label>ÌïôÎ∂ÄÎ™® Ï†ÑÌôîÎ≤àÌò∏</label>
                    <input type="tel" id="modal-parent-phone" placeholder="010-0000-0000">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeStudentModal()">Ï∑®ÏÜå</button>
                <button class="btn-submit" id="modal-submit" onclick="saveStudent()">Ï∂îÍ∞ÄÌïòÍ∏∞</button>
            </div>
        </div>
    </div>

    <!-- Delete Modal -->
    <div class="modal-overlay" id="delete-modal">
        <div class="modal">
            <div class="modal-header">
                <h3>ÌïôÏÉù ÏÇ≠Ï†ú</h3>
                <button class="modal-close" onclick="closeDeleteModal()">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <p id="delete-message">Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?</p>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeDeleteModal()">Ï∑®ÏÜå</button>
                <button class="btn-danger" onclick="confirmDelete()">ÏÇ≠Ï†ú</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast">
        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
        </svg>
        <span id="toast-message">Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§</span>
    </div>

    <script>
        // Ïõî Í∏∞Î≥∏ ÏöîÍ∏àÌëú (ÏàòÏ†ïÎê®)
        const monthlyPrices = {
            Ï¢ÖÏùºÍ∂å: {
                'ÌîÑÎ¶¨ÎØ∏ÏóÑ': 690000,      // 69ÎßåÏõêÏúºÎ°ú Î≥ÄÍ≤Ω
                'Ïπ∏ÎßâÏù¥': 690000,
                'Ïò§ÌîàÌòï': 630000,
                'ÏûêÏú†ÏÑù': 530000          // 53ÎßåÏõêÏúºÎ°ú Î≥ÄÍ≤Ω
            },
            Ïò§ÌõÑÍ∂å: {
                'Ïπ∏ÎßâÏù¥': 550000,
                'Ïò§ÌîàÌòï': 490000,         // 49ÎßåÏõêÏúºÎ°ú Î≥ÄÍ≤Ω
                'ÏûêÏú†ÏÑù': 390000
            }
        };

        // ÏùºÎãπ ÏöîÍ∏àÌëú (30Ïùº Í∏∞Ï§Ä)
        const dailyRates = {
            Ï¢ÖÏùºÍ∂å: {
                'ÌîÑÎ¶¨ÎØ∏ÏóÑ': 23000,
                'Ïπ∏ÎßâÏù¥': 23000,
                'Ïò§ÌîàÌòï': 21000,
                'ÏûêÏú†ÏÑù': 17700
            },
            Ïò§ÌõÑÍ∂å: {
                'ÌîÑÎ¶¨ÎØ∏ÏóÑ': 18500,
                'Ïπ∏ÎßâÏù¥': 18500,
                'Ïò§ÌîàÌòï': 16400,
                'ÏûêÏú†ÏÑù': 13000
            }
        };

        // 8Ï∏µ ÏùºÌï†Í≥ÑÏÇ∞ ÏöîÍ∏àÌëú (12Ïõî Í∏∞Ï§Ä, ÏÇ¨Î¨ºÌï® Ï†úÏô∏)
        const dailyPriceTable_8F = {
            'ÏûêÏú†ÏÑù': {
                1: 390000, 2: 377000, 3: 364000, 4: 351000, 5: 338000,
                6: 325000, 7: 312000, 8: 299000, 9: 286000, 10: 273000,
                11: 260000, 12: 247000, 13: 234000, 14: 221000, 15: 221000,
                16: 208000, 17: 195000, 18: 182000, 19: 169000, 20: 156000,
                21: 143000, 22: 130000, 23: 117000, 24: 104000, 25: 91000,
                26: 78000, 27: 65000, 28: 52000, 29: 39000, 30: 26000, 31: 13000
            },
            'Ïò§ÌîàÌòï': {
                1: 490000, 2: 475600, 3: 459200, 4: 442800, 5: 426400,
                6: 410000, 7: 393600, 8: 377200, 9: 360800, 10: 344400,
                11: 328000, 12: 311600, 13: 295200, 14: 278800, 15: 278800,
                16: 262400, 17: 246000, 18: 229600, 19: 213200, 20: 196800,
                21: 180400, 22: 164000, 23: 147600, 24: 131200, 25: 114800,
                26: 98400, 27: 82000, 28: 65600, 29: 49200, 30: 32800, 31: 16400
            },
            'Ïπ∏ÎßâÏù¥': {
                1: 555000, 2: 536500, 3: 518000, 4: 499500, 5: 481000,
                6: 462500, 7: 444000, 8: 425500, 9: 407000, 10: 388500,
                11: 370000, 12: 351500, 13: 333000, 14: 314500, 15: 314500,
                16: 296000, 17: 277500, 18: 259000, 19: 240500, 20: 222000,
                21: 203500, 22: 185000, 23: 166500, 24: 148000, 25: 129500,
                26: 111000, 27: 92500, 28: 74000, 29: 55500, 30: 37000, 31: 18500
            }
        };

        // 7Ï∏µ ÏùºÌï†Í≥ÑÏÇ∞ ÏöîÍ∏àÌëú (19Ïùº~31Ïùº, Î∞©Ìïô Í∏∞Ï§Ä)
        const dailyPriceTable_7F = {
            'Ïò§ÌîàÌòï': {
                19: 273000, 20: 252000, 21: 231000, 22: 210000, 23: 189000,
                24: 168000, 25: 147000, 26: 126000, 27: 105000, 28: 84000,
                29: 63000, 30: 42000, 31: 21000
            },
            'Ïπ∏ÎßâÏù¥': {
                19: 299000, 20: 276000, 21: 253000, 22: 230000, 23: 207000,
                24: 184000, 25: 161000, 26: 138000, 27: 115000, 28: 92000,
                29: 69000, 30: 46000, 31: 23000
            }
        };

        const LOCKER_FEE = 20000;      // ÏÇ¨Î¨ºÌï® Ïõî ÎπÑÏö©
        const REGISTER_FEE = 100000;   // ÏµúÏ¥àÍ∞ÄÏûÖÎπÑ

        const seatTypes = {
            8: ['Ï†ÑÏ≤¥', 'ÏûêÏú†ÏÑù', 'Ïò§ÌîàÌòï', 'Ïπ∏ÎßâÏù¥'],
            7: ['Ï†ÑÏ≤¥', 'ÌîÑÎ¶¨ÎØ∏ÏóÑ', 'Ïò§ÌîàÌòï', 'Ïπ∏ÎßâÏù¥']
        };

        // Ï¢åÏÑùÏú†Ìòï Îß§Ìïë (Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ Ìò∏Ìôò)
        const seatTypeMapping = {
            'ÏßÄÏ†ïÏÑù_Ïó¨': 'Ïò§ÌîàÌòï',
            'ÏßÄÏ†ïÏÑù_ÎÇ®': 'Ïò§ÌîàÌòï',
            'ÏßÄÏ†ïÏÑù': 'Ïò§ÌîàÌòï'
        };

        function normalizeSeatType(type) {
            return seatTypeMapping[type] || type;
        }

        // 8Ï∏µ ÌïôÏÉù 115Î™Ö
        const defaultStudents = {
            8: [
                { name: 'ÏñëÏ§ÄÎπà', phone: '010-5029-5112', parentPhone: '010-7652-5112', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '101' },
                { name: 'ÏµúÏ§ÄÏÑú', phone: '010-3085-7594', parentPhone: '010-3082-7594', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '102' },
                { name: 'Ïù¥ÌòúÎØº', phone: '010-2234-4376', parentPhone: '010-2553-4376', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '105' },
                { name: 'ÍπÄÏàòÏòÅ', phone: '010-5859-8232', parentPhone: '010-2958-8232', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '113' },
                { name: 'ÍπÄÏó∞Ï§Ä', phone: '010-6516-4711', parentPhone: '010-3894-4711', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '116' },
                { name: 'Î≥ÄÏö∞ÏÑù', phone: '', parentPhone: '', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '117' },
                { name: 'Ïú†ÏäπÏ∞¨', phone: '', parentPhone: '', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '120' },
                { name: 'Ï∂îÏó¨Î¶º', phone: '010-3982-9377', parentPhone: '010-7339-9377', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '123' },
                { name: 'Ïù¥Ï±ÑÏú§', phone: '010-8464-2920', parentPhone: '010-8374-2920', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '125' },
                { name: 'Ï£ºÏßÄÏõê', phone: '000-000-0000', parentPhone: '010-4164-3132', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '127' },
                { name: 'Î∞ïÌòÑÌù¨', phone: '010-5295-3128', parentPhone: '010-9253-4998', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '128' },
                { name: 'ÍπÄÌòúÎØº', phone: '000-000-0000', parentPhone: '010-9123-3702', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '131' },
                { name: 'Ïù¥ÏßÄÌö®', phone: '010-9296-1532', parentPhone: '010-6286-1532', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '133' },
                { name: 'ÍπÄÎèÑÏõê', phone: '010-9704-7060', parentPhone: '010-4255-7060', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '134' },
                { name: 'Î•òÎ≥¥ÎØº', phone: '010-3005-9754', parentPhone: '010-8990-9754', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '135' },
                { name: 'Ï†ïÏ±ÑÏó∞', phone: '010-6322-0235', parentPhone: '010-2962-6335', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '136' },
                { name: 'ÌïúÍ±¥Ìù¨', phone: '010-4864-7963', parentPhone: '010-4118-7963', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '140' },
                { name: 'Î∞ïÏßÄÎØº', phone: '010-3141-6192', parentPhone: '010-9093-6192', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '141' },
                { name: 'ÍπÄÎã§ÏùÄ', phone: '010-3767-9187', parentPhone: '010-9357-9187', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '144' },
                { name: 'Î∞±Ï§ÄÌïò', phone: '000-0000-0000', parentPhone: '010-9571-0705', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '145' },
                { name: 'Ïù¥ÌòÑÏö∞', phone: '', parentPhone: '010-7338-1417', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '146' },
                { name: 'Í∞ïÏÑ±Ï§Ä', phone: '010-5287-4067', parentPhone: '010-4156-5067', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '147' },
                { name: 'ÏÑ±ÎØºÏßÑ', phone: '010-8688-0857', parentPhone: '010-3205-6126', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '148' },
                { name: 'Ï°∞Ïû¨Ïõê', phone: '010-2940-6749', parentPhone: '010-3009-6749', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '153' },
                { name: 'Ïó∞ÏÑúÏßÑ', phone: '010-2823-8842', parentPhone: '010-9059-4132', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '158' },
                { name: 'Ïù¥Ïú†Ìôò', phone: '010-3398-7769', parentPhone: '010-2264-7769', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '103' },
                { name: 'Ïò§ÏòàÎ¶∞', phone: '010-9656-8849', parentPhone: '010-7662-8849', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '104' },
                { name: 'Î∞ïÏÑúÏßÑ', phone: '010-5909-7240', parentPhone: '010-2433-7249', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '106' },
                { name: 'ÏµúÏàòÎπà', phone: '010-2973-9856', parentPhone: '010-2619-9856', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '107' },
                { name: 'ÍπÄÌÉúÏö±', phone: '010-9508-5976', parentPhone: '010-9528-5976', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '108' },
                { name: 'Ïù¥Ïú†Îã¥', phone: '010-7928-6947', parentPhone: '010-8788-6947', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '109' },
                { name: 'ÍπÄÏ£ºÌòï', phone: '010-6471-5419', parentPhone: '010-9396-1274', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '110' },
                { name: 'ÏûÑÏÜîÏö∞', phone: '010-8863-8325', parentPhone: '010-8564-8325', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '111' },
                { name: 'ÍπÄÎØºÏ∞¨', phone: '010-2847-0155', parentPhone: '010-7351-0155', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '112' },
                { name: 'Î∞ïÏÑúÏ§Ä', phone: '010-9814-3463', parentPhone: '010-5873-3466', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '114' },
                { name: 'Ïù¥ÏãúÏö∞', phone: '010-9078-3190', parentPhone: '010-5272-0088', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '115' },
                { name: 'Ïã¨ÏòàÎÇò', phone: '000-000-0000', parentPhone: '010-9104-5891', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '118' },
                { name: 'ÍπÄÏßÄÏàò', phone: '010-2771-2301', parentPhone: '010-4821-2301', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '119' },
                { name: 'ÏµúÏú§Ìïò', phone: '010-8028-5433', parentPhone: '010-3723-3777', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '121' },
                { name: 'Ïã†Ïû¨Ìù¨', phone: '010-2412-6310', parentPhone: '010-5187-6310', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '122' },
                { name: 'ÏµúÏãúÏùÄ', phone: '010-3782-5548', parentPhone: '010-9077-5558', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '124' },
                { name: 'Î∞ïÍ≤ΩÏ§Ä', phone: '010-9564-2104', parentPhone: '010-2298-2104', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '126' },
                { name: 'ÍπÄÍ∞ÄÏòÅ', phone: '010-6427-9130', parentPhone: '010-6311-9130', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '129' },
                { name: 'ÍπÄÏÜåÏ†ï', phone: '010-3012-7898', parentPhone: '010-5466-7898', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '130' },
                { name: 'ÏµúÏ†ïÌòÅ', phone: '010-6797-3708', parentPhone: '010-2797-3708', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '132' },
                { name: 'Ï†ïÏßÄÏö∞', phone: '010-4934-7935', parentPhone: '010-6829-1219', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '137' },
                { name: 'Ï°∞ÏäπÏ∞¨', phone: '010-8895-8478', parentPhone: '010-3219-2151', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '138' },
                { name: 'Ïù¥Ïó∞Ïö∞', phone: '010-4872-2510', parentPhone: '010-2854-0924', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '139' },
                { name: 'Í∏àÏ§ÄÏÑú', phone: '010-8694-9636', parentPhone: '010-7194-9636', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '142' },
                { name: 'ÍπÄÏÑúÏó∞', phone: '010-4794-0038', parentPhone: '010-8608-0252', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '143' },
                { name: 'Í≥†ÌïúÎπà', phone: '010-9130-5182', parentPhone: '010-9173-5182', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '149' },
                { name: 'Ïû•ÏùÄÏÜ°', phone: '010-9427-3143', parentPhone: '010-9788-8661', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '151' },
                { name: 'ÏµúÏÑùÌòÑ', phone: '010-9315-2412', parentPhone: '010-3296-4370', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '152' },
                { name: 'Ïû•ÏßÄÌõÑ', phone: '010-2134-5865', parentPhone: '010-3489-5865', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '154' },
                { name: 'Í≥ΩÏßÄÏö∞', phone: '010-2585-9417', parentPhone: '010-8267-9417', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '155' },
                { name: 'Ïù¥ÏÜåÏ†ï', phone: '010-3955-2245', parentPhone: '010-8819-9555', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '156' },
                { name: 'Ï†ïÍ∑úÌóå', phone: '010-7671-2883', parentPhone: '010-8516-9520', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '157' },
                { name: 'Í∞ïÏòàÏõê', phone: '010-6243-2643', parentPhone: '010-6277-2643', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '160' },
                { name: 'Ïù¥ÌòÑÏäπ', phone: '010-5233-3295', parentPhone: '010-9265-3295', seatType: 'ÏûêÏú†ÏÑù', seatNumber: '161' },
                { name: 'ÍπÄÏó∞ÏÑú', phone: '010-2396-0796', parentPhone: '010-6315-0796', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '1' },
                { name: 'Ïù¥Ïú§ÏßÄ', phone: '010-5676-1065', parentPhone: '010-5207-1065', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '2' },
                { name: 'ÏÑ±ÏòàÏ§Ä', phone: '010-4062-7663', parentPhone: '010-2611-4881', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '3' },
                { name: 'Î∞±Ï£ºÌò∏', phone: '010-6696-5001', parentPhone: '010-9945-5000', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '4' },
                { name: 'ÌïòÏ§ÄÏö∞', phone: '000-0000-0000', parentPhone: '010-9172-8400', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '5' },
                { name: 'ÏÜ°ÎÇòÌòÑ', phone: '010-4674-0132', parentPhone: '010-3083-7856', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '6' },
                { name: 'Ìô©ÏßÄÏú§', phone: '010-8927-8179', parentPhone: '010-8936-8179', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '7' },
                { name: 'Ïú§ÏòàÏÑú', phone: '010-9403-0773', parentPhone: '010-4631-7740', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '8' },
                { name: 'ÍπÄÎØºÏö∞', phone: '010-4005-7508', parentPhone: '010-7299-7508', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '9' },
                { name: 'Î∞ïÏßÄÏõê', phone: '010-8767-5827', parentPhone: '010-8735-5827', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '10' },
                { name: 'Ïò§Ï¢ÖÌòÑ', phone: '010-4670-7925', parentPhone: '010-5090-7925', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '11' },
                { name: 'ÍπÄÏòàÎÇò', phone: '010-3277-5128', parentPhone: '010-5327-5128', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '12' },
                { name: 'Ïã†Ïú†Îπà', phone: '010-4102-5364', parentPhone: '010-9532-5362', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '13' },
                { name: 'ÍπÄÏö©Ìù¨', phone: '010-3713-1890', parentPhone: '010-3713-1890', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '14' },
                { name: 'ÍπÄÌòÑÏ§Ä', phone: '010-6296-9810', parentPhone: '010-5582-4384', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '15' },
                { name: 'Í∂åÏ§ÄÏö∞', phone: '010-9145-1829', parentPhone: '010-8699-1829', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '16' },
                { name: 'Ï°∞ÏòÅÏ§Ä', phone: '010-4647-7630', parentPhone: '010-9449-6047', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '17' },
                { name: 'ÌïúÏäπÏ£º', phone: '010-4940-3633', parentPhone: '010-8893-3633', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '18' },
                { name: 'ÍπÄÍ∑úÌÉú', phone: '010-7591-2747', parentPhone: '010-5163-7714', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '19' },
                { name: 'Ï°∞ÏòàÏõê', phone: '010-9915-5683', parentPhone: '010-8834-5683', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '20' },
                { name: 'Î∞∞Ï∞ΩÎØº', phone: '010-6860-8832', parentPhone: '010-3414-8832', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '21' },
                { name: 'Ïã†ÏõêÏ§Ä', phone: '010-8912-9704', parentPhone: '010-2382-9704', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '22' },
                { name: 'Î∞©ÏÜåÏó∞', phone: '010-3675-8697', parentPhone: '010-3358-0688', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '23' },
                { name: 'ÏÜ°ÏùÄÏÑú', phone: '010-5570-9186', parentPhone: '010-2563-9168', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '24' },
                { name: 'ÌïúÏÑ±Ìö®', phone: '010-4761-2409', parentPhone: '010-4623-0568', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '25' },
                { name: 'ÍπÄÏ±ÑÏõê', phone: '010-6637-7632', parentPhone: '010-3613-7632', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '26' },
                { name: 'Ïù¥ÏÑùÏ†ï', phone: '010-9558-2653', parentPhone: '010-4753-2653', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '27' },
                { name: 'Ïù¥Ìï¥ÏÑ±', phone: '010-2173-2035', parentPhone: '010-6652-2035', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '28' },
                { name: 'Ïû•Ïó∞Ïö∞', phone: '010-6854-1040', parentPhone: '010-8875-3377', seatType: 'ÏßÄÏ†ïÏÑù_Ïó¨', seatNumber: '29' },
                { name: 'ÏµúÏ£ºÏõê', phone: '014-8911-6292', parentPhone: '010-6318-0945', seatType: 'ÏßÄÏ†ïÏÑù_Ïó¨', seatNumber: '30' },
                { name: 'Ïù¥ÏÑúÏó∞', phone: '010-6235-3867', parentPhone: '010-6330-9299', seatType: 'ÏßÄÏ†ïÏÑù_Ïó¨', seatNumber: '31' },
                { name: 'Ïú†ÎØºÏÑú', phone: '010-2123-5792', parentPhone: '010-3657-5792', seatType: 'ÏßÄÏ†ïÏÑù_Ïó¨', seatNumber: '32' },
                { name: 'Í∞ïÏòàÏÑú', phone: '010-2636-2826', parentPhone: '010-6495-0328', seatType: 'ÏßÄÏ†ïÏÑù_Ïó¨', seatNumber: '33' },
                { name: 'Î∞ïÏÑúÏú§', phone: '010-6449-4562', parentPhone: '010-9333-4562', seatType: 'ÏßÄÏ†ïÏÑù_Ïó¨', seatNumber: '34' },
                { name: 'Î∞∞ÏÑ±ÏòÅ', phone: '010-6233-5457', parentPhone: '010-6553-1472', seatType: 'ÏßÄÏ†ïÏÑù_Ïó¨', seatNumber: '35' },
                { name: 'Ïò§Ïú§Ï£º', phone: '010-4677-6482', parentPhone: '010-2977-4066', seatType: 'ÏßÄÏ†ïÏÑù_Ïó¨', seatNumber: '36' },
                { name: 'ÏÜ°Îã§ÎØ∏', phone: '010-7466-7087', parentPhone: '010-8518-7332', seatType: 'ÏßÄÏ†ïÏÑù_Ïó¨', seatNumber: '37' },
                { name: 'Ï†ïÏòàÎ¶º', phone: '010-5294-5329', parentPhone: '010-5290-5329', seatType: 'ÏßÄÏ†ïÏÑù_Ïó¨', seatNumber: '38' },
                { name: 'ÍπÄÎÇòÌòÑ', phone: '010-4331-9741', parentPhone: '010-8957-2920', seatType: 'ÏßÄÏ†ïÏÑù_Ïó¨', seatNumber: '39' },
                { name: 'ÏÜ°ÏàòÎ¶∞', phone: '010-2479-8014', parentPhone: '010-5738-8014', seatType: 'ÏßÄÏ†ïÏÑù_Ïó¨', seatNumber: '40' },
                { name: 'Î∞ïÏùÄÏÑú', phone: '010-3390-6592', parentPhone: '010-2654-0937', seatType: 'ÏßÄÏ†ïÏÑù_Ïó¨', seatNumber: '41' },
                { name: 'Ïù¥ÏÑ†ÎØº', phone: '010-7679-8044', parentPhone: '010-6352-8044', seatType: 'ÏßÄÏ†ïÏÑù_Ïó¨', seatNumber: '42' },
                { name: 'Î∞±ÏßÑÌôò', phone: '010-4021-1592', parentPhone: '010-5005-1204', seatType: 'ÏßÄÏ†ïÏÑù_ÎÇ®', seatNumber: '43' },
                { name: 'Ïú§ÏàòÌòÅ', phone: '010-3107-4890', parentPhone: '010-4149-4890', seatType: 'ÏßÄÏ†ïÏÑù_ÎÇ®', seatNumber: '44' },
                { name: 'Ïò§ÏäπÏ§Ä', phone: '010-8466-0849', parentPhone: '010-8957-0849', seatType: 'ÏßÄÏ†ïÏÑù_ÎÇ®', seatNumber: '45' },
                { name: 'Î∞±Ï†ïÏ§Ä', phone: '010-4992-1082', parentPhone: '010-4943-1082', seatType: 'ÏßÄÏ†ïÏÑù_ÎÇ®', seatNumber: '46' },
                { name: 'Î∞ïÏßÑÍ∑†', phone: '010-9106-4316', parentPhone: '010-9446-4316', seatType: 'ÏßÄÏ†ïÏÑù_ÎÇ®', seatNumber: '47' },
                { name: 'Î¨∏ÏÑúÏßÑ', phone: '010-9230-3782', parentPhone: '010-9031-7577', seatType: 'ÏßÄÏ†ïÏÑù_ÎÇ®', seatNumber: '48' },
                { name: 'Í∞ïÏ§ÄÌòÅ', phone: '010-6542-7286', parentPhone: '010-2710-7286', seatType: 'ÏßÄÏ†ïÏÑù_ÎÇ®', seatNumber: '49' },
                { name: 'ÏÜêÏ†úÌõà', phone: '010-5104-0657', parentPhone: '010-5104-0657', seatType: 'ÏßÄÏ†ïÏÑù_ÎÇ®', seatNumber: '50' },
                { name: 'Ïù¥ÏÑ∏ÌòÑ', phone: '010-3064-2498', parentPhone: '010-9170-2498', seatType: 'ÏßÄÏ†ïÏÑù_ÎÇ®', seatNumber: '51' },
                { name: 'Î∞ïÏÑ±ÏßÑ', phone: '010-4248-3890', parentPhone: '010-9872-0112', seatType: 'ÏßÄÏ†ïÏÑù_ÎÇ®', seatNumber: '52' },
                { name: 'ÏµúÏÑùÌòÑ(ÏßÄÏ†ï)', phone: '010-9315-2412', parentPhone: '010-3296-4370', seatType: 'ÏßÄÏ†ïÏÑù_ÎÇ®', seatNumber: '53' },
                { name: 'Ïù¥ÎèÑÌóå', phone: '010-5676-1408', parentPhone: '', seatType: 'ÏßÄÏ†ïÏÑù_ÎÇ®', seatNumber: '54' },
                { name: 'Ïã¨ÌÉúÏö©', phone: '010-2419-3398', parentPhone: '010-2854-0829', seatType: 'ÏßÄÏ†ïÏÑù_ÎÇ®', seatNumber: '55' },
                { name: 'Î¨∏ÌïòÎØº', phone: '010-7116-8120', parentPhone: '010-2716-8120', seatType: 'ÏßÄÏ†ïÏÑù_ÎÇ®', seatNumber: '56' }
            ],
            7: [
                { name: 'ÍπÄÌïúÎÇò', phone: '010-5701-6330', parentPhone: '010-9117-3737', seatType: 'ÌîÑÎ¶¨ÎØ∏ÏóÑ', seatNumber: '1' },
                { name: 'Ïú§ÏÑúÏ§Ä', phone: '010-5861-5654', parentPhone: '010-2546-3622', seatType: 'ÌîÑÎ¶¨ÎØ∏ÏóÑ', seatNumber: '2' },
                { name: 'Î∞ïÏ∞¨Ïö∞', phone: '010-7531-9073', parentPhone: '010-4606-1607', seatType: 'ÌîÑÎ¶¨ÎØ∏ÏóÑ', seatNumber: '3' },
                { name: 'ÏÑ±ÏßÄÏõê', phone: '010-9269-3446', parentPhone: '010-8826-3446', seatType: 'ÌîÑÎ¶¨ÎØ∏ÏóÑ', seatNumber: '4' },
                { name: 'Í∂åÎåÄÌù¨', phone: '010-3012-0936', parentPhone: '010-2509-6280', seatType: 'ÌîÑÎ¶¨ÎØ∏ÏóÑ', seatNumber: '5' },
                { name: 'Ìô©ÏàòÏßÑ', phone: '010-5460-1051', parentPhone: '010-6621-1051', seatType: 'ÌîÑÎ¶¨ÎØ∏ÏóÑ', seatNumber: '6' },
                { name: 'ÏÜêÏú†Ï£º', phone: '010-4644-2055', parentPhone: '010-2731-2055', seatType: 'ÌîÑÎ¶¨ÎØ∏ÏóÑ', seatNumber: '7' },
                { name: 'ÍπÄÌù¨ÏßÑ', phone: '010-7386-5651', parentPhone: '010-3257-5651', seatType: 'ÏßÄÏ†ïÏÑù_Ïó¨', seatNumber: '8' },
                { name: 'Ï°∞ÏÑúÏó∞', phone: '010-2577-4062', parentPhone: '010-4524-4062', seatType: 'ÏßÄÏ†ïÏÑù_Ïó¨', seatNumber: '9' },
                { name: 'ÍπÄÏ§ÄÌù¨', phone: '010-8348-9302', parentPhone: '010-3382-9302', seatType: 'ÏßÄÏ†ïÏÑù_Ïó¨', seatNumber: '10' },
                { name: 'ÍπÄÏ±ÑÏù¥', phone: '010-3765-7528', parentPhone: '010-5191-7528', seatType: 'ÏßÄÏ†ïÏÑù_Ïó¨', seatNumber: '11' },
                { name: 'Ïù¥ÏùÄÍµê', phone: '010-4624-4576', parentPhone: '010-4569-4576', seatType: 'ÏßÄÏ†ïÏÑù_Ïó¨', seatNumber: '12' },
                { name: 'Ïù¥ÏÑúÏõê', phone: '010-2407-9830', parentPhone: '010-3808-1799', seatType: 'ÏßÄÏ†ïÏÑù_Ïó¨', seatNumber: '13' },
                { name: 'Ïù¥Í∞ïÏö∞', phone: '010-9397-4649', parentPhone: '010-2744-4649', seatType: 'ÏßÄÏ†ïÏÑù_ÎÇ®', seatNumber: '14' },
                { name: 'ÏÑúÍ∞ïÎçï', phone: '010-9160-2996', parentPhone: '010-5333-2996', seatType: 'ÏßÄÏ†ïÏÑù_ÎÇ®', seatNumber: '15' },
                { name: 'Î∞ïÏÉÅÏñ∏', phone: '010-5534-6518', parentPhone: '010-6275-6518', seatType: 'ÏßÄÏ†ïÏÑù_ÎÇ®', seatNumber: '16' },
                { name: 'Ï°∞Ïù∏ÏÑ±', phone: '010-7109-5804', parentPhone: '010-6604-5804', seatType: 'ÏßÄÏ†ïÏÑù_ÎÇ®', seatNumber: '17' },
                { name: 'Î∞ïÏÑ∏ÏßÑ', phone: '010-3723-3890', parentPhone: '010-9429-3890', seatType: 'ÏßÄÏ†ïÏÑù_ÎÇ®', seatNumber: '18' },
                { name: 'ÍπÄÎèôÏ§Ä', phone: '010-6790-6263', parentPhone: '010-2792-6263', seatType: 'ÏßÄÏ†ïÏÑù_ÎÇ®', seatNumber: '19' },
                { name: 'Í≥µÌÉúÎØº', phone: '010-5112-5372', parentPhone: '010-3275-5372', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '20' },
                { name: 'Ïã¨Í∑úÎØº', phone: '000-0000-0000', parentPhone: '010-2389-0123', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '21' },
                { name: 'Ïù¥Ïû¨Îπà', phone: '010-6790-6264', parentPhone: '010-5645-3521', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '22' },
                { name: 'ÍπÄÌÉúÏú§', phone: '000-0000-0000', parentPhone: '010-6471-2138', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '23' },
                { name: 'Ïú§Ï±ÑÏõê', phone: '010-9842-2012', parentPhone: '010-9008-5012', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '24' },
                { name: 'Ï†ïÏÑ±Ìò∏', phone: '010-5093-6224', parentPhone: '010-6246-6224', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '25' },
                { name: 'ÌôçÏßÑÏö∞', phone: '010-9927-6721', parentPhone: '010-9192-6721', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '26' },
                { name: 'Ï°∞Í≤ΩÏú®', phone: '010-4002-7196', parentPhone: '010-5480-9885', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '26' },
                { name: 'ÏûÑÏäπÏõê', phone: '010-4085-4508', parentPhone: '010-4718-4508', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '27' },
                { name: 'Í∞ïÏú†Ïò®', phone: '000-000-0000', parentPhone: '010-4575-6218', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '28' },
                { name: 'ÏµúÏú§Ìïò', phone: '010-5028-5433', parentPhone: '010-3723-3777', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '29' },
                { name: 'Ïù¥ÎØºÌòÅ', phone: '010-5909-6051', parentPhone: '010-3072-6051', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '31' },
                { name: 'Ïù¥ÏßÑÏö∞', phone: '010-7645-1273', parentPhone: '010-6663-1273', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '32' },
                { name: 'Ïù¥ÏÑ±Î°ù', phone: '010-5792-7820', parentPhone: '010-2617-2575', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '33' },
                { name: 'ÍπÄÎèÑÏú§', phone: '010-4594-1497', parentPhone: '010-4549-1497', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '35' },
                { name: 'ÍπÄÏòàÎÇò', phone: '010-7102-6607', parentPhone: '010-6695-6607', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '36' },
                { name: 'ÍπÄÏãúÏôÑ', phone: '010-4995-3361', parentPhone: '010-3762-1861', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '37' },
                { name: 'Ï†ÑÌò∏Í≤Ω', phone: '010-5942-7842', parentPhone: '010-4427-7842', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '38' },
                { name: 'ÌïúÏòÅÏßÄ', phone: '010-3488-8096', parentPhone: '010-2728-8096', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '39' },
                { name: 'Ïù¥Ìò∏Î¶º', phone: '010-8079-3041', parentPhone: '010-3243-3041', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '40' },
                { name: 'Íµ¨ÌòÑ', phone: '010-2568-1852', parentPhone: '010-7523-1852', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '41' },
                { name: 'Ïò§ÌòÑÏßÄ', phone: '010-4390-3265', parentPhone: '010-4371-0622', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '42' },
                { name: 'ÌôçÏäπÏõê', phone: '010-5139-2970', parentPhone: '010-5156-4015', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '43' },
                { name: 'ÍπÄÏ∞¨ÏßÑ', phone: '010-9315-7387', parentPhone: '010-2216-7387', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '44' },
                { name: 'Í≥†Í∞ÄÎ†π', phone: '010-9011-3243', parentPhone: '010-5290-3243', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '45' },
                { name: 'Ï†ÑÌòÑÏÑú', phone: '010-9882-8116', parentPhone: '010-3336-8116', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '46' },
                { name: 'ÏßÄÌòïÎØº', phone: '010-8799-6398', parentPhone: '010-8728-6398', seatType: 'Ïπ∏ÎßâÏù¥', seatNumber: '47' }
            ]
        };

        let students = JSON.parse(JSON.stringify(defaultStudents));
        let paymentHistory = [];
        let recentStudents = [];
        let currentFloor = 8;
        let selectedStudent = null;
        let selectedPeriod = null;
        let selectedSeatFilter = 'Ï†ÑÏ≤¥';
        let selectedDiscount = 0;
        let selectedTicketType = 'Ï¢ÖÏùºÍ∂å';
        let selectedAllcare = 0;
        let selectedCalcType = 'daily'; // 'daily' or 'monthly'
        let deleteTarget = null;
        
        // Ïä§ÌîÑÎ†àÎìúÏãúÌä∏ ÎèôÍ∏∞Ìôî Îç∞Ïù¥ÌÑ∞
        let sheetData = { floor8: [], floor7: [] };
        let syncUrl = '';
        let lastSyncTime = null;

        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            loadSyncSettings();
            updateCounts();
            renderSeatFilter();
            renderStudentList();
            renderPriceTable();
            renderRecentStudents();
            updateStats();
            renderHistory();
            updateModalSeatTypes();
            checkExpiringPayments();
            updatePaymentStatus();
            
            const savedTheme = localStorage.getItem('kimomma_theme');
            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                updateThemeIcon();
            }
        });

        // ÎßåÎ£å ÏòàÏ†ï Ï≤¥ÌÅ¨ Ìï®Ïàò
        function checkExpiringPayments() {
            const now = new Date();
            const expiringList = [];
            
            paymentHistory.forEach(payment => {
                let endDate;
                
                if (payment.endDate) {
                    endDate = new Date(payment.endDate);
                } else {
                    const startDate = new Date(payment.createdAt);
                    endDate = new Date(startDate);
                    endDate.setMonth(endDate.getMonth() + payment.period);
                }
                
                const daysLeft = Math.ceil((endDate - now) / (1000 * 60 * 60 * 24));
                
                if (daysLeft <= 7) {
                    expiringList.push({
                        ...payment,
                        endDate: endDate,
                        daysLeft: daysLeft
                    });
                }
            });
            
            const uniqueExpiring = [];
            const seenNames = new Set();
            expiringList.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            for (const item of expiringList) {
                const key = `${item.floor}-${item.name}`;
                if (!seenNames.has(key)) {
                    seenNames.add(key);
                    uniqueExpiring.push(item);
                }
            }
            
            uniqueExpiring.sort((a, b) => a.daysLeft - b.daysLeft);
            
            renderExpiringList(uniqueExpiring);
        }

        function renderExpiringList(list) {
            const card = document.getElementById('expiry-card');
            const container = document.getElementById('expiry-list');
            const countEl = document.getElementById('expiry-count');
            
            if (!list.length) {
                card.style.display = 'none';
                return;
            }
            
            card.style.display = 'block';
            countEl.textContent = `${list.length}Î™Ö`;
            
            container.innerHTML = list.map(item => {
                let badgeClass, badgeText;
                
                if (item.daysLeft < 0) {
                    badgeClass = 'expired';
                    badgeText = `${Math.abs(item.daysLeft)}Ïùº ÏßÄÎÇ®`;
                } else if (item.daysLeft === 0) {
                    badgeClass = 'today';
                    badgeText = 'Ïò§Îäò ÎßåÎ£å';
                } else if (item.daysLeft <= 3) {
                    badgeClass = 'soon';
                    badgeText = `${item.daysLeft}Ïùº ÎÇ®Ïùå`;
                } else {
                    badgeClass = 'upcoming';
                    badgeText = `${item.daysLeft}Ïùº ÎÇ®Ïùå`;
                }
                
                const endStr = `${item.endDate.getMonth()+1}/${item.endDate.getDate()}`;
                
                return `
                    <div class="expiry-item">
                        <div class="info">
                            <span class="name">${item.name} (${item.floor}Ï∏µ)</span>
                            <span class="detail">${item.seatType} ¬∑ ÎßåÎ£åÏùº: ${endStr}</span>
                        </div>
                        <span class="expiry-badge ${badgeClass}">${badgeText}</span>
                    </div>
                `;
            }).join('');
        }

        function loadData() {
            const saved = localStorage.getItem('kimomma_students_v3');
            if (saved) students = JSON.parse(saved);
            const hist = localStorage.getItem('kimomma_history');
            if (hist) paymentHistory = JSON.parse(hist);
            const recent = localStorage.getItem('kimomma_recent');
            if (recent) recentStudents = JSON.parse(recent);
        }

        function saveData() {
            localStorage.setItem('kimomma_students_v3', JSON.stringify(students));
            localStorage.setItem('kimomma_history', JSON.stringify(paymentHistory));
            localStorage.setItem('kimomma_recent', JSON.stringify(recentStudents));
        }

        function switchSection(section) {
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(`section-${section}`).classList.add('active');
            if (section === 'stats') updateStats();
            if (section === 'history') renderHistory();
        }

        function selectFloor(floor) {
            currentFloor = floor;
            selectedStudent = null;
            selectedPeriod = null;
            selectedSeatFilter = 'Ï†ÑÏ≤¥';
            document.querySelectorAll('.floor-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`.floor-tab.floor-${floor}`).classList.add('active');
            document.getElementById('calculation-card').style.display = 'none';
            renderSeatFilter();
            renderStudentList();
            renderPriceTable();
        }

        function updateCounts() {
            document.getElementById('floor8-count').textContent = `${students[8].length}Î™Ö`;
            document.getElementById('floor7-count').textContent = `${students[7].length}Î™Ö`;
        }

        function renderSeatFilter() {
            const container = document.getElementById('seat-filter');
            container.innerHTML = seatTypes[currentFloor].map(type => `
                <button class="seat-filter-btn ${selectedSeatFilter === type ? 'active' : ''}" 
                        onclick="filterBySeatType('${type}')">${type}</button>
            `).join('');
        }

        function filterBySeatType(type) {
            selectedSeatFilter = type;
            renderSeatFilter();
            renderStudentList();
        }

        function filterStudents() { renderStudentList(); }

        function renderStudentList() {
            const container = document.getElementById('student-list');
            const search = document.getElementById('student-search').value.toLowerCase();
            
            let filtered = students[currentFloor].filter((s, i) => {
                s._index = i;
                const normalizedType = normalizeSeatType(s.seatType);
                const matchesFilter = selectedSeatFilter === 'Ï†ÑÏ≤¥' || 
                                      normalizedType === selectedSeatFilter ||
                                      s.seatType === selectedSeatFilter;
                return s.name.toLowerCase().includes(search) && matchesFilter;
            });
            
            if (!filtered.length) {
                container.innerHTML = '<div class="empty-state"><p>Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§</p></div>';
                return;
            }
            
            container.innerHTML = filtered.map(s => {
                const displayType = normalizeSeatType(s.seatType);
                
                // Í≤∞Ï†ú ÏÉÅÌÉú ÌôïÏù∏ (Í≤∞Ï†úÎ∞©Ïãù Ïó¥ Í∏∞Ï§Ä)
                let paymentBadge = '';
                let sheetAmountText = '';
                const paymentStatus = (s.sheetPaymentStatus || '').toString().toLowerCase();
                
                if (paymentStatus.includes('ÎØ∏ÎÇ©')) {
                    paymentBadge = '<span class="student-payment-badge unpaid">ÎØ∏ÎÇ©</span>';
                } else if (paymentStatus.includes('Ìá¥Ïõê')) {
                    paymentBadge = '<span class="student-payment-badge" style="background:#f3f4f6;color:#6b7280;">Ìá¥Ïõê</span>';
                } else if (paymentStatus.includes('Ïπ¥Îìú')) {
                    paymentBadge = '<span class="student-payment-badge paid">Ïπ¥Îìú</span>';
                } else if (paymentStatus.includes('ÌòÑÍ∏à')) {
                    paymentBadge = '<span class="student-payment-badge paid">ÌòÑÍ∏à</span>';
                } else if (paymentStatus.includes('ÏôÑÎÇ©')) {
                    paymentBadge = '<span class="student-payment-badge" style="background:#dbeafe;color:#2563eb;">ÏôÑÎÇ©</span>';
                } else if (!paymentStatus || paymentStatus === '') {
                    paymentBadge = '<span class="student-payment-badge" style="background:#f3f4f6;color:#9ca3af;">ÏóÜÏùå</span>';
                }
                
                if (s.sheetPaymentAmount && Number(s.sheetPaymentAmount) > 0) {
                    sheetAmountText = `<div class="student-sheet-amount">üí∞ ${Number(s.sheetPaymentAmount).toLocaleString()}Ïõê</div>`;
                } else {
                    sheetAmountText = `<div class="student-sheet-amount" style="color:#9ca3af;">üí∞ ÏóÜÏùå</div>`;
                }
                
                // ÎπÑÍ≥† ÌëúÏãú
                let memoText = '';
                if (s.sheetMemo && s.sheetMemo.trim() !== '') {
                    memoText = `<div class="student-sheet-amount" style="color:#6366f1;">üìù ${s.sheetMemo}</div>`;
                }
                
                return `
                <div class="student-item ${selectedStudent?.name === s.name ? 'selected' : ''}" onclick="selectStudent(${s._index})">
                    <div class="student-info">
                        <span class="student-name">${s.name}${paymentBadge}</span>
                        <span class="student-detail">${s.seatNumber ? s.seatNumber + 'Î≤à Ï¢åÏÑù' : 'Ï¢åÏÑù ÎØ∏Ï†ï'}</span>
                        ${sheetAmountText}
                        ${memoText}
                    </div>
                    <div style="display:flex;align-items:center;">
                        <span class="seat-badge ${displayType}">${displayType || 'ÎØ∏Ï†ï'}</span>
                        <div class="student-actions" onclick="event.stopPropagation()">
                            <button class="student-action-btn edit" onclick="openEditModal(${s._index})">
                                <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                </svg>
                            </button>
                            <button class="student-action-btn delete" onclick="openDeleteModal(${s._index}, '${s.name}')">
                                <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            `}).join('');
        }

        function selectStudent(index) {
            selectedStudent = students[currentFloor][index];
            selectedStudent._floor = currentFloor;
            selectedPeriod = null;
            selectedDiscount = 0;
            addToRecent(selectedStudent.name, currentFloor);
            
            // Ïä§ÌîÑÎ†àÎìúÏãúÌä∏ Í∏àÏï° Î∞è Í≤∞Ï†úÎ∞©Ïãù Ï†ïÎ≥¥
            let sheetInfo = '';
            const paymentStatus = (selectedStudent.sheetPaymentStatus || '').toString();
            const paymentAmount = selectedStudent.sheetPaymentAmount;
            const memo = selectedStudent.sheetMemo || '';
            
            let statusIcon = '';
            if (paymentStatus.includes('ÎØ∏ÎÇ©')) statusIcon = '‚ö†Ô∏è ÎØ∏ÎÇ©';
            else if (paymentStatus.includes('Ïπ¥Îìú')) statusIcon = 'üí≥ Ïπ¥Îìú';
            else if (paymentStatus.includes('ÌòÑÍ∏à')) statusIcon = 'üíµ ÌòÑÍ∏à';
            else if (paymentStatus.includes('ÏôÑÎÇ©')) statusIcon = '‚úÖ ÏôÑÎÇ©';
            else if (paymentStatus.includes('Ìá¥Ïõê')) statusIcon = 'üö™ Ìá¥Ïõê';
            else statusIcon = 'ÏóÜÏùå';
            
            const amountText = paymentAmount && Number(paymentAmount) > 0 ? 
                `${Number(paymentAmount).toLocaleString()}Ïõê` : 'ÏóÜÏùå';
            
            sheetInfo = `<div style="margin-top:8px;padding:8px;background:var(--gray-50);border-radius:6px;font-size:0.8125rem;">
                <div>üìä Ïä§ÌîÑÎ†àÎìúÏãúÌä∏: ${amountText} (${statusIcon})</div>
                ${memo ? `<div style="margin-top:4px;color:#6366f1;">üìù ${memo}</div>` : ''}
            </div>`;
            
            document.getElementById('calculation-card').style.display = 'block';
            document.getElementById('selected-student-info').innerHTML = `
                <div class="name">${selectedStudent.name} (${currentFloor}Ï∏µ)</div>
                <div class="details">
                    <div>üìç ${selectedStudent.seatType || 'ÎØ∏Ï†ï'} ${selectedStudent.seatNumber ? selectedStudent.seatNumber + 'Î≤à' : 'Ï¢åÏÑù ÎØ∏Ï†ï'}</div>
                    <div>üì± ${selectedStudent.parentPhone || 'ÎØ∏Îì±Î°ù'}</div>
                </div>
                ${sheetInfo}
            `;
            
            // Ï¥àÍ∏∞Ìôî
            document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('selected'));
            document.getElementById('start-day').value = '1';
            document.getElementById('opt-locker').checked = false;
            document.getElementById('opt-register').checked = false;
            selectedTicketType = 'Ï¢ÖÏùºÍ∂å';
            selectedAllcare = 0;
            selectedCalcType = 'daily';
            document.querySelectorAll('.ticket-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.ticket === 'Ï¢ÖÏùºÍ∂å');
            });
            document.querySelectorAll('.calc-type-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.calc === 'daily');
            });
            document.getElementById('allcare-select').value = '0';
            document.getElementById('start-day-group').style.display = 'block';
            selectDiscount(0);
            document.getElementById('total-price').textContent = '‚Ç©0';
            document.getElementById('price-breakdown').innerHTML = '';
            document.getElementById('copy-btn').disabled = true;
            document.getElementById('kakao-btn').disabled = true;
            document.getElementById('save-btn').disabled = true;
            
            renderStudentList();
            document.getElementById('calculation-card').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function addToRecent(name, floor) {
            const key = `${floor}-${name}`;
            recentStudents = recentStudents.filter(r => `${r.floor}-${r.name}` !== key);
            recentStudents.unshift({ name, floor });
            if (recentStudents.length > 5) recentStudents.pop();
            saveData();
            renderRecentStudents();
        }

        function renderRecentStudents() {
            const container = document.getElementById('recent-students');
            if (!recentStudents.length) { container.style.display = 'none'; return; }
            container.style.display = 'flex';
            container.innerHTML = recentStudents.map(r => `
                <div class="recent-student-chip" onclick="selectRecentStudent('${r.name}', ${r.floor})">${r.name} (${r.floor}Ï∏µ)</div>
            `).join('');
        }

        function selectRecentStudent(name, floor) {
            if (currentFloor !== floor) selectFloor(floor);
            const idx = students[floor].findIndex(s => s.name === name);
            if (idx >= 0) selectStudent(idx);
        }

        function selectPeriod(months) {
            if (!selectedStudent) return;
            selectedPeriod = months;
            document.querySelectorAll('.period-btn').forEach(b => b.classList.toggle('selected', b.dataset.period == months));
            calculatePrice();
        }

        function toggleOption(type) {
            const checkbox = document.getElementById(`opt-${type}`);
            checkbox.checked = !checkbox.checked;
            const optionItem = checkbox.closest('.option-item');
            if (optionItem) {
                optionItem.classList.toggle('active', checkbox.checked);
            }
            calculatePrice();
        }

        function selectDiscount(rate) {
            selectedDiscount = rate;
            document.querySelectorAll('.discount-btn:not(.allcare-btn):not(.ticket-btn)').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.discount == rate);
            });
            calculatePrice();
        }

        function selectAllcare(value) {
            selectedAllcare = parseInt(value);
            calculatePrice();
        }

        function selectCalcType(type) {
            selectedCalcType = type;
            document.querySelectorAll('.calc-type-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.calc === type);
            });
            // ÏõîÍ≥ÑÏÇ∞Ïùº ÎïåÎäî Îì±ÏõêÏùº ÏÑ†ÌÉù Ïà®ÍπÄ
            document.getElementById('start-day-group').style.display = type === 'daily' ? 'block' : 'none';
            if (type === 'monthly') {
                document.getElementById('start-day').value = '1';
            }
            calculatePrice();
        }

        function calculatePrice() {
            if (!selectedStudent || !selectedPeriod) return;
            
            const startDay = parseInt(document.getElementById('start-day').value);
            const hasLocker = document.getElementById('opt-locker').checked;
            const hasRegister = document.getElementById('opt-register').checked;
            const seatType = normalizeSeatType(selectedStudent.seatType);
            
            // ÌòÑÏû¨ ÎÇ†Ïßú Í∏∞Ï§ÄÏúºÎ°ú ÏãúÏûëÏõî Í≥ÑÏÇ∞
            const today = new Date();
            const startMonth = today.getMonth(); // 0-11
            const startYear = today.getFullYear();
            
            // Ìï¥Îãπ ÏõîÏùò ÎßàÏßÄÎßâ ÎÇ† Íµ¨ÌïòÍ∏∞
            const lastDayOfMonth = new Date(startYear, startMonth + 1, 0).getDate();
            
            // ÏùºÎãπ ÏöîÍ∏à Í∞ÄÏ†∏Ïò§Í∏∞
            const ticketType = seatType === 'ÌîÑÎ¶¨ÎØ∏ÏóÑ' ? 'Ï¢ÖÏùºÍ∂å' : selectedTicketType;
            const dailyRate = dailyRates[ticketType][seatType] || 0;
            
            // Ïõî ÏöîÍ∏à (ÏùºÎãπ x 30)
            const monthlyPrice = dailyRate * 30;
            
            let totalSeatPrice = 0;
            let priceDetail = '';
            
            if (selectedCalcType === 'monthly') {
                // ÏõîÍ≥ÑÏÇ∞ Î™®Îìú
                totalSeatPrice = monthlyPrice * selectedPeriod;
                priceDetail = `${selectedPeriod}Í∞úÏõî`;
            } else {
                // ÏùºÌï†Í≥ÑÏÇ∞ Î™®Îìú
                const remainingDays = lastDayOfMonth - startDay + 1;
                
                if (startDay === 1) {
                    // 1Ïùº ÏãúÏûë = ÏõîÏ†ïÏï°
                    totalSeatPrice = monthlyPrice * selectedPeriod;
                    priceDetail = `${selectedPeriod}Í∞úÏõî`;
                } else {
                    // Ï≤´ Îã¨ÏùÄ ÏùºÌï†Í≥ÑÏÇ∞
                    const firstMonthPrice = dailyRate * remainingDays;
                    
                    if (selectedPeriod === 1) {
                        totalSeatPrice = firstMonthPrice;
                        priceDetail = `${remainingDays}Ïùº`;
                    } else if (selectedPeriod === 2) {
                        totalSeatPrice = firstMonthPrice + monthlyPrice;
                        priceDetail = `${remainingDays}Ïùº + 1Í∞úÏõî`;
                    } else if (selectedPeriod === 3) {
                        totalSeatPrice = firstMonthPrice + (monthlyPrice * 2);
                        priceDetail = `${remainingDays}Ïùº + 2Í∞úÏõî`;
                    }
                }
            }
            
            // Ìï†Ïù∏ Ï†ÅÏö© (Ï¢åÏÑùÏöîÍ∏àÏóêÎßå)
            const discountAmount = Math.round(totalSeatPrice * selectedDiscount / 100);
            const discountedSeatPrice = totalSeatPrice - discountAmount;
            
            // Ï∂îÍ∞Ä ÏòµÏÖò
            const lockerFee = hasLocker ? LOCKER_FEE * selectedPeriod : 0;
            const allcareFee = selectedAllcare * selectedPeriod;
            const registerFee = hasRegister ? REGISTER_FEE : 0;
            
            // Ï¥ùÏï°
            const totalPrice = discountedSeatPrice + lockerFee + allcareFee + registerFee;
            
            document.getElementById('total-price').textContent = `‚Ç©${totalPrice.toLocaleString()}`;
            
            // ÏÉÅÏÑ∏ ÎÇ¥Ïó≠
            let breakdown = `<div class="price-breakdown-item"><span>${ticketType} ${seatType} (${priceDetail})</span><span>${totalSeatPrice.toLocaleString()}Ïõê</span></div>`;
            if (selectedCalcType === 'daily') {
                breakdown += `<div class="price-breakdown-item" style="font-size:0.75rem;color:var(--gray-500);"><span>ÏùºÎãπ ${dailyRate.toLocaleString()}Ïõê</span><span></span></div>`;
            } else {
                breakdown += `<div class="price-breakdown-item" style="font-size:0.75rem;color:var(--gray-500);"><span>Ïõî ${monthlyPrice.toLocaleString()}Ïõê</span><span></span></div>`;
            }
            
            if (selectedDiscount > 0) {
                breakdown += `<div class="price-breakdown-item discount"><span>üè∑Ô∏è Ìï†Ïù∏ (${selectedDiscount}%)</span><span>-${discountAmount.toLocaleString()}Ïõê</span></div>`;
            }
            
            if (selectedAllcare > 0) {
                breakdown += `<div class="price-breakdown-item add"><span>üè• Ïò¨ÏºÄÏñ¥ ${(selectedAllcare/10000).toFixed(0)}ÎßåÏõê (${selectedPeriod}Í∞úÏõî)</span><span>+${allcareFee.toLocaleString()}Ïõê</span></div>`;
            }
            
            if (hasLocker) {
                breakdown += `<div class="price-breakdown-item add"><span>üîê ÏÇ¨Î¨ºÌï® (${selectedPeriod}Í∞úÏõî)</span><span>+${lockerFee.toLocaleString()}Ïõê</span></div>`;
            }
            
            if (hasRegister) {
                breakdown += `<div class="price-breakdown-item add"><span>üÜï ÏµúÏ¥àÍ∞ÄÏûÖÎπÑ</span><span>+${registerFee.toLocaleString()}Ïõê</span></div>`;
            }
            
            breakdown += `<div class="price-breakdown-item total"><span>Ï¥ù Í≤∞Ï†úÍ∏àÏï°</span><span>${totalPrice.toLocaleString()}Ïõê</span></div>`;
            
            document.getElementById('price-breakdown').innerHTML = breakdown;
            document.getElementById('copy-btn').disabled = false;
            document.getElementById('kakao-btn').disabled = false;
            document.getElementById('save-btn').disabled = false;
        }
        
        function selectTicketType(type) {
            selectedTicketType = type;
            document.querySelectorAll('.ticket-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.ticket === type);
            });
            calculatePrice();
        }

        function getTotalPrice() {
            if (!selectedStudent || !selectedPeriod) return 0;
            
            const startDay = parseInt(document.getElementById('start-day').value);
            const hasLocker = document.getElementById('opt-locker').checked;
            const hasRegister = document.getElementById('opt-register').checked;
            const seatType = normalizeSeatType(selectedStudent.seatType);
            
            const today = new Date();
            const startMonth = today.getMonth();
            const startYear = today.getFullYear();
            const lastDayOfMonth = new Date(startYear, startMonth + 1, 0).getDate();
            const remainingDays = lastDayOfMonth - startDay + 1;
            
            const ticketType = seatType === 'ÌîÑÎ¶¨ÎØ∏ÏóÑ' ? 'Ï¢ÖÏùºÍ∂å' : selectedTicketType;
            const dailyRate = dailyRates[ticketType][seatType] || 0;
            const monthlyPrice = dailyRate * 30;
            
            let totalSeatPrice = 0;
            
            if (selectedCalcType === 'monthly') {
                // ÏõîÍ≥ÑÏÇ∞ Î™®Îìú
                totalSeatPrice = monthlyPrice * selectedPeriod;
            } else {
                // ÏùºÌï†Í≥ÑÏÇ∞ Î™®Îìú
                if (startDay === 1) {
                    totalSeatPrice = monthlyPrice * selectedPeriod;
                } else {
                    const firstMonthPrice = dailyRate * remainingDays;
                    if (selectedPeriod === 1) {
                        totalSeatPrice = firstMonthPrice;
                    } else if (selectedPeriod === 2) {
                        totalSeatPrice = firstMonthPrice + monthlyPrice;
                    } else if (selectedPeriod === 3) {
                        totalSeatPrice = firstMonthPrice + (monthlyPrice * 2);
                    }
                }
            }
            
            const discountedSeatPrice = totalSeatPrice - Math.round(totalSeatPrice * selectedDiscount / 100);
            const lockerFee = hasLocker ? LOCKER_FEE * selectedPeriod : 0;
            const allcareFee = selectedAllcare * selectedPeriod;
            const registerFee = hasRegister ? REGISTER_FEE : 0;
            
            return discountedSeatPrice + lockerFee + allcareFee + registerFee;
        }

        function copyPrice() {
            if (!selectedStudent || !selectedPeriod) return;
            const totalPrice = getTotalPrice();
            const startDay = parseInt(document.getElementById('start-day').value);
            const hasLocker = document.getElementById('opt-locker').checked;
            const hasRegister = document.getElementById('opt-register').checked;
            const seatType = normalizeSeatType(selectedStudent.seatType);
            
            const today = new Date();
            const startMonth = today.getMonth();
            const startYear = today.getFullYear();
            const lastDayOfMonth = new Date(startYear, startMonth + 1, 0).getDate();
            
            const ticketType = seatType === 'ÌîÑÎ¶¨ÎØ∏ÏóÑ' ? 'Ï¢ÖÏùºÍ∂å' : selectedTicketType;
            const dailyRate = dailyRates[ticketType][seatType] || 0;
            const monthlyPrice = dailyRate * 30;
            
            // ÎÇ†Ïßú Ìè¨Îß∑
            const monthNames = ['1Ïõî', '2Ïõî', '3Ïõî', '4Ïõî', '5Ïõî', '6Ïõî', '7Ïõî', '8Ïõî', '9Ïõî', '10Ïõî', '11Ïõî', '12Ïõî'];
            
            let periodText = '';
            let priceInfo = '';
            let seatPrice = 0;
            
            if (selectedCalcType === 'monthly') {
                // ÏõîÍ≥ÑÏÇ∞ Î™®Îìú - Îã§ÏùåÎã¨ 1ÏùºÎ∂ÄÌÑ∞ ÏãúÏûë
                const calcStartMonth = (startMonth + 1) % 12;
                const calcStartYear = startMonth === 11 ? startYear + 1 : startYear;
                const calcStartMonthName = monthNames[calcStartMonth];
                
                // Ï¢ÖÎ£åÏùº Í≥ÑÏÇ∞
                const endDate = new Date(calcStartYear, calcStartMonth + selectedPeriod, 0);
                const endLastDay = endDate.getDate();
                const endMonthName = monthNames[endDate.getMonth()];
                
                periodText = `${calcStartMonthName}1Ïùº~ ${endMonthName}${endLastDay}Ïùº ÏúàÌÑ∞Ïä§Ïø® Í≤∞Ï†úÍ∏àÏï°ÏûÖÎãàÎã§.`;
                seatPrice = monthlyPrice * selectedPeriod;
                priceInfo = `1Í∞úÏõî ${monthlyPrice.toLocaleString()}Ïõê
Ïù¥Ïö©Í∏∞Í∞Ñ ${selectedPeriod}Í∞úÏõî`;
            } else {
                // ÏùºÌï†Í≥ÑÏÇ∞ Î™®Îìú
                const remainingDays = lastDayOfMonth - startDay + 1;
                const startMonthName = monthNames[startMonth];
                
                if (startDay === 1 && selectedPeriod >= 1) {
                    // 1Ïùº ÏãúÏûë
                    const endDate = new Date(startYear, startMonth + selectedPeriod, 0);
                    const endLastDay = endDate.getDate();
                    const endMonthName = monthNames[endDate.getMonth()];
                    
                    periodText = `${startMonthName}1Ïùº~ ${endMonthName}${endLastDay}Ïùº Í≤∞Ï†úÍ∏àÏï°ÏûÖÎãàÎã§.`;
                    seatPrice = monthlyPrice * selectedPeriod;
                    priceInfo = `1Í∞úÏõî ${monthlyPrice.toLocaleString()}Ïõê
Ïù¥Ïö©Í∏∞Í∞Ñ ${selectedPeriod}Í∞úÏõî`;
                } else if (selectedPeriod === 1) {
                    // ÏùºÌï†Í≥ÑÏÇ∞ 1Í∞úÏõî
                    periodText = `${startMonthName}${startDay}Ïùº~ ${startMonthName}${lastDayOfMonth}Ïùº Í≤∞Ï†úÍ∏àÏï°ÏûÖÎãàÎã§.`;
                    seatPrice = dailyRate * remainingDays;
                    priceInfo = `1Ïùº Ïù¥Ïö©Î£å ${dailyRate.toLocaleString()}Ïõê
Ïù¥Ïö©Í∏∞Í∞Ñ ${remainingDays}Ïùº`;
                } else {
                    // ÏùºÌï†Í≥ÑÏÇ∞ + Ï∂îÍ∞Ä Ïõî
                    const additionalMonths = selectedPeriod - 1;
                    const endDate = new Date(startYear, startMonth + selectedPeriod, 0);
                    const endLastDay = endDate.getDate();
                    const endMonthName = monthNames[endDate.getMonth()];
                    
                    periodText = `${startMonthName}${startDay}Ïùº~ ${endMonthName}${endLastDay}Ïùº Í≤∞Ï†úÍ∏àÏï°ÏûÖÎãàÎã§.`;
                    seatPrice = (dailyRate * remainingDays) + (monthlyPrice * additionalMonths);
                    priceInfo = `1Ïùº Ïù¥Ïö©Î£å ${dailyRate.toLocaleString()}Ïõê
Ïù¥Ïö©Í∏∞Í∞Ñ ${remainingDays}Ïùº + ${additionalMonths}Í∞úÏõî`;
                }
            }
            
            // ÏòµÏÖò Ï∂îÍ∞Ä ÌÖçÏä§Ìä∏
            let optionsText = '';
            if (selectedAllcare > 0) {
                const allcareFee = selectedAllcare * selectedPeriod;
                optionsText += `\nÏò¨ÏºÄÏñ¥ ${(selectedAllcare/10000).toFixed(0)}ÎßåÏõê x ${selectedPeriod}Í∞úÏõî = ${allcareFee.toLocaleString()}Ïõê`;
            }
            if (hasLocker) {
                const lockerFee = LOCKER_FEE * selectedPeriod;
                optionsText += `\nÏÇ¨Î¨ºÌï® ${selectedPeriod}Í∞úÏõî = ${lockerFee.toLocaleString()}Ïõê`;
            }
            if (hasRegister) {
                optionsText += `\nÏµúÏ¥àÍ∞ÄÏûÖÎπÑ = ${REGISTER_FEE.toLocaleString()}Ïõê`;
            }
            if (selectedDiscount > 0) {
                const discountAmount = Math.round(seatPrice * selectedDiscount / 100);
                optionsText += `\nÌï†Ïù∏ ${selectedDiscount}% = -${discountAmount.toLocaleString()}Ïõê`;
            }
            
            const message = `ÏïàÎÖïÌïòÏÑ∏Ïöî:)
ÍπÄÏóÑÎßà Í¥ÄÎ¶¨ÌòïÎèÖÏÑúÏã§ ÏÜ°ÎèÑÏ†ê ÏûÖÎãàÎã§.

‚ñ† Í≤∞Ï†úÍ∏àÏï°
${selectedStudent.name}ÌïôÏÉùÏùÄ ${currentFloor}Ï∏µ ${seatType} ${ticketType}
${periodText}
${priceInfo}${optionsText}
Ï¥ù ${totalPrice.toLocaleString()}Ïõê

‚ñ†Îì±Î°ùÎ∞©Î≤ï

1.Ïò®ÎùºÏù∏Í≤∞Ï†ú - ÎÇ©Î∂ÄÌïòÎü¨ Í∞ÄÍ∏∞ ÌÅ¥Î¶≠

2.Í≥ÑÏ¢åÏù¥Ï≤¥ 469901 04 155186
[Íµ≠ÎØºÏùÄÌñâ ÏàòÎ¶¨Îî© ÍµêÏú°]
[ÌòÑÍ∏àÏòÅÏàòÏ¶ù Î∞úÍ∏âÎ≤àÌò∏ Î©îÏÑ∏ÏßÄÏ£ºÏÑ∏Ïöî.]

3.ÌòÑÏû•Í≤∞Ï†ú -ÏßÅÏ†ëÎ∞©Î¨∏`;
            
            navigator.clipboard.writeText(message);
            showToast('Í∏àÏï°Ïù¥ Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§');
        }

        function copyKakaoMessage() {
            if (!selectedStudent || !selectedPeriod) return;
            
            // copyPriceÏôÄ ÎèôÏùºÌïú Î©îÏãúÏßÄ Î≥µÏÇ¨
            copyPrice();
        }

        function savePayment() {
            if (!selectedStudent || !selectedPeriod) return;
            const totalPrice = getTotalPrice();
            const hasLocker = document.getElementById('opt-locker').checked;
            const hasRegister = document.getElementById('opt-register').checked;
            const startDay = parseInt(document.getElementById('start-day').value);
            const seatType = normalizeSeatType(selectedStudent.seatType);
            const ticketType = seatType === 'ÌîÑÎ¶¨ÎØ∏ÏóÑ' ? 'Ï¢ÖÏùºÍ∂å' : selectedTicketType;
            const today = new Date();
            
            const startDate = new Date(today.getFullYear(), today.getMonth(), selectedCalcType === 'monthly' ? 1 : startDay);
            const endDate = new Date(startDate);
            endDate.setMonth(endDate.getMonth() + selectedPeriod);
            
            paymentHistory.unshift({
                id: Date.now(),
                name: selectedStudent.name,
                floor: currentFloor,
                seatType: seatType,
                seatNumber: selectedStudent.seatNumber,
                period: selectedPeriod,
                startDay: selectedCalcType === 'monthly' ? 1 : startDay,
                calcType: selectedCalcType,
                ticketType: ticketType,
                amount: totalPrice,
                discount: selectedDiscount,
                locker: hasLocker,
                allcare: selectedAllcare,
                register: hasRegister,
                startDate: startDate.toISOString(),
                endDate: endDate.toISOString(),
                createdAt: today.toISOString()
            });
            saveData();
            showToast('Í≤∞Ï†ú ÎÇ¥Ïó≠Ïù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§', 'success');
            updateStats();
            checkExpiringPayments();
        }

        function renderPriceTable() {
            const container = document.getElementById('price-table');
            
            let html = `
            <div style="margin-bottom: 16px;">
                <div style="font-weight: 600; color: var(--primary); margin-bottom: 8px;">üåû Ï¢ÖÏùºÍ∂å (Î∞©Ìïô) - ÏùºÎãπ ÏöîÍ∏à</div>
                <div class="price-table-row"><span class="label">ÌîÑÎ¶¨ÎØ∏ÏóÑ/Ïπ∏ÎßâÏù¥</span><span class="value">23,000Ïõê/Ïùº (Ïõî 69ÎßåÏõê)</span></div>
                <div class="price-table-row"><span class="label">Ïò§ÌîàÌòï</span><span class="value">21,000Ïõê/Ïùº (Ïõî 63ÎßåÏõê)</span></div>
                <div class="price-table-row"><span class="label">ÏûêÏú†ÏÑù</span><span class="value">17,700Ïõê/Ïùº (Ïõî 53.1ÎßåÏõê)</span></div>
            </div>
            
            <div style="margin-bottom: 16px;">
                <div style="font-weight: 600; color: var(--floor-7); margin-bottom: 8px;">üåô Ïò§ÌõÑÍ∂å (ÌïôÍ∏∞Ï§ë) - ÏùºÎãπ ÏöîÍ∏à</div>
                <div class="price-table-row"><span class="label">ÌîÑÎ¶¨ÎØ∏ÏóÑ/Ïπ∏ÎßâÏù¥</span><span class="value">18,500Ïõê/Ïùº (Ïõî 55.5ÎßåÏõê)</span></div>
                <div class="price-table-row"><span class="label">Ïò§ÌîàÌòï</span><span class="value">16,400Ïõê/Ïùº (Ïõî 49.2ÎßåÏõê)</span></div>
                <div class="price-table-row"><span class="label">ÏûêÏú†ÏÑù</span><span class="value">13,000Ïõê/Ïùº (Ïõî 39ÎßåÏõê)</span></div>
            </div>
            
            <div style="padding: 12px; background: var(--gray-50); border-radius: 8px; font-size: 0.8125rem; color: var(--gray-600);">
                <strong>üìÖ Í≥ÑÏÇ∞ Î∞©Ïãù</strong><br>
                ‚Ä¢ 1Ïùº ÏãúÏûë: ÏõîÏ†ïÏï° (ÏùºÎãπ √ó 30Ïùº)<br>
                ‚Ä¢ Ï§ëÍ∞Ñ Îì±Ïõê: Ìï¥ÎãπÏõî ÎÇ®ÏùÄ ÏùºÏàò √ó ÏùºÎãπ<br><br>
                <strong>‚ûï Ï∂îÍ∞Ä ÏòµÏÖò</strong><br>
                ‚Ä¢ üè• Ïò¨ÏºÄÏñ¥: 1ÎßåÏõê~20ÎßåÏõê (Ïõî)<br>
                ‚Ä¢ üÜï ÏµúÏ¥àÍ∞ÄÏûÖÎπÑ: 10ÎßåÏõê (1Ìöå)<br>
                ‚Ä¢ üîê ÏÇ¨Î¨ºÌï®: 2ÎßåÏõê/Ïõî<br>
                ‚Ä¢ üè∑Ô∏è Ìï†Ïù∏: 10% / 20%
            </div>`;
            
            container.innerHTML = html;
        }

        function updateStats() {
            document.getElementById('stat-total').textContent = students[7].length + students[8].length;
            document.getElementById('stat-floor7').textContent = students[7].length;
            document.getElementById('stat-floor8').textContent = students[8].length;
            
            const now = new Date();
            const monthPayments = paymentHistory.filter(p => {
                const d = new Date(p.createdAt);
                return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
            });
            document.getElementById('stat-payments').textContent = monthPayments.length;
            
            renderSeatChart(8, 'chart-floor8');
            renderSeatChart(7, 'chart-floor7');
        }

        function renderSeatChart(floor, containerId) {
            const container = document.getElementById(containerId);
            const types = seatTypes[floor].filter(t => t !== 'Ï†ÑÏ≤¥');
            
            const counts = {};
            types.forEach(type => counts[type] = 0);
            
            students[floor].forEach(s => {
                const normalizedType = normalizeSeatType(s.seatType);
                if (counts.hasOwnProperty(normalizedType)) {
                    counts[normalizedType]++;
                } else if (types.includes(s.seatType)) {
                    counts[s.seatType]++;
                }
            });
            
            const max = Math.max(...Object.values(counts), 1);
            
            container.innerHTML = types.map(type => {
                const count = counts[type] || 0;
                return `
                    <div class="seat-chart-row">
                        <span class="seat-chart-label">${type}</span>
                        <div class="seat-chart-bar-bg">
                            <div class="seat-chart-bar ${type}" style="width: ${(count/max)*100}%"></div>
                        </div>
                        <span class="seat-chart-count">${count}Î™Ö</span>
                    </div>
                `;
            }).join('');
        }

        function renderHistory() {
            const container = document.getElementById('history-list');
            if (!paymentHistory.length) {
                container.innerHTML = '<div class="empty-state"><p>Í≤∞Ï†ú ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§</p></div>';
                return;
            }
            container.innerHTML = paymentHistory.map((item, i) => {
                const d = new Date(item.createdAt);
                const endDate = item.endDate ? new Date(item.endDate) : null;
                let extras = [];
                if (item.ticketType) extras.push(item.ticketType);
                if (item.discount) extras.push(`${item.discount}%Ìï†Ïù∏`);
                if (item.allcare && item.allcare > 0) {
                    extras.push(`Ïò¨ÏºÄÏñ¥${(item.allcare/10000).toFixed(0)}Îßå`);
                }
                if (item.mentoring) extras.push('Î©òÌÜ†ÎßÅ'); // Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ Ìò∏Ìôò
                if (item.locker) extras.push('ÏÇ¨Î¨ºÌï®');
                if (item.register) extras.push('Í∞ÄÏûÖÎπÑ');
                const extrasText = extras.length ? ` (${extras.join(', ')})` : '';
                const startDayText = item.startDay ? `${item.startDay}Ïùº ÏãúÏûë` : '';
                const endDateText = endDate ? ` ‚Üí ${endDate.getMonth()+1}/${endDate.getDate()} ÎßåÎ£å` : '';
                return `
                    <div class="history-item">
                        <div class="history-info">
                            <h4>${item.name} (${item.floor}Ï∏µ)</h4>
                            <p>${item.seatType} ${item.seatNumber}Î≤à ¬∑ ${item.period}Í∞úÏõî${extrasText}</p>
                            <p style="font-size: 0.75rem; color: var(--gray-400);">${d.getMonth()+1}/${d.getDate()} ${startDayText}${endDateText}</p>
                        </div>
                        <div style="display:flex;align-items:center;">
                            <span class="history-amount">‚Ç©${item.amount.toLocaleString()}</span>
                            <button class="history-delete" onclick="deleteHistory(${i})">
                                <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function deleteHistory(index) {
            paymentHistory.splice(index, 1);
            saveData();
            renderHistory();
            updateStats();
            checkExpiringPayments();
            showToast('ÎÇ¥Ïó≠Ïù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§');
        }

        function exportHistory() {
            if (!paymentHistory.length) { showToast('ÎÇ¥Î≥¥ÎÇº ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§', 'error'); return; }
            let csv = 'Ïù¥Î¶Ñ,Ï∏µ,Ï¢åÏÑùÏú†Ìòï,Ï¢åÏÑùÎ≤àÌò∏,Í∏∞Í∞Ñ(Í∞úÏõî),Îì±ÏõêÏùº,Ïù¥Ïö©Í∂å,Í∏àÏï°,Ìï†Ïù∏Ïú®,ÏÇ¨Î¨ºÌï®,Ïò¨ÏºÄÏñ¥,Í∞ÄÏûÖÎπÑ,Í≤∞Ï†úÏùº,ÎßåÎ£åÏùº\n';
            paymentHistory.forEach(item => {
                const d = new Date(item.createdAt);
                const endDate = item.endDate ? new Date(item.endDate) : null;
                const endStr = endDate ? `${endDate.getFullYear()}-${endDate.getMonth()+1}-${endDate.getDate()}` : '';
                const allcareStr = item.allcare && item.allcare > 0 ? `${(item.allcare/10000).toFixed(0)}ÎßåÏõê` : (item.mentoring ? 'Î©òÌÜ†ÎßÅ' : 'ÏóÜÏùå');
                csv += `${item.name},${item.floor}Ï∏µ,${item.seatType},${item.seatNumber},${item.period},${item.startDay || 1}Ïùº,${item.ticketType || 'Ï¢ÖÏùºÍ∂å'},${item.amount},${item.discount||0}%,${item.locker?'O':'X'},${allcareStr},${item.register?'O':'X'},${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()},${endStr}\n`;
            });
            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `ÍπÄÏóÑÎßàÎèÖÏÑúÏã§_Í≤∞Ï†úÎÇ¥Ïó≠_${new Date().toISOString().slice(0,10)}.csv`;
            link.click();
            showToast('CSV ÌååÏùºÏù¥ Îã§Ïö¥Î°úÎìúÎê©ÎãàÎã§', 'success');
        }

        // Î∞±ÏóÖ ÎÇ¥Î≥¥ÎÇ¥Í∏∞
        function exportBackup() {
            const backupData = {
                version: 'v2',
                exportDate: new Date().toISOString(),
                students: students,
                paymentHistory: paymentHistory,
                recentStudents: recentStudents
            };
            
            const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            const date = new Date().toISOString().slice(0,10);
            link.download = `ÍπÄÏóÑÎßàÎèÖÏÑúÏã§_Î∞±ÏóÖ_${date}.json`;
            link.click();
            showToast('Î∞±ÏóÖ ÌååÏùºÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!', 'success');
        }

        // Î∞±ÏóÖ Î≥µÏõê
        function importBackup(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (!data.students || !data.students[7] || !data.students[8]) {
                        showToast('Ïò¨Î∞îÎ•∏ Î∞±ÏóÖ ÌååÏùºÏù¥ ÏïÑÎãôÎãàÎã§', 'error');
                        return;
                    }
                    
                    const studentCount = data.students[7].length + data.students[8].length;
                    const historyCount = data.paymentHistory ? data.paymentHistory.length : 0;
                    
                    if (confirm(`Î∞±ÏóÖ Îç∞Ïù¥ÌÑ∞Î•º Î≥µÏõêÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\n` +
                               `‚Ä¢ ÌïôÏÉù Ïàò: ${studentCount}Î™Ö\n` +
                               `‚Ä¢ Í≤∞Ï†ú ÎÇ¥Ïó≠: ${historyCount}Í±¥\n` +
                               `‚Ä¢ Î∞±ÏóÖ ÎÇ†Ïßú: ${data.exportDate ? data.exportDate.slice(0,10) : 'Ïïå Ïàò ÏóÜÏùå'}\n\n` +
                               `‚ö†Ô∏è ÌòÑÏû¨ Îç∞Ïù¥ÌÑ∞Í∞Ä ÎçÆÏñ¥ÏîåÏõåÏßëÎãàÎã§!`)) {
                        
                        students = data.students;
                        paymentHistory = data.paymentHistory || [];
                        recentStudents = data.recentStudents || [];
                        
                        saveData();
                        updateCounts();
                        renderStudentList();
                        renderHistory();
                        updateStats();
                        renderRecentStudents();
                        checkExpiringPayments();
                        
                        showToast(`Î≥µÏõê ÏôÑÎ£å! (ÌïôÏÉù ${studentCount}Î™Ö, ÎÇ¥Ïó≠ ${historyCount}Í±¥)`, 'success');
                    }
                } catch (err) {
                    showToast('ÌååÏùºÏùÑ ÏùΩÏùÑ Ïàò ÏóÜÏäµÎãàÎã§', 'error');
                    console.error(err);
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function openAddModal() {
            document.getElementById('modal-title').textContent = 'Ïã†Í∑ú ÌïôÏÉù Ï∂îÍ∞Ä';
            document.getElementById('modal-submit').textContent = 'Ï∂îÍ∞ÄÌïòÍ∏∞';
            document.getElementById('edit-index').value = '';
            document.getElementById('modal-name').value = '';
            document.getElementById('modal-floor').value = currentFloor;
            document.getElementById('modal-seat-number').value = '';
            document.getElementById('modal-student-phone').value = '';
            document.getElementById('modal-parent-phone').value = '';
            updateModalSeatTypes();
            document.getElementById('student-modal').classList.add('active');
        }

        function openEditModal(index) {
            const s = students[currentFloor][index];
            document.getElementById('modal-title').textContent = 'ÌïôÏÉù Ï†ïÎ≥¥ ÏàòÏ†ï';
            document.getElementById('modal-submit').textContent = 'Ï†ÄÏû•ÌïòÍ∏∞';
            document.getElementById('edit-index').value = index;
            document.getElementById('modal-name').value = s.name;
            document.getElementById('modal-floor').value = currentFloor;
            document.getElementById('modal-seat-number').value = s.seatNumber;
            document.getElementById('modal-student-phone').value = s.phone;
            document.getElementById('modal-parent-phone').value = s.parentPhone;
            updateModalSeatTypes();
            document.getElementById('modal-seat-type').value = s.seatType;
            document.getElementById('student-modal').classList.add('active');
        }

        function closeStudentModal() { document.getElementById('student-modal').classList.remove('active'); }

        function updateModalSeatTypes() {
            const floor = parseInt(document.getElementById('modal-floor').value);
            const sel = document.getElementById('modal-seat-type');
            sel.innerHTML = seatTypes[floor].filter(t => t !== 'Ï†ÑÏ≤¥').map(t => `<option value="${t}">${t}</option>`).join('');
        }

        function saveStudent() {
            const editIdx = document.getElementById('edit-index').value;
            const name = document.getElementById('modal-name').value.trim();
            const floor = parseInt(document.getElementById('modal-floor').value);
            const seatType = document.getElementById('modal-seat-type').value;
            const seatNumber = document.getElementById('modal-seat-number').value.trim() || 'ÎØ∏Ï†ï';
            const phone = document.getElementById('modal-student-phone').value.trim();
            const parentPhone = document.getElementById('modal-parent-phone').value.trim();
            
            if (!name) { showToast('ÌïôÏÉù Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî', 'error'); return; }
            
            const data = { name, phone, parentPhone, seatType, seatNumber };
            
            if (editIdx !== '') {
                students[currentFloor][parseInt(editIdx)] = data;
                showToast('ÌïôÏÉù Ï†ïÎ≥¥Í∞Ä ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§', 'success');
            } else {
                students[floor].push(data);
                showToast(`${name} ÌïôÏÉùÏù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§`, 'success');
            }
            
            saveData();
            updateCounts();
            renderStudentList();
            updateStats();
            closeStudentModal();
        }

        function openDeleteModal(index, name) {
            deleteTarget = { index, floor: currentFloor };
            document.getElementById('delete-message').textContent = `"${name}" ÌïôÏÉùÏùÑ Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`;
            document.getElementById('delete-modal').classList.add('active');
        }

        function closeDeleteModal() {
            document.getElementById('delete-modal').classList.remove('active');
            deleteTarget = null;
        }

        function confirmDelete() {
            if (!deleteTarget) return;
            students[deleteTarget.floor].splice(deleteTarget.index, 1);
            saveData();
            updateCounts();
            renderStudentList();
            updateStats();
            closeDeleteModal();
            showToast('ÌïôÏÉùÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§');
        }

        function toggleTheme() {
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            document.documentElement.setAttribute('data-theme', isDark ? '' : 'dark');
            localStorage.setItem('kimomma_theme', isDark ? '' : 'dark');
            updateThemeIcon();
        }

        function updateThemeIcon() {
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            document.getElementById('theme-icon').innerHTML = isDark 
                ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>'
                : '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>';
        }

        function showToast(message, type = '') {
            const toast = document.getElementById('toast');
            toast.className = 'toast';
            if (type) toast.classList.add(type);
            document.getElementById('toast-message').textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2500);
        }

        // ============================================
        // Íµ¨Í∏Ä Ïä§ÌîÑÎ†àÎìúÏãúÌä∏ ÎèôÍ∏∞Ìôî Í∏∞Îä•
        // ============================================
        
        function loadSyncSettings() {
            syncUrl = localStorage.getItem('kimomma_sync_url') || '';
            const savedSheetData = localStorage.getItem('kimomma_sheet_data');
            const savedSyncTime = localStorage.getItem('kimomma_last_sync');
            
            if (savedSheetData) {
                try {
                    sheetData = JSON.parse(savedSheetData);
                } catch (e) {
                    sheetData = { floor8: [], floor7: [] };
                }
            }
            
            if (savedSyncTime) {
                lastSyncTime = new Date(savedSyncTime);
            }
            
            document.getElementById('sync-url').value = syncUrl;
            updateSyncStatus();
        }
        
        function saveSyncUrl() {
            syncUrl = document.getElementById('sync-url').value.trim();
            localStorage.setItem('kimomma_sync_url', syncUrl);
            showToast('ÎèôÍ∏∞Ìôî URLÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§', 'success');
        }
        
        function updateSyncStatus() {
            const statusEl = document.getElementById('sync-status');
            if (lastSyncTime) {
                const timeStr = lastSyncTime.toLocaleString('ko-KR');
                statusEl.textContent = `ÎßàÏßÄÎßâ ÎèôÍ∏∞Ìôî: ${timeStr}`;
            } else {
                statusEl.textContent = 'ÎèôÍ∏∞ÌôîÎêòÏßÄ ÏïäÏùå';
            }
        }
        
        async function syncWithSheet() {
            if (!syncUrl) {
                showToast('ÎèôÍ∏∞Ìôî URLÏùÑ Î®ºÏ†Ä ÏÑ§Ï†ïÌï¥Ï£ºÏÑ∏Ïöî', 'error');
                document.querySelector('.sync-settings details').open = true;
                return;
            }
            
            const btn = document.getElementById('sync-btn');
            btn.disabled = true;
            btn.classList.add('syncing');
            btn.innerHTML = '‚è≥ ÎèôÍ∏∞Ìôî Ï§ë...';
            
            try {
                const response = await fetch(syncUrl);
                const data = await response.json();
                
                if (data.success) {
                    sheetData = {
                        floor8: data.floor8 || [],
                        floor7: data.floor7 || []
                    };
                    
                    // ÌïôÏÉù Î™©Î°ù ÏóÖÎç∞Ïù¥Ìä∏
                    updateStudentsFromSheet();
                    
                    // Ï†ÄÏû•
                    localStorage.setItem('kimomma_sheet_data', JSON.stringify(sheetData));
                    lastSyncTime = new Date();
                    localStorage.setItem('kimomma_last_sync', lastSyncTime.toISOString());
                    
                    updateSyncStatus();
                    updatePaymentStatus();
                    renderStudentList();
                    updateCounts();
                    
                    showToast(`ÎèôÍ∏∞Ìôî ÏôÑÎ£å! 8Ï∏µ: ${sheetData.floor8.length}Î™Ö, 7Ï∏µ: ${sheetData.floor7.length}Î™Ö`, 'success');
                } else {
                    throw new Error(data.error || 'ÎèôÍ∏∞Ìôî Ïã§Ìå®');
                }
            } catch (error) {
                console.error('Sync error:', error);
                showToast('ÎèôÍ∏∞Ìôî Ïã§Ìå®: ' + error.message, 'error');
            } finally {
                btn.disabled = false;
                btn.classList.remove('syncing');
                btn.innerHTML = 'üîÑ ÎèôÍ∏∞Ìôî';
            }
        }
        
        function updateStudentsFromSheet() {
            // 8Ï∏µ ÌïôÏÉù ÏóÖÎç∞Ïù¥Ìä∏
            if (sheetData.floor8.length > 0) {
                students[8] = sheetData.floor8.map((s, idx) => ({
                    name: s.name,
                    seatType: normalizeSeatType(s.seatType),
                    seatNumber: s.seatNumber || '',
                    phone: s.phone || '',
                    parentPhone: s.parentPhone || '',
                    school: s.school || '',
                    // Ïä§ÌîÑÎ†àÎìúÏãúÌä∏ Ï∂îÍ∞Ä Ï†ïÎ≥¥
                    sheetPaymentAmount: s.paymentAmount || '',
                    sheetActualPayment: s.actualPayment || '',
                    sheetPaymentStatus: s.paymentStatus || '', // Í≤∞Ï†úÎ∞©Ïãù (ÎØ∏ÎÇ©/Ïπ¥Îìú/ÌòÑÍ∏à/ÏôÑÎÇ©/Ìá¥Ïõê)
                    sheetMemo: s.memo || ''
                }));
            }
            
            // 7Ï∏µ ÌïôÏÉù ÏóÖÎç∞Ïù¥Ìä∏
            if (sheetData.floor7.length > 0) {
                students[7] = sheetData.floor7.map((s, idx) => ({
                    name: s.name,
                    seatType: normalizeSeatType(s.seatType),
                    seatNumber: s.seatNumber || '',
                    phone: s.phone || '',
                    parentPhone: s.parentPhone || '',
                    school: s.school || '',
                    // Ïä§ÌîÑÎ†àÎìúÏãúÌä∏ Ï∂îÍ∞Ä Ï†ïÎ≥¥
                    sheetPaymentAmount: s.paymentAmount || '',
                    sheetActualPayment: s.actualPayment || '',
                    sheetPaymentStatus: s.paymentStatus || '', // Í≤∞Ï†úÎ∞©Ïãù (ÎØ∏ÎÇ©/Ïπ¥Îìú/ÌòÑÍ∏à/ÏôÑÎÇ©/Ìá¥Ïõê)
                    sheetMemo: s.memo || ''
                }));
            }
            
            saveData();
        }
        
        function updatePaymentStatus() {
            const studentList = students[currentFloor] || [];
            
            let paidCount = 0;
            let unpaidCount = 0;
            let unpaidStudents = [];
            let retiredCount = 0;
            
            studentList.forEach((s, idx) => {
                const paymentStatus = (s.sheetPaymentStatus || '').toString().toLowerCase();
                
                if (paymentStatus.includes('ÎØ∏ÎÇ©')) {
                    unpaidCount++;
                    unpaidStudents.push({
                        index: idx,
                        name: s.name,
                        seatType: s.seatType,
                        seatNumber: s.seatNumber,
                        amount: s.sheetPaymentAmount || '',
                        phone: s.phone || '',
                        parentPhone: s.parentPhone || '',
                        school: s.school || '',
                        status: 'ÎØ∏ÎÇ©'
                    });
                } else if (paymentStatus.includes('Ìá¥Ïõê')) {
                    retiredCount++;
                } else if (paymentStatus.includes('Ïπ¥Îìú') || paymentStatus.includes('ÌòÑÍ∏à') || paymentStatus.includes('ÏôÑÎÇ©')) {
                    paidCount++;
                }
            });
            
            // ÌòÑÌô© ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('current-floor-status').textContent = `${currentFloor}Ï∏µ`;
            document.getElementById('paid-count').textContent = paidCount;
            document.getElementById('unpaid-count').textContent = unpaidCount;
            
            // ÎØ∏ÎÇ©Ïûê Î™©Î°ù
            const unpaidSection = document.getElementById('unpaid-section');
            const unpaidList = document.getElementById('unpaid-list');
            
            if (unpaidStudents.length > 0) {
                unpaidSection.style.display = 'block';
                
                // Ï†ÑÏó≠ Î≥ÄÏàòÏóê ÎØ∏ÎÇ©Ïûê Ï†ÄÏû• (Î©îÏãúÏßÄ Î≥µÏÇ¨Ïö©)
                window.currentUnpaidStudents = unpaidStudents;
                
                unpaidList.innerHTML = unpaidStudents.map((s, i) => `
                    <div class="unpaid-item" onclick="selectStudent(${s.index})">
                        <div>
                            <span class="name">${s.name}</span>
                            <span class="info">${s.seatType} ${s.seatNumber}Î≤à ${s.school ? '/ ' + s.school : ''}</span>
                            <span class="info" style="display:block;">${s.parentPhone || s.phone || 'Ïó∞ÎùΩÏ≤ò ÏóÜÏùå'}</span>
                        </div>
                        <div style="display:flex;align-items:center;">
                            <span class="amount">${s.amount ? Number(s.amount).toLocaleString() + 'Ïõê' : '-'}</span>
                            <button class="copy-msg-btn" onclick="event.stopPropagation(); copyUnpaidMessage(${i})">üìã Î©îÏãúÏßÄ</button>
                        </div>
                    </div>
                `).join('');
                
                // Ï†ÑÏ≤¥ ÎØ∏ÎÇ©Ïûê Î©îÏãúÏßÄ Î≥µÏÇ¨ Î≤ÑÌäº
                unpaidList.innerHTML += `
                    <button class="unpaid-all-btn" onclick="copyAllUnpaidMessage()">
                        üì¢ Ï†ÑÏ≤¥ ÎØ∏ÎÇ©Ïûê Î™ÖÎã® Î≥µÏÇ¨ (${unpaidStudents.length}Î™Ö)
                    </button>
                `;
            } else {
                unpaidSection.style.display = 'none';
                unpaidList.innerHTML = '';
                window.currentUnpaidStudents = [];
            }
        }
        
        // Í∞úÎ≥Ñ ÎØ∏ÎÇ©Ïûê Î©îÏãúÏßÄ Î≥µÏÇ¨
        function copyUnpaidMessage(index) {
            const s = window.currentUnpaidStudents[index];
            if (!s) return;
            
            const amountText = s.amount ? Number(s.amount).toLocaleString() + 'Ïõê' : '(Í∏àÏï° ÌôïÏù∏ ÌïÑÏöî)';
            
            const message = `ÏïàÎÖïÌïòÏÑ∏Ïöî:)
ÍπÄÏóÑÎßà Í¥ÄÎ¶¨ÌòïÎèÖÏÑúÏã§ ÏÜ°ÎèÑÏ†ê ÏûÖÎãàÎã§.

${s.name} ÌïôÏÉù Ïù¥Ïö©Î£å Í≤∞Ï†ú ÏïàÎÇ¥ÎìúÎ¶ΩÎãàÎã§.

‚ñ† Í≤∞Ï†ú Ï†ïÎ≥¥
‚Ä¢ Ï∏µ: ${currentFloor}Ï∏µ
‚Ä¢ Ï¢åÏÑù: ${s.seatType} ${s.seatNumber}Î≤à
‚Ä¢ Í≤∞Ï†úÍ∏àÏï°: ${amountText}

‚ñ† Îì±Î°ùÎ∞©Î≤ï

1.Ïò®ÎùºÏù∏Í≤∞Ï†ú - ÎÇ©Î∂ÄÌïòÎü¨ Í∞ÄÍ∏∞ ÌÅ¥Î¶≠

2.Í≥ÑÏ¢åÏù¥Ï≤¥ 469901 04 155186
[Íµ≠ÎØºÏùÄÌñâ ÏàòÎ¶¨Îî© ÍµêÏú°]
[ÌòÑÍ∏àÏòÅÏàòÏ¶ù Î∞úÍ∏âÎ≤àÌò∏ Î©îÏÑ∏ÏßÄÏ£ºÏÑ∏Ïöî.]

3.ÌòÑÏû•Í≤∞Ï†ú - ÏßÅÏ†ëÎ∞©Î¨∏

Í∞êÏÇ¨Ìï©ÎãàÎã§ üôè`;
            
            navigator.clipboard.writeText(message);
            showToast(`${s.name} ÌïôÏÉù Í≤∞Ï†ú ÏïàÎÇ¥ Î©îÏãúÏßÄÍ∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§`, 'success');
        }
        
        // Ï†ÑÏ≤¥ ÎØ∏ÎÇ©Ïûê Î™ÖÎã® Î≥µÏÇ¨
        function copyAllUnpaidMessage() {
            const unpaidList = window.currentUnpaidStudents || [];
            if (unpaidList.length === 0) return;
            
            const today = new Date();
            const dateStr = `${today.getFullYear()}ÎÖÑ ${today.getMonth()+1}Ïõî ${today.getDate()}Ïùº`;
            
            let message = `üìã ${currentFloor}Ï∏µ ÎØ∏ÎÇ©Ïûê ÌòÑÌô© (${dateStr})\n`;
            message += `Ï¥ù ${unpaidList.length}Î™Ö\n\n`;
            
            unpaidList.forEach((s, i) => {
                const amountText = s.amount ? Number(s.amount).toLocaleString() + 'Ïõê' : '-';
                message += `${i+1}. ${s.name} (${s.seatType} ${s.seatNumber}Î≤à)\n`;
                message += `   üí∞ ${amountText}\n`;
                message += `   üì± ${s.parentPhone || s.phone || 'Ïó∞ÎùΩÏ≤ò ÏóÜÏùå'}\n\n`;
            });
            
            navigator.clipboard.writeText(message);
            showToast(`${unpaidList.length}Î™Ö ÎØ∏ÎÇ©Ïûê Î™ÖÎã®Ïù¥ Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§`, 'success');
        }
        
        // Ï∏µ Î≥ÄÍ≤Ω Ïãú Í≤∞Ï†ú ÌòÑÌô© ÏóÖÎç∞Ïù¥Ìä∏
        const originalSelectFloor = selectFloor;
        selectFloor = function(floor) {
            originalSelectFloor(floor);
            updatePaymentStatus();
        };
    </script>
</body>
</html>
