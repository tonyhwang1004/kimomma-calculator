<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¹€ì—„ë§ˆë…ì„œì‹¤ ê²°ì œ ê³„ì‚°ê¸°</title>
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root{--primary:#667eea;--primary-dark:#5a67d8;--secondary:#764ba2;--success:#10b981;--success-light:#d1fae5;--danger:#ef4444;--danger-light:#fee2e2;--warning:#f59e0b;--warning-light:#fef3c7;--gray-50:#f9fafb;--gray-100:#f3f4f6;--gray-200:#e5e7eb;--gray-300:#d1d5db;--gray-400:#9ca3af;--gray-500:#6b7280;--gray-600:#4b5563;--gray-700:#374151;--gray-800:#1f2937;--floor-7:#8b5cf6;--floor-7-light:#ede9fe;--floor-8:#2563eb;--shadow:0 4px 6px -1px rgba(0,0,0,0.1);--shadow-lg:0 20px 25px -5px rgba(0,0,0,0.15);--radius:16px;--radius-sm:10px}
        [data-theme="dark"]{--primary:#818cf8;--gray-50:#111827;--gray-100:#1f2937;--gray-200:#374151;--gray-300:#4b5563;--gray-400:#6b7280;--gray-500:#9ca3af;--gray-600:#d1d5db;--gray-700:#e5e7eb;--gray-800:#f3f4f6}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Noto Sans KR',sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 50%,#f093fb 100%);min-height:100vh;color:var(--gray-800);line-height:1.6;background-attachment:fixed}
        [data-theme="dark"] body{background:linear-gradient(135deg,#1e1b4b 0%,#312e81 50%,#4c1d95 100%)}
        .container{max-width:520px;margin:0 auto;padding:16px;padding-bottom:120px}
        .header{background:rgba(255,255,255,0.95);backdrop-filter:blur(20px);border-radius:24px;padding:20px 24px;margin-bottom:20px;box-shadow:var(--shadow-lg);display:flex;align-items:center;justify-content:space-between;position:sticky;top:8px;z-index:100}
        [data-theme="dark"] .header{background:rgba(31,41,55,0.95)}
        .header h1{font-size:1.5rem;font-weight:800;background:linear-gradient(135deg,var(--primary),var(--secondary));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .header .version{font-size:0.8rem;color:var(--gray-500)}
        .icon-btn{width:44px;height:44px;border:none;background:var(--gray-100);border-radius:12px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:1.2rem;transition:all 0.2s}
        .icon-btn:hover{background:var(--primary);color:white;transform:scale(1.05)}
        .sync-status-bar{background:rgba(255,255,255,0.95);backdrop-filter:blur(20px);border-radius:var(--radius);padding:14px 20px;margin-bottom:20px;display:flex;align-items:center;justify-content:space-between;box-shadow:var(--shadow)}
        [data-theme="dark"] .sync-status-bar{background:rgba(31,41,55,0.95)}
        .sync-info{display:flex;align-items:center;gap:10px;font-size:0.9rem;color:var(--gray-600)}
        .sync-dot{width:10px;height:10px;background:var(--success);border-radius:50%;animation:pulse-dot 2s infinite}
        @keyframes pulse-dot{0%,100%{opacity:1}50%{opacity:0.6}}
        .sync-btn{background:linear-gradient(135deg,var(--primary),var(--secondary));color:white;border:none;padding:10px 18px;border-radius:var(--radius-sm);font-size:0.9rem;font-weight:600;cursor:pointer;transition:all 0.2s}
        .sync-btn:hover{transform:translateY(-2px);box-shadow:var(--shadow)}
        .sync-btn:disabled{opacity:0.6;cursor:not-allowed}
        .sync-btn.syncing{animation:pulse 1s infinite}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.6}}
        .reset-btn{background:var(--gray-100);border:none;padding:8px 14px;border-radius:8px;font-size:0.85rem;color:var(--gray-600);cursor:pointer}
        .settings-panel{background:rgba(255,255,255,0.95);backdrop-filter:blur(20px);border-radius:var(--radius);margin-bottom:20px;box-shadow:var(--shadow);overflow:hidden}
        [data-theme="dark"] .settings-panel{background:rgba(31,41,55,0.95)}
        .settings-header{padding:16px 20px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--gray-200)}
        .settings-body{padding:20px}
        .settings-input{width:100%;padding:14px 16px;border:2px solid var(--gray-200);border-radius:var(--radius-sm);font-size:0.95rem;outline:none}
        .settings-input:focus{border-color:var(--primary)}
        .nav-tabs{display:flex;gap:6px;margin-bottom:20px;background:rgba(255,255,255,0.95);backdrop-filter:blur(20px);padding:6px;border-radius:24px;box-shadow:var(--shadow)}
        [data-theme="dark"] .nav-tabs{background:rgba(31,41,55,0.95)}
        .nav-tab{flex:1;padding:14px 12px;border:none;border-radius:var(--radius);font-size:0.95rem;font-weight:600;cursor:pointer;background:transparent;color:var(--gray-500);transition:all 0.2s}
        .nav-tab.active{background:linear-gradient(135deg,var(--primary),var(--secondary));color:white;box-shadow:var(--shadow)}
        .section{display:none}
        .section.active{display:block}
        .summary-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:20px}
        .summary-card{background:rgba(255,255,255,0.95);backdrop-filter:blur(20px);border-radius:var(--radius);padding:16px 12px;text-align:center;box-shadow:var(--shadow)}
        [data-theme="dark"] .summary-card{background:rgba(31,41,55,0.95)}
        .summary-card .icon{font-size:1.5rem;margin-bottom:6px}
        .summary-card .value{font-size:1.75rem;font-weight:800}
        .summary-card .label{font-size:0.75rem;color:var(--gray-500)}
        .summary-card.total .value{color:var(--primary)}
        .summary-card.paid .value{color:var(--success)}
        .summary-card.unpaid .value{color:var(--danger)}
        .summary-card.pending .value{color:var(--warning)}
        .floor-tabs{display:flex;gap:10px;margin-bottom:20px}
        .floor-tab{flex:1;padding:18px 16px;border:none;border-radius:var(--radius);font-size:1.1rem;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;background:rgba(255,255,255,0.9);color:var(--gray-600);box-shadow:var(--shadow);transition:all 0.2s}
        [data-theme="dark"] .floor-tab{background:rgba(31,41,55,0.9)}
        .floor-tab.floor-8.active{background:linear-gradient(135deg,var(--floor-8),#3b82f6);color:white;box-shadow:var(--shadow-lg)}
        .floor-tab.floor-7.active{background:linear-gradient(135deg,var(--floor-7),#a78bfa);color:white;box-shadow:var(--shadow-lg)}
        .floor-tab .count{background:rgba(255,255,255,0.3);padding:4px 12px;border-radius:20px;font-size:0.85rem}
        .floor-tab:not(.active) .count{background:var(--gray-200);color:var(--gray-600)}
        .card{background:rgba(255,255,255,0.95);backdrop-filter:blur(20px);border-radius:24px;box-shadow:var(--shadow-lg);margin-bottom:20px;overflow:hidden}
        [data-theme="dark"] .card{background:rgba(31,41,55,0.95)}
        .card-header{padding:18px 24px;border-bottom:1px solid var(--gray-200);display:flex;align-items:center;justify-content:space-between}
        .card-header h2{font-size:1.1rem;font-weight:700}
        .card-body{padding:20px 24px}
        .payment-section{background:rgba(255,255,255,0.95);backdrop-filter:blur(20px);border-radius:var(--radius);margin-bottom:16px;overflow:hidden;box-shadow:var(--shadow)}
        [data-theme="dark"] .payment-section{background:rgba(31,41,55,0.95)}
        .section-header{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;font-weight:700}
        .section-header.unpaid-header{background:linear-gradient(135deg,#fee2e2,#fecaca);color:#dc2626}
        .section-header.pending-header{background:linear-gradient(135deg,#fef3c7,#fde68a);color:#b45309}
        .section-count{font-size:0.85rem;padding:4px 14px;border-radius:20px;font-weight:700}
        .unpaid-header .section-count{background:#dc2626;color:white}
        .pending-header .section-count{background:#f59e0b;color:white}
        .student-scroll-list{max-height:280px;overflow-y:auto}
        .payment-item{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;border-bottom:1px solid var(--gray-100);cursor:pointer;transition:background 0.15s}
        .payment-item:hover{background:var(--gray-50)}
        .payment-item .info{display:flex;flex-direction:column;gap:4px;flex:1}
        .payment-item .name-row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
        .payment-item .name{font-weight:700;font-size:1rem}
        .payment-item .badge{font-size:0.7rem;padding:3px 8px;border-radius:8px;font-weight:600}
        .badge.urgency{background:var(--danger);color:white}
        .badge.urgency.warning{background:var(--warning)}
        .badge.urgency.soon{background:var(--warning-light);color:#b45309}
        .badge.locker{background:var(--floor-7-light);color:var(--floor-7)}
        .payment-item .detail{font-size:0.85rem;color:var(--gray-500)}
        .payment-item .right-side{display:flex;flex-direction:column;align-items:flex-end;gap:6px}
        .payment-item .amount{font-weight:700;font-size:1.05rem}
        .payment-item.unpaid .amount{color:var(--danger)}
        .payment-item.pending .amount{color:var(--warning)}
        .copy-msg-btn{background:var(--primary);color:white;border:none;padding:6px 12px;border-radius:6px;font-size:0.75rem;font-weight:600;cursor:pointer}
        .total-bar{padding:14px 18px;background:var(--gray-50);display:flex;justify-content:space-between;font-weight:700;border-top:1px solid var(--gray-200)}
        .bulk-copy-btn{width:100%;padding:14px;background:linear-gradient(135deg,var(--danger),#f87171);color:white;border:none;font-size:0.95rem;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px}
        .bulk-copy-btn.pending{background:linear-gradient(135deg,var(--primary),var(--secondary))}
        .seat-filter{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:16px}
        .seat-filter-btn{padding:10px 16px;border:2px solid var(--gray-200);border-radius:25px;background:white;font-size:0.9rem;font-weight:600;cursor:pointer;color:var(--gray-600);transition:all 0.2s}
        .seat-filter-btn.active{background:linear-gradient(135deg,var(--primary),var(--secondary));border-color:transparent;color:white}
        .search-box{position:relative;margin-bottom:16px}
        .search-box input{width:100%;padding:14px 18px 14px 50px;border:2px solid var(--gray-200);border-radius:var(--radius);font-size:1rem;outline:none;background:white}
        .search-box input:focus{border-color:var(--primary)}
        .search-box .search-icon{position:absolute;left:16px;top:50%;transform:translateY(-50%);font-size:1.2rem;color:var(--gray-400)}
        .student-list{max-height:350px;overflow-y:auto;border:2px solid var(--gray-200);border-radius:var(--radius)}
        .student-item{padding:14px 18px;border-bottom:1px solid var(--gray-100);cursor:pointer;display:flex;align-items:center;justify-content:space-between;transition:all 0.15s}
        .student-item:hover{background:var(--gray-50)}
        .student-item.selected{background:linear-gradient(135deg,rgba(102,126,234,0.15),rgba(118,75,162,0.15));border-left:4px solid var(--primary)}
        .student-info{display:flex;flex-direction:column;gap:4px}
        .student-name{font-weight:700;font-size:1rem;display:flex;align-items:center;gap:8px}
        .student-detail{font-size:0.85rem;color:var(--gray-500)}
        .student-sheet-info{font-size:0.8rem;color:var(--gray-500)}
        .student-memo{font-size:0.8rem;color:var(--floor-7)}
        .student-actions{display:flex;gap:6px}
        .student-action-btn{width:34px;height:34px;border:none;background:var(--gray-100);border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:0.9rem;transition:all 0.2s}
        .student-action-btn.edit:hover{background:#a3bffa;color:var(--primary)}
        .student-action-btn.delete:hover{background:var(--danger-light);color:var(--danger)}
        .seat-badge{padding:5px 12px;border-radius:20px;font-size:0.8rem;font-weight:700;margin-right:8px}
        .seat-badge.ììœ ì„{background:#fef3c7;color:#92400e}
        .seat-badge.ì˜¤í”ˆí˜•{background:#dbeafe;color:#1e40af}
        .seat-badge.ì¹¸ë§‰ì´{background:#d1fae5;color:#065f46}
        .seat-badge.í”„ë¦¬ë¯¸ì—„{background:#fce7f3;color:#9d174d}
        .payment-badge{display:inline-block;padding:3px 8px;border-radius:6px;font-size:0.7rem;font-weight:700}
        .payment-badge.paid{background:var(--success-light);color:var(--success)}
        .payment-badge.unpaid{background:var(--danger-light);color:var(--danger)}
        .payment-badge.retired{background:var(--gray-200);color:var(--gray-600)}
        .add-student-btn{width:100%;padding:14px;border:2px dashed var(--gray-300);border-radius:var(--radius);background:transparent;color:var(--gray-500);font-size:1rem;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;margin-top:16px}
        .add-student-btn:hover{border-color:var(--primary);color:var(--primary);background:rgba(102,126,234,0.1)}
        .recent-students{display:flex;gap:8px;margin-bottom:16px;overflow-x:auto;padding-bottom:8px}
        .recent-student-chip{flex-shrink:0;padding:10px 16px;background:linear-gradient(135deg,rgba(102,126,234,0.15),rgba(118,75,162,0.15));border:2px solid var(--primary);border-radius:25px;font-size:0.9rem;font-weight:600;color:var(--primary);cursor:pointer}
        .recent-student-chip:hover{background:linear-gradient(135deg,var(--primary),var(--secondary));color:white}
        .selected-student-card{background:linear-gradient(135deg,rgba(102,126,234,0.15),rgba(118,75,162,0.15));border-radius:var(--radius);padding:18px;margin-bottom:20px;border:2px solid var(--primary)}
        .selected-student-card .name{font-size:1.2rem;font-weight:800;color:var(--primary);margin-bottom:10px}
        .selected-student-card .details{display:grid;grid-template-columns:1fr 1fr;gap:8px;font-size:0.9rem;color:var(--gray-600)}
        .selected-student-card .sheet-info{margin-top:12px;padding:12px;background:var(--gray-50);border-radius:10px;font-size:0.85rem}
        .form-group{margin-bottom:18px}
        .form-group label{display:block;font-size:0.9rem;font-weight:700;color:var(--gray-700);margin-bottom:8px}
        .form-group select,.form-group input{width:100%;padding:14px 16px;border:2px solid var(--gray-200);border-radius:var(--radius-sm);font-size:1rem;outline:none;background:white}
        .form-group select:focus,.form-group input:focus{border-color:var(--primary)}
        .form-hint{font-size:0.8rem;color:var(--gray-500);margin-top:6px}
        .period-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
        .period-btn{padding:14px 10px;border:2px solid var(--gray-200);border-radius:var(--radius-sm);background:white;font-size:1rem;font-weight:600;cursor:pointer;text-align:center;color:var(--gray-700);transition:all 0.2s}
        .period-btn:hover{border-color:var(--primary)}
        .period-btn.selected{background:linear-gradient(135deg,var(--primary),var(--secondary));border-color:transparent;color:white}
        .period-btn .weeks{display:block;font-size:0.8rem;opacity:0.8;margin-top:4px}
        .options-section{background:var(--gray-50);border-radius:var(--radius);padding:18px;margin-bottom:20px}
        .options-title{font-size:0.95rem;font-weight:700;color:var(--gray-700);margin-bottom:14px}
        .btn-group{display:flex;gap:8px;margin-bottom:14px}
        .btn-group .btn{flex:1;padding:12px;border:2px solid var(--gray-200);border-radius:var(--radius-sm);background:white;font-size:0.95rem;font-weight:600;cursor:pointer;color:var(--gray-600);transition:all 0.2s}
        .btn-group .btn.active{background:linear-gradient(135deg,var(--primary),var(--secondary));border-color:transparent;color:white}
        .btn-group .btn.active.warning{background:linear-gradient(135deg,var(--warning),#fbbf24)}
        .option-item{display:flex;align-items:center;gap:12px;padding:12px 14px;background:white;border-radius:var(--radius-sm);margin-bottom:10px;cursor:pointer;border:2px solid var(--gray-200);transition:all 0.2s}
        .option-item:hover{border-color:var(--primary)}
        .option-item.active{border-color:var(--primary);background:rgba(102,126,234,0.1)}
        .option-item input[type="checkbox"]{width:20px;height:20px;accent-color:var(--primary)}
        .option-item .option-label{flex:1;font-size:1rem;font-weight:500}
        .option-item .option-value{font-size:0.95rem;font-weight:700;color:var(--primary)}
        .allcare-group{display:flex;align-items:center;gap:12px;padding:12px 14px;background:white;border-radius:var(--radius-sm);border:2px solid var(--gray-200);margin-bottom:14px}
        .allcare-group label{font-size:0.95rem;font-weight:500;white-space:nowrap}
        .allcare-group select{flex:1;padding:10px 12px;border:1px solid var(--gray-200);border-radius:8px;font-size:0.95rem;background:var(--gray-50);max-width:150px}
        .price-display{background:linear-gradient(135deg,var(--gray-800),#111827);border-radius:24px;padding:28px;text-align:center;color:white;margin-bottom:20px}
        .price-label{font-size:0.95rem;color:var(--gray-400);margin-bottom:8px}
        .price-amount{font-size:2.8rem;font-weight:800}
        .price-breakdown{margin-top:16px;padding-top:16px;border-top:1px solid var(--gray-700);font-size:0.85rem;color:var(--gray-400);text-align:left}
        .price-breakdown-item{display:flex;justify-content:space-between;padding:6px 0}
        .price-breakdown-item.discount{color:var(--warning)}
        .price-breakdown-item.add{color:var(--success)}
        .price-breakdown-item.total{border-top:1px solid var(--gray-600);margin-top:10px;padding-top:10px;font-weight:700;font-size:1rem;color:white}
        .action-buttons{display:grid;grid-template-columns:1fr 1fr;gap:12px}
        .action-btn{padding:16px;border:none;border-radius:var(--radius);font-size:1rem;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;transition:all 0.2s}
        .action-btn.primary{background:linear-gradient(135deg,var(--primary),var(--secondary));color:white}
        .action-btn.primary:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg)}
        .action-btn.kakao{background:#FEE500;color:#191919}
        .action-btn.kakao:hover{transform:translateY(-2px)}
        .action-btn.success{background:linear-gradient(135deg,var(--success),#34d399);color:white}
        .action-btn:disabled{opacity:0.5;cursor:not-allowed}
        .stats-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:14px;margin-bottom:20px}
        .stat-card{background:rgba(255,255,255,0.95);backdrop-filter:blur(20px);border-radius:var(--radius);padding:20px;text-align:center;box-shadow:var(--shadow)}
        .stat-card .stat-value{font-size:2rem;font-weight:800;color:var(--primary)}
        .stat-card .stat-label{font-size:0.85rem;color:var(--gray-500);margin-top:6px}
        .stat-card.floor-8 .stat-value{color:var(--floor-8)}
        .stat-card.floor-7 .stat-value{color:var(--floor-7)}
        .seat-chart{margin-top:16px}
        .seat-chart-row{display:flex;align-items:center;margin-bottom:14px}
        .seat-chart-label{width:80px;font-size:0.9rem;font-weight:600;color:var(--gray-600)}
        .seat-chart-bar-bg{flex:1;height:28px;background:var(--gray-100);border-radius:14px;overflow:hidden}
        .seat-chart-bar{height:100%;border-radius:14px;transition:width 0.5s}
        .seat-chart-bar.ììœ ì„{background:linear-gradient(90deg,#fbbf24,#f59e0b)}
        .seat-chart-bar.ì˜¤í”ˆí˜•{background:linear-gradient(90deg,#3b82f6,#2563eb)}
        .seat-chart-bar.ì¹¸ë§‰ì´{background:linear-gradient(90deg,#10b981,#059669)}
        .seat-chart-bar.í”„ë¦¬ë¯¸ì—„{background:linear-gradient(90deg,#ec4899,#db2777)}
        .seat-chart-count{width:55px;text-align:right;font-size:0.95rem;font-weight:700}
        .history-item{padding:18px;border-bottom:1px solid var(--gray-100);display:flex;justify-content:space-between;align-items:center}
        .history-info h4{font-size:1rem;font-weight:700;margin-bottom:6px}
        .history-info p{font-size:0.85rem;color:var(--gray-500)}
        .history-amount{font-size:1.1rem;font-weight:800;color:var(--primary)}
        .history-delete{margin-left:12px;width:34px;height:34px;border:none;background:var(--gray-100);border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--gray-400)}
        .history-delete:hover{background:var(--danger-light);color:var(--danger)}
        .price-table-section{margin-bottom:20px}
        .price-table-title{font-weight:700;color:var(--primary);margin-bottom:10px;font-size:0.95rem}
        .price-table-row{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid var(--gray-100);font-size:0.9rem}
        .price-table-row .label{color:var(--gray-600)}
        .price-table-row .value{font-weight:700}
        .price-table-info{padding:14px;background:var(--gray-50);border-radius:var(--radius-sm);font-size:0.85rem;color:var(--gray-600);line-height:1.7}
        .modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:1000;padding:16px;backdrop-filter:blur(4px)}
        .modal-overlay.active{display:flex}
        .modal{background:white;border-radius:24px;width:100%;max-width:420px;max-height:90vh;overflow-y:auto;box-shadow:var(--shadow-lg)}
        [data-theme="dark"] .modal{background:var(--gray-100)}
        .modal-header{padding:20px 24px;border-bottom:1px solid var(--gray-200);display:flex;align-items:center;justify-content:space-between}
        .modal-header h3{font-size:1.2rem;font-weight:700}
        .modal-close{width:36px;height:36px;border:none;background:var(--gray-100);border-radius:10px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:1.2rem}
        .modal-body{padding:24px}
        .modal-footer{padding:18px 24px;border-top:1px solid var(--gray-200);display:flex;gap:12px}
        .modal-footer button{flex:1;padding:14px;border-radius:var(--radius-sm);font-size:1rem;font-weight:700;cursor:pointer}
        .btn-cancel{background:var(--gray-100);border:none;color:var(--gray-600)}
        .btn-submit{background:linear-gradient(135deg,var(--primary),var(--secondary));border:none;color:white}
        .btn-danger{background:var(--danger);border:none;color:white}
        .toast{position:fixed;bottom:100px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--gray-800);color:white;padding:16px 28px;border-radius:var(--radius);font-size:1rem;font-weight:600;box-shadow:var(--shadow-lg);opacity:0;transition:all 0.3s;z-index:1001}
        .toast.show{transform:translateX(-50%) translateY(0);opacity:1}
        .toast.success{background:var(--success)}
        .toast.error{background:var(--danger)}
        .empty-state{text-align:center;padding:50px 20px;color:var(--gray-500)}
        .auto-student-list{max-height:500px;overflow-y:auto}
        .auto-student-item{padding:16px 18px;border-bottom:1px solid var(--gray-100);cursor:pointer;transition:all 0.15s}
        .auto-student-item:hover{background:var(--gray-50)}
        .auto-student-item.selected{background:linear-gradient(135deg,rgba(102,126,234,0.15),rgba(118,75,162,0.15));border-left:4px solid var(--primary)}
        .auto-student-item .top-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
        .auto-student-item .name{font-weight:700;font-size:1.1rem}
        .auto-student-item .amount{font-weight:800;font-size:1.1rem;color:var(--primary)}
        .auto-student-item .details{font-size:0.85rem;color:var(--gray-500)}
        .auto-message-card{background:linear-gradient(135deg,rgba(102,126,234,0.1),rgba(118,75,162,0.1));border:2px solid var(--primary);border-radius:var(--radius);padding:20px;margin-bottom:20px}
        .auto-message-card h3{font-size:1.1rem;font-weight:700;color:var(--primary);margin-bottom:12px;display:flex;align-items:center;gap:8px}
        .auto-message-preview{background:white;border-radius:var(--radius-sm);padding:16px;font-size:0.9rem;line-height:1.8;white-space:pre-wrap;max-height:300px;overflow-y:auto;border:1px solid var(--gray-200)}
        .auto-copy-btn{width:100%;padding:18px;background:linear-gradient(135deg,var(--success),#34d399);color:white;border:none;border-radius:var(--radius);font-size:1.1rem;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;margin-top:16px}
        .auto-copy-btn:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg)}
        .auto-copy-btn:disabled{opacity:0.5;cursor:not-allowed}
        .auto-month-selector{display:flex;gap:8px;margin-bottom:16px}
        .auto-month-btn{flex:1;padding:12px;border:2px solid var(--gray-200);border-radius:var(--radius-sm);background:white;font-size:0.95rem;font-weight:600;cursor:pointer}
        .auto-month-btn.active{background:linear-gradient(135deg,var(--primary),var(--secondary));border-color:transparent;color:white}
        .empty-state .icon{font-size:3rem;margin-bottom:12px;opacity:0.5}
        .backup-info{margin-top:18px;padding:14px;background:var(--warning-light);border-radius:var(--radius-sm);font-size:0.9rem;color:#92400e}
        @media(max-width:600px){.summary-grid{grid-template-columns:repeat(2,1fr)}.header h1{font-size:1.25rem}.action-buttons{grid-template-columns:1fr}.price-amount{font-size:2.2rem}}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>ğŸ“š ê¹€ì—„ë§ˆë…ì„œì‹¤</h1>
                <div class="version">ê²°ì œ ê³„ì‚°ê¸° v3</div>
            </div>
            <button class="icon-btn" onclick="toggleTheme()">ğŸŒ™</button>
        </div>

        <div class="settings-panel" id="settings-panel" style="display:none;">
            <div class="settings-header">
                <h3>âš™ï¸ ìµœì´ˆ ë™ê¸°í™” ì„¤ì •</h3>
                <button onclick="closeSettings()" style="background:none;border:none;font-size:1.3rem;cursor:pointer;">âœ•</button>
            </div>
            <div class="settings-body">
                <p style="margin-bottom:16px;color:var(--gray-600);">Google Apps Script URLì„ ì…ë ¥í•˜ë©´ ìë™ ë™ê¸°í™”ë©ë‹ˆë‹¤.<br><strong>í•œ ë²ˆë§Œ ì„¤ì •í•˜ë©´ ë©ë‹ˆë‹¤!</strong></p>
                <input type="text" class="settings-input" id="sync-url" placeholder="Google Apps Script URL ì…ë ¥">
                <button onclick="saveAndSync()" style="width:100%;padding:16px;background:linear-gradient(135deg,var(--primary),var(--secondary));color:white;border:none;border-radius:var(--radius-sm);font-size:1rem;font-weight:700;cursor:pointer;margin-top:12px;">âœ… ì €ì¥í•˜ê³  ë™ê¸°í™”</button>
            </div>
        </div>

        <div class="sync-status-bar" id="sync-status-bar" style="display:none;">
            <div class="sync-info"><span class="sync-dot"></span><span id="sync-status-text">ë™ê¸°í™”ë¨</span></div>
            <div style="display:flex;gap:8px;">
                <button class="sync-btn" id="sync-btn" onclick="syncWithSheet()">ğŸ”„ ë™ê¸°í™”</button>
                <button class="reset-btn" onclick="showSettings()">âš™ï¸</button>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchSection('auto')">âš¡ ìë™</button>
            <button class="nav-tab" onclick="switchSection('calculator')">ğŸ’° ìˆ˜ë™</button>
            <button class="nav-tab" onclick="switchSection('stats')">ğŸ“Š í†µê³„</button>
            <button class="nav-tab" onclick="switchSection('history')">ğŸ“‹ ë‚´ì—­</button>
        </div>

        <div class="section active" id="section-auto">
            <div class="floor-tabs">
                <button class="floor-tab floor-8 active" onclick="selectAutoFloor(8)"><span>8ì¸µ</span><span class="count" id="auto-floor8-count">0ëª…</span></button>
                <button class="floor-tab floor-7" onclick="selectAutoFloor(7)"><span>7ì¸µ</span><span class="count" id="auto-floor7-count">0ëª…</span></button>
            </div>

            <div class="auto-month-selector">
                <button class="auto-month-btn active" data-month="0" onclick="selectAutoMonth(0)">1ì›”</button>
                <button class="auto-month-btn" data-month="1" onclick="selectAutoMonth(1)">2ì›”</button>
                <button class="auto-month-btn" data-month="2" onclick="selectAutoMonth(2)">3ì›”</button>
            </div>

            <div class="auto-message-card" id="auto-message-card" style="display:none;">
                <h3>ğŸ“‹ ê²°ì œ ì•ˆë‚´ ë©”ì‹œì§€</h3>
                <div class="auto-message-preview" id="auto-message-preview"></div>
                <button class="auto-copy-btn" id="auto-copy-btn" onclick="copyAutoMessage()">ğŸ“‹ ë©”ì‹œì§€ ë³µì‚¬í•˜ê¸°</button>
            </div>

            <div class="card">
                <div class="card-header"><h2>ğŸ‘¤ í•™ìƒ ì„ íƒ</h2></div>
                <div class="card-body" style="padding:0;">
                    <div class="auto-student-list" id="auto-student-list"></div>
                </div>
            </div>
        </div>

        <div class="section" id="section-calculator">
            <div class="summary-grid">
                <div class="summary-card total"><div class="icon">ğŸ‘¥</div><div class="value" id="summary-total">0</div><div class="label">ì „ì²´</div></div>
                <div class="summary-card paid"><div class="icon">âœ…</div><div class="value" id="summary-paid">0</div><div class="label">ìˆ˜ë‚©ì™„ë£Œ</div></div>
                <div class="summary-card unpaid"><div class="icon">âš ï¸</div><div class="value" id="summary-unpaid">0</div><div class="label">ë¯¸ë‚©</div></div>
                <div class="summary-card pending"><div class="icon">â°</div><div class="value" id="summary-pending">0</div><div class="label">ì˜ˆì •</div></div>
            </div>

            <div class="floor-tabs">
                <button class="floor-tab floor-8 active" onclick="selectFloor(8)"><span>8ì¸µ</span><span class="count" id="floor8-count">0ëª…</span></button>
                <button class="floor-tab floor-7" onclick="selectFloor(7)"><span>7ì¸µ</span><span class="count" id="floor7-count">0ëª…</span></button>
            </div>

            <div class="payment-section" id="unpaid-section" style="display:none;">
                <div class="section-header unpaid-header"><span>âš ï¸ ë¯¸ë‚©</span><span class="section-count" id="unpaid-count">0ëª…</span></div>
                <div class="student-scroll-list" id="unpaid-list"></div>
                <div class="total-bar" id="unpaid-total-bar" style="display:none;"><span>ë¯¸ë‚© ì´ì•¡</span><span id="unpaid-total-amount">â‚©0</span></div>
                <button class="bulk-copy-btn" id="bulk-unpaid-btn" onclick="copyAllUnpaidMessage()" style="display:none;">ğŸ“¢ ì „ì²´ ë¯¸ë‚©ì ëª…ë‹¨ ë³µì‚¬</button>
            </div>

            <div class="payment-section" id="pending-section" style="display:none;">
                <div class="section-header pending-header"><span>â° ê²°ì œ ì˜ˆì • (3ì¼ ì´ë‚´)</span><span class="section-count" id="pending-count">0ëª…</span></div>
                <div class="student-scroll-list" id="pending-list"></div>
                <button class="bulk-copy-btn pending" id="bulk-pending-btn" onclick="copyAllPendingMessage()" style="display:none;">ğŸ“¢ ì „ì²´ ê²°ì œ ì˜ˆì • ëª…ë‹¨ ë³µì‚¬</button>
            </div>

            <div class="recent-students" id="recent-students" style="display:none;"></div>

            <div class="card">
                <div class="card-header"><h2>ğŸ‘¤ í•™ìƒ ì„ íƒ</h2></div>
                <div class="card-body">
                    <div class="seat-filter" id="seat-filter"></div>
                    <div class="search-box"><span class="search-icon">ğŸ”</span><input type="text" id="student-search" placeholder="í•™ìƒ ì´ë¦„ ê²€ìƒ‰..." oninput="filterStudents()"></div>
                    <div class="student-list" id="student-list"></div>
                    <button class="add-student-btn" onclick="openAddModal()">â• ì‹ ê·œ í•™ìƒ ì¶”ê°€</button>
                </div>
            </div>

            <div class="card" id="calculation-card" style="display:none;">
                <div class="card-header"><h2>ğŸ§® ê²°ì œ ê³„ì‚°</h2></div>
                <div class="card-body">
                    <div class="selected-student-card" id="selected-student-info"></div>
                    <div class="form-group"><label>ì´ìš© ê¸°ê°„</label>
                        <div class="period-grid">
                            <button class="period-btn" onclick="selectPeriod(1)" data-period="1">1ê°œì›”<span class="weeks">4ì£¼</span></button>
                            <button class="period-btn" onclick="selectPeriod(2)" data-period="2">2ê°œì›”<span class="weeks">8ì£¼</span></button>
                            <button class="period-btn" onclick="selectPeriod(3)" data-period="3">3ê°œì›”<span class="weeks">12ì£¼</span></button>
                        </div>
                    </div>
                    <div class="form-group"><label>ê³„ì‚° ë°©ì‹</label>
                        <div class="btn-group">
                            <button class="btn calc-type-btn active" data-calc="daily" onclick="selectCalcType('daily')">ğŸ“… ì¼í• ê³„ì‚°</button>
                            <button class="btn calc-type-btn" data-calc="monthly" onclick="selectCalcType('monthly')">ğŸ“† ì›”ê³„ì‚°</button>
                        </div>
                    </div>
                    <div class="form-group" id="start-day-group"><label>ë“±ì› ì‹œì‘ì¼</label>
                        <select id="start-day" onchange="calculatePrice()"></select>
                        <p class="form-hint">* í•´ë‹¹ ì›”ì˜ ë‚¨ì€ ì¼ìˆ˜ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤</p>
                    </div>
                    <div class="options-section">
                        <div class="options-title">ğŸ« ì´ìš©ê¶Œ ì„ íƒ</div>
                        <div class="btn-group">
                            <button class="btn ticket-btn active" data-ticket="ì¢…ì¼ê¶Œ" onclick="selectTicketType('ì¢…ì¼ê¶Œ')">ğŸŒ ì¢…ì¼ê¶Œ</button>
                            <button class="btn ticket-btn" data-ticket="ì˜¤í›„ê¶Œ" onclick="selectTicketType('ì˜¤í›„ê¶Œ')">ğŸŒ™ ì˜¤í›„ê¶Œ</button>
                        </div>
                        <p class="form-hint" style="margin-bottom:16px;">* ë°©í•™: ì¢…ì¼ê¶Œ / í•™ê¸°ì¤‘: ì˜¤í›„ê¶Œ</p>
                        <div class="options-title">ğŸ¥ ì˜¬ì¼€ì–´ ì„ íƒ</div>
                        <div class="allcare-group"><label>ì˜¬ì¼€ì–´ ê¸ˆì•¡</label><select id="allcare-select" onchange="selectAllcare(this.value)"></select><span style="font-size:0.85rem;color:var(--gray-500);">/ì›”</span></div>
                        <div class="option-item" onclick="toggleOption('locker')"><input type="checkbox" id="opt-locker" onchange="calculatePrice()"><span class="option-label">ğŸ” ì‚¬ë¬¼í•¨</span><span class="option-value">+2ë§Œì›/ì›”</span></div>
                        <div class="option-item" onclick="toggleOption('register')"><input type="checkbox" id="opt-register" onchange="calculatePrice()"><span class="option-label">ğŸ†• ìµœì´ˆê°€ì…ë¹„</span><span class="option-value">+10ë§Œì›</span></div>
                        <div class="options-title" style="margin-top:16px;">ğŸ·ï¸ í• ì¸ ì ìš©</div>
                        <div class="btn-group">
                            <button class="btn discount-btn active" data-discount="0" onclick="selectDiscount(0)">ì—†ìŒ</button>
                            <button class="btn discount-btn" data-discount="10" onclick="selectDiscount(10)">10%</button>
                            <button class="btn discount-btn" data-discount="20" onclick="selectDiscount(20)">20%</button>
                        </div>
                    </div>
                    <div class="price-display"><div class="price-label">ì´ ê²°ì œ ê¸ˆì•¡</div><div class="price-amount" id="total-price">â‚©0</div><div class="price-breakdown" id="price-breakdown"></div></div>
                    <div class="action-buttons">
                        <button class="action-btn primary" id="copy-btn" onclick="copyPrice()" disabled>ğŸ“‹ ê¸ˆì•¡ ë³µì‚¬</button>
                        <button class="action-btn kakao" id="kakao-btn" onclick="copyKakaoMessage()" disabled>ğŸ’¬ ì¹´í†¡ ë©”ì‹œì§€</button>
                    </div>
                    <button class="action-btn success" id="save-btn" onclick="savePayment()" disabled style="margin-top:14px;width:100%;">âœ… ê²°ì œ ë‚´ì—­ ì €ì¥</button>
                </div>
            </div>

            <div class="card">
                <div class="card-header"><h2>ğŸ“… ìš”ê¸ˆí‘œ</h2></div>
                <div class="card-body"><div class="price-table" id="price-table"></div></div>
            </div>
        </div>

        <div class="section" id="section-stats">
            <div class="stats-grid">
                <div class="stat-card"><div class="stat-value" id="stat-total">0</div><div class="stat-label">ì „ì²´ í•™ìƒ</div></div>
                <div class="stat-card"><div class="stat-value" id="stat-payments">0</div><div class="stat-label">ì´ë²ˆ ë‹¬ ê²°ì œ</div></div>
                <div class="stat-card floor-8"><div class="stat-value" id="stat-floor8">0</div><div class="stat-label">8ì¸µ í•™ìƒ</div></div>
                <div class="stat-card floor-7"><div class="stat-value" id="stat-floor7">0</div><div class="stat-label">7ì¸µ í•™ìƒ</div></div>
            </div>
            <div class="card"><div class="card-header"><h2>ğŸ“Š 8ì¸µ ì¢Œì„ í˜„í™©</h2></div><div class="card-body"><div class="seat-chart" id="chart-floor8"></div></div></div>
            <div class="card"><div class="card-header"><h2>ğŸ“Š 7ì¸µ ì¢Œì„ í˜„í™©</h2></div><div class="card-body"><div class="seat-chart" id="chart-floor7"></div></div></div>
        </div>

        <div class="section" id="section-history">
            <div class="card">
                <div class="card-header"><h2>ğŸ’¾ ë°ì´í„° ë°±ì—…</h2></div>
                <div class="card-body">
                    <p style="font-size:0.95rem;color:var(--gray-600);margin-bottom:18px;">í•™ìƒ ë°ì´í„°ì™€ ê²°ì œ ë‚´ì—­ì„ íŒŒì¼ë¡œ ì €ì¥/ë³µì›í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    <div class="action-buttons">
                        <button class="action-btn primary" onclick="exportBackup()">ğŸ“¤ ë°±ì—… ì €ì¥</button>
                        <button class="action-btn kakao" onclick="document.getElementById('restore-file').click()">ğŸ“¥ ë°±ì—… ë³µì›</button>
                        <input type="file" id="restore-file" accept=".json" style="display:none;" onchange="importBackup(event)">
                    </div>
                    <div class="backup-info">ğŸ’¡ <strong>ê¶Œì¥:</strong> ì£¼ 1íšŒ ë°±ì—… íŒŒì¼ ì €ì¥í•´ë‘ì„¸ìš”!</div>
                </div>
            </div>
            <div class="card">
                <div class="card-header"><h2>ğŸ“‹ ê²°ì œ ë‚´ì—­</h2><button class="icon-btn" onclick="exportHistory()">ğŸ“¤</button></div>
                <div class="card-body" style="padding:0;"><div id="history-list"></div></div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="student-modal">
        <div class="modal">
            <div class="modal-header"><h3 id="modal-title">ì‹ ê·œ í•™ìƒ ì¶”ê°€</h3><button class="modal-close" onclick="closeStudentModal()">âœ•</button></div>
            <div class="modal-body">
                <input type="hidden" id="edit-index">
                <div class="form-group"><label>í•™ìƒ ì´ë¦„ *</label><input type="text" id="modal-name" placeholder="í™ê¸¸ë™"></div>
                <div class="form-group"><label>ì¸µ</label><select id="modal-floor" onchange="updateModalSeatTypes()"><option value="8">8ì¸µ</option><option value="7">7ì¸µ</option></select></div>
                <div class="form-group"><label>ì¢Œì„ ìœ í˜• *</label><select id="modal-seat-type"></select></div>
                <div class="form-group"><label>ì¢Œì„ ë²ˆí˜¸</label><input type="text" id="modal-seat-number" placeholder="ì˜ˆ: 101"></div>
                <div class="form-group"><label>í•™ìƒ ì „í™”ë²ˆí˜¸</label><input type="tel" id="modal-student-phone" placeholder="010-0000-0000"></div>
                <div class="form-group"><label>í•™ë¶€ëª¨ ì „í™”ë²ˆí˜¸</label><input type="tel" id="modal-parent-phone" placeholder="010-0000-0000"></div>
            </div>
            <div class="modal-footer"><button class="btn-cancel" onclick="closeStudentModal()">ì·¨ì†Œ</button><button class="btn-submit" onclick="saveStudent()">ì¶”ê°€í•˜ê¸°</button></div>
        </div>
    </div>

    <div class="modal-overlay" id="delete-modal">
        <div class="modal">
            <div class="modal-header"><h3>í•™ìƒ ì‚­ì œ</h3><button class="modal-close" onclick="closeDeleteModal()">âœ•</button></div>
            <div class="modal-body"><p id="delete-message">ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p></div>
            <div class="modal-footer"><button class="btn-cancel" onclick="closeDeleteModal()">ì·¨ì†Œ</button><button class="btn-danger" onclick="confirmDelete()">ì‚­ì œ</button></div>
        </div>
    </div>

    <div class="toast" id="toast"><span id="toast-message">ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤</span></div>

    <script>
        const dailyRates={ì¢…ì¼ê¶Œ:{'í”„ë¦¬ë¯¸ì—„':23000,'ì¹¸ë§‰ì´':23000,'ì˜¤í”ˆí˜•':21000,'ììœ ì„':17700},ì˜¤í›„ê¶Œ:{'í”„ë¦¬ë¯¸ì—„':18500,'ì¹¸ë§‰ì´':18500,'ì˜¤í”ˆí˜•':16400,'ììœ ì„':13000}};
        const LOCKER_FEE=20000,REGISTER_FEE=100000;
        const seatTypes={8:['ì „ì²´','ììœ ì„','ì˜¤í”ˆí˜•','ì¹¸ë§‰ì´'],7:['ì „ì²´','í”„ë¦¬ë¯¸ì—„','ì˜¤í”ˆí˜•','ì¹¸ë§‰ì´']};
        const seatTypeMapping={'ì§€ì •ì„_ì—¬':'ì˜¤í”ˆí˜•','ì§€ì •ì„_ë‚¨':'ì˜¤í”ˆí˜•','ì§€ì •ì„':'ì˜¤í”ˆí˜•'};
        function normalizeSeatType(t){return seatTypeMapping[t]||t}
        
        let students={8:[],7:[]},paymentHistory=[],recentStudents=[],currentFloor=8,selectedStudent=null,selectedPeriod=null,selectedSeatFilter='ì „ì²´',selectedDiscount=0,selectedTicketType='ì¢…ì¼ê¶Œ',selectedAllcare=0,selectedCalcType='daily',deleteTarget=null,syncUrl='',lastSyncTime=null;

        document.addEventListener('DOMContentLoaded',()=>{
            loadData();loadSyncSettings();initSelects();initAutoMonth();updateCounts();renderSeatFilter();renderStudentList();renderPriceTable();renderRecentStudents();updateStats();renderHistory();updateModalSeatTypes();updateSummary();renderAutoStudentList();
            if(localStorage.getItem('kimomma_theme')==='dark')document.documentElement.setAttribute('data-theme','dark');
            if(syncUrl){document.getElementById('settings-panel').style.display='none';document.getElementById('sync-status-bar').style.display='flex';setTimeout(()=>syncWithSheet(),500);}
            else{document.getElementById('settings-panel').style.display='block';document.getElementById('sync-status-bar').style.display='none';}
        });
        
        function initAutoMonth(){
            const today=new Date();
            const currentMonth=today.getMonth(); // 0=1ì›”, 1=2ì›”...
            document.querySelectorAll('.auto-month-btn').forEach((b,idx)=>{
                const targetMonth=currentMonth+idx; // í˜„ì¬ì›”, ë‹¤ìŒì›”, ë‹¤ë‹¤ìŒì›”
                const displayMonth=(targetMonth%12)+1; // 1~12ì›” í‘œì‹œ
                b.textContent=`${displayMonth}ì›”`;
                b.dataset.month=idx;
                b.classList.toggle('active',idx===0);
            });
            autoMonth=0; // ì²«ë²ˆì§¸ ë²„íŠ¼ = í˜„ì¬ì›”
        }

        function initSelects(){
            let startDayEl=document.getElementById('start-day');
            startDayEl.innerHTML='';
            for(let i=1;i<=31;i++)startDayEl.innerHTML+=`<option value="${i}">${i}ì¼</option>`;
            let allcareEl=document.getElementById('allcare-select');
            allcareEl.innerHTML='<option value="0">ì—†ìŒ</option>';
            for(let i=1;i<=20;i++)allcareEl.innerHTML+=`<option value="${i*10000}">${i}ë§Œì›</option>`;
        }

        function loadSyncSettings(){
            syncUrl=localStorage.getItem('kimomma_sync_url')||'';
            const saved=localStorage.getItem('kimomma_students_data');
            if(saved)try{students=JSON.parse(saved)}catch(e){}
            const savedTime=localStorage.getItem('kimomma_last_sync');
            if(savedTime)lastSyncTime=new Date(savedTime);
            document.getElementById('sync-url').value=syncUrl;
            updateSyncStatusText();
        }

        function updateSyncStatusText(){
            const el=document.getElementById('sync-status-text');
            if(lastSyncTime){const diff=Math.floor((new Date()-lastSyncTime)/60000);el.textContent=diff<1?'ë°©ê¸ˆ ë™ê¸°í™”ë¨':diff<60?`${diff}ë¶„ ì „`:`ë§ˆì§€ë§‰: ${lastSyncTime.toLocaleString('ko-KR')}`;}
            else el.textContent='ë™ê¸°í™”ë¨';
        }

        function showSettings(){document.getElementById('settings-panel').style.display='block';document.getElementById('sync-url').value=syncUrl;}
        function closeSettings(){if(syncUrl)document.getElementById('settings-panel').style.display='none';}
        function saveAndSync(){const url=document.getElementById('sync-url').value.trim();if(!url){showToast('URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”','error');return;}syncUrl=url;localStorage.setItem('kimomma_sync_url',syncUrl);document.getElementById('settings-panel').style.display='none';document.getElementById('sync-status-bar').style.display='flex';syncWithSheet();}

        async function syncWithSheet(){
            if(!syncUrl){showToast('ë™ê¸°í™” URLì„ ì„¤ì •í•´ì£¼ì„¸ìš”','error');document.getElementById('settings-panel').style.display='block';document.getElementById('sync-status-bar').style.display='none';return;}
            const btn=document.getElementById('sync-btn');btn.disabled=true;btn.classList.add('syncing');btn.innerHTML='â³ ë™ê¸°í™” ì¤‘...';
            try{
                const res=await fetch(syncUrl);const data=await res.json();
                if(data.success){
                    if(data.floor8?.length)students[8]=data.floor8.map(s=>({name:s.name||'',seatType:normalizeSeatType(s.seatType||''),seatNumber:s.seatNumber||'',phone:s.phone||'',parentPhone:s.parentPhone||'',paymentDay:s.paymentDay||'',paymentAmount:s.paymentAmount||'',paymentStatus:s.paymentStatus||'',memo:s.memo||'',lockerNumber:s.lockerNumber||''}));
                    if(data.floor7?.length)students[7]=data.floor7.map(s=>({name:s.name||'',seatType:normalizeSeatType(s.seatType||''),seatNumber:s.seatNumber||'',phone:s.phone||'',parentPhone:s.parentPhone||'',paymentDay:s.paymentDay||'',paymentAmount:s.paymentAmount||'',paymentStatus:s.paymentStatus||'',memo:s.memo||'',lockerNumber:s.lockerNumber||''}));
                    lastSyncTime=new Date();localStorage.setItem('kimomma_last_sync',lastSyncTime.toISOString());localStorage.setItem('kimomma_students_data',JSON.stringify(students));
                    updateSyncStatusText();updateCounts();renderStudentList();updateSummary();updatePaymentLists();updateStats();renderAutoStudentList();
                    showToast(`ë™ê¸°í™” ì™„ë£Œ! ì´ ${students[8].length+students[7].length}ëª…`,'success');
                }else throw new Error(data.error||'ì‹¤íŒ¨');
            }catch(e){console.error(e);showToast('ë™ê¸°í™” ì‹¤íŒ¨: URL í™•ì¸','error');document.getElementById('settings-panel').style.display='block';}
            finally{btn.disabled=false;btn.classList.remove('syncing');btn.innerHTML='ğŸ”„ ë™ê¸°í™”';}
        }

        function loadData(){
            const saved=localStorage.getItem('kimomma_students_data');if(saved)try{students=JSON.parse(saved)}catch(e){students={8:[],7:[]};}
            const hist=localStorage.getItem('kimomma_history');if(hist)paymentHistory=JSON.parse(hist);
            const recent=localStorage.getItem('kimomma_recent');if(recent)recentStudents=JSON.parse(recent);
        }
        function saveData(){localStorage.setItem('kimomma_students_data',JSON.stringify(students));localStorage.setItem('kimomma_history',JSON.stringify(paymentHistory));localStorage.setItem('kimomma_recent',JSON.stringify(recentStudents));}

        function updateCounts(){document.getElementById('floor8-count').textContent=`${students[8].length}ëª…`;document.getElementById('floor7-count').textContent=`${students[7].length}ëª…`;}

        function updateSummary(){
            const list=students[currentFloor]||[];let paid=0,unpaid=0,pending=0;const today=new Date();today.setHours(0,0,0,0);const threeDays=new Date(today);threeDays.setDate(threeDays.getDate()+3);
            list.forEach(s=>{const st=(s.paymentStatus||'').toLowerCase();if(st.includes('ë¯¸ë‚©'))unpaid++;else if(st.includes('ì¹´ë“œ')||st.includes('í˜„ê¸ˆ')||st.includes('ì™„ë‚©'))paid++;
                const pd=parseInt(s.paymentDay);if(!isNaN(pd)&&pd>=1&&pd<=31){let payDate=new Date(today.getFullYear(),today.getMonth(),pd);const diff=Math.floor((today-payDate)/(86400000));if(diff>7)payDate=new Date(today.getFullYear(),today.getMonth()+1,pd);if(!st.includes('ë¯¸ë‚©')&&!st.includes('í‡´ì›')&&payDate>=today&&payDate<=threeDays)pending++;}
            });
            document.getElementById('summary-total').textContent=list.length;document.getElementById('summary-paid').textContent=paid;document.getElementById('summary-unpaid').textContent=unpaid;document.getElementById('summary-pending').textContent=pending;
            updatePaymentLists();
        }

        function updatePaymentLists(){
            const list=students[currentFloor]||[];const today=new Date();today.setHours(0,0,0,0);const threeDays=new Date(today);threeDays.setDate(threeDays.getDate()+3);
            let unpaidList=[],pendingList=[],unpaidTotal=0;
            list.forEach((s,idx)=>{
                const st=(s.paymentStatus||'').toLowerCase();const pd=parseInt(s.paymentDay);
                if(st.includes('ë¯¸ë‚©')){const amt=parseInt(s.paymentAmount)||0;unpaidTotal+=amt;let days=0;if(!isNaN(pd)){let payDate=new Date(today.getFullYear(),today.getMonth(),pd);days=Math.floor((today-payDate)/86400000);if(days<-15)days=0;}unpaidList.push({index:idx,name:s.name,seatType:s.seatType,seatNumber:s.seatNumber,amount:amt,phone:s.phone,parentPhone:s.parentPhone,daysOverdue:days,lockerNumber:s.lockerNumber});}
                if(!isNaN(pd)&&pd>=1&&pd<=31&&!st.includes('ë¯¸ë‚©')&&!st.includes('í‡´ì›')){let payDate=new Date(today.getFullYear(),today.getMonth(),pd);const diff=Math.floor((today-payDate)/86400000);if(diff>7)payDate=new Date(today.getFullYear(),today.getMonth()+1,pd);const daysLeft=Math.ceil((payDate-today)/86400000);if(daysLeft>=-3&&daysLeft<=3)pendingList.push({index:idx,name:s.name,seatType:s.seatType,seatNumber:s.seatNumber,amount:parseInt(s.paymentAmount)||0,phone:s.phone,parentPhone:s.parentPhone,daysLeft,paymentDate:payDate,lockerNumber:s.lockerNumber});}
            });
            unpaidList.sort((a,b)=>b.daysOverdue-a.daysOverdue);pendingList.sort((a,b)=>a.daysLeft-b.daysLeft);

            const us=document.getElementById('unpaid-section'),ul=document.getElementById('unpaid-list'),uc=document.getElementById('unpaid-count'),utb=document.getElementById('unpaid-total-bar'),uta=document.getElementById('unpaid-total-amount'),bub=document.getElementById('bulk-unpaid-btn');
            if(unpaidList.length){us.style.display='block';uc.textContent=`${unpaidList.length}ëª…`;utb.style.display='flex';uta.textContent=`â‚©${unpaidTotal.toLocaleString()}`;bub.style.display='flex';window.currentUnpaidStudents=unpaidList;
                ul.innerHTML=unpaidList.map((s,i)=>{let ub=s.daysOverdue>0?`<span class="badge urgency">${s.daysOverdue}ì¼ ì§€ë‚¨</span>`:'';const lb=s.lockerNumber?`<span class="badge locker">ğŸ” ${s.lockerNumber}</span>`:'';return`<div class="payment-item unpaid" onclick="selectStudent(${s.index})"><div class="info"><div class="name-row"><span class="name">${s.name}</span>${ub}${lb}</div><span class="detail">${s.seatType} ${s.seatNumber}ë²ˆ Â· ${s.parentPhone||s.phone||'ì—°ë½ì²˜ ì—†ìŒ'}</span></div><div class="right-side"><span class="amount">${s.amount?'â‚©'+s.amount.toLocaleString():'-'}</span><button class="copy-msg-btn" onclick="event.stopPropagation();copyUnpaidMessage(${i})">ğŸ“‹</button></div></div>`;}).join('');
            }else us.style.display='none';

            const ps=document.getElementById('pending-section'),pl=document.getElementById('pending-list'),pc=document.getElementById('pending-count'),bpb=document.getElementById('bulk-pending-btn');
            if(pendingList.length){ps.style.display='block';pc.textContent=`${pendingList.length}ëª…`;bpb.style.display='flex';window.currentPendingStudents=pendingList;
                pl.innerHTML=pendingList.map((s,i)=>{let ub='';if(s.daysLeft<0)ub=`<span class="badge urgency">${Math.abs(s.daysLeft)}ì¼ ì§€ë‚¨</span>`;else if(s.daysLeft===0)ub='<span class="badge urgency warning">ì˜¤ëŠ˜!</span>';else ub=`<span class="badge urgency soon">D-${s.daysLeft}</span>`;const lb=s.lockerNumber?`<span class="badge locker">ğŸ” ${s.lockerNumber}</span>`:'';return`<div class="payment-item pending" onclick="selectStudent(${s.index})"><div class="info"><div class="name-row"><span class="name">${s.name}</span>${ub}${lb}</div><span class="detail">${s.seatType} ${s.seatNumber}ë²ˆ Â· ${s.parentPhone||s.phone||'ì—°ë½ì²˜ ì—†ìŒ'}</span></div><div class="right-side"><span class="amount">${s.amount?'â‚©'+s.amount.toLocaleString():'-'}</span><button class="copy-msg-btn" onclick="event.stopPropagation();copyPendingMessage(${i})">ğŸ“‹</button></div></div>`;}).join('');
            }else ps.style.display='none';
        }

        function switchSection(s){document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active'));document.querySelectorAll('.section').forEach(sec=>sec.classList.remove('active'));event.target.classList.add('active');document.getElementById(`section-${s}`).classList.add('active');if(s==='stats')updateStats();if(s==='history')renderHistory();if(s==='auto')renderAutoStudentList();}
        function selectFloor(f){currentFloor=f;selectedStudent=null;selectedPeriod=null;selectedSeatFilter='ì „ì²´';document.querySelectorAll('#section-calculator .floor-tab').forEach(t=>t.classList.remove('active'));document.querySelector(`#section-calculator .floor-tab.floor-${f}`).classList.add('active');document.getElementById('calculation-card').style.display='none';renderSeatFilter();renderStudentList();updateSummary();}

        // ===== ìë™ ê²°ì œ íƒ­ ê¸°ëŠ¥ =====
        let autoFloor=8,autoMonth=1,autoSelectedStudent=null;
        
        function selectAutoFloor(f){
            autoFloor=f;autoSelectedStudent=null;
            document.querySelectorAll('#section-auto .floor-tab').forEach(t=>t.classList.remove('active'));
            document.querySelector(`#section-auto .floor-tab.floor-${f}`).classList.add('active');
            document.getElementById('auto-message-card').style.display='none';
            renderAutoStudentList();
        }
        
        function selectAutoMonth(m){
            autoMonth=m; // 0=í˜„ì¬ì›”, 1=ë‹¤ìŒì›”, 2=ë‹¤ë‹¤ìŒì›”
            document.querySelectorAll('.auto-month-btn').forEach((b,idx)=>b.classList.toggle('active',idx===m));
            if(autoSelectedStudent)generateAutoMessage(autoSelectedStudent);
        }
        
        function renderAutoStudentList(){
            const container=document.getElementById('auto-student-list');
            const list=students[autoFloor]||[];
            document.getElementById('auto-floor8-count').textContent=`${students[8]?.length||0}ëª…`;
            document.getElementById('auto-floor7-count').textContent=`${students[7]?.length||0}ëª…`;
            if(!list.length){container.innerHTML='<div class="empty-state"><div class="icon">ğŸ“‹</div><p>ë™ê¸°í™”ëœ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤<br>ë¨¼ì € ë™ê¸°í™”ë¥¼ í•´ì£¼ì„¸ìš”</p></div>';return;}
            container.innerHTML=list.map((s,idx)=>{
                const amt=s.paymentAmount?Number(s.paymentAmount).toLocaleString()+'ì›':'-';
                const seatType=normalizeSeatType(s.seatType);
                const locker=s.lockerNumber?`ğŸ” ${s.lockerNumber}`:'';
                const status=s.paymentStatus||'';
                let statusBadge='';
                if(status.includes('ë¯¸ë‚©'))statusBadge='<span class="badge urgency">ë¯¸ë‚©</span>';
                else if(status.includes('ì™„ë‚©')||status.includes('ì¹´ë“œ')||status.includes('í˜„ê¸ˆ'))statusBadge='<span class="badge" style="background:var(--success-light);color:var(--success);">ì™„ë‚©</span>';
                return`<div class="auto-student-item ${autoSelectedStudent?.name===s.name?'selected':''}" onclick="selectAutoStudent(${idx})">
                    <div class="top-row"><span class="name">${s.name} ${statusBadge}</span><span class="amount">${amt}</span></div>
                    <div class="details">${autoFloor}ì¸µ ${seatType} ${s.seatNumber}ë²ˆ ${locker}</div>
                </div>`;
            }).join('');
        }
        
        function selectAutoStudent(idx){
            autoSelectedStudent=students[autoFloor][idx];
            autoSelectedStudent._floor=autoFloor;
            autoSelectedStudent._index=idx;
            renderAutoStudentList();
            generateAutoMessage(autoSelectedStudent);
            document.getElementById('auto-message-card').style.display='block';
            document.getElementById('auto-message-card').scrollIntoView({behavior:'smooth',block:'center'});
        }
        
        function generateAutoMessage(s){
            const seatType=normalizeSeatType(s.seatType);
            const ticketType=seatType==='í”„ë¦¬ë¯¸ì—„'?'ì¢…ì¼ê¶Œ':'ì¢…ì¼ê¶Œ';
            const dailyRate=dailyRates['ì¢…ì¼ê¶Œ'][seatType]||0;
            const monthlyPrice=dailyRate*30;
            const monthNames=['1ì›”','2ì›”','3ì›”','4ì›”','5ì›”','6ì›”','7ì›”','8ì›”','9ì›”','10ì›”','11ì›”','12ì›”'];
            const today=new Date();
            const targetMonth=(today.getMonth()+autoMonth)%12; // autoMonth: 0=í˜„ì¬ì›”, 1=ë‹¤ìŒì›”, 2=ë‹¤ë‹¤ìŒì›”
            const targetYear=today.getMonth()+autoMonth>11?today.getFullYear()+1:today.getFullYear();
            const lastDay=new Date(targetYear,targetMonth+1,0).getDate();
            const startMonthName=monthNames[targetMonth];
            const hasLocker=s.lockerNumber&&s.lockerNumber.toString().trim()!=='';
            
            let periodText=`${startMonthName}1ì¼~ ${startMonthName}${lastDay}ì¼ ê²°ì œê¸ˆì•¡ì…ë‹ˆë‹¤.`;
            let priceInfo=`1ê°œì›” ${monthlyPrice.toLocaleString()}ì›`;
            let seatPrice=monthlyPrice;
            let optionsText='';
            
            if(hasLocker){
                optionsText+=`\nì‚¬ë¬¼í•¨ 1ê°œì›” = ${LOCKER_FEE.toLocaleString()}ì›`;
            }
            
            const total=seatPrice+(hasLocker?LOCKER_FEE:0);
            
            const msg=`ì•ˆë…•í•˜ì„¸ìš”:)
ê¹€ì—„ë§ˆ ê´€ë¦¬í˜•ë…ì„œì‹¤ ì†¡ë„ì  ì…ë‹ˆë‹¤.

â–  ê²°ì œê¸ˆì•¡
${s.name}í•™ìƒì€ ${autoFloor}ì¸µ ${seatType} ${ticketType}
${periodText}
${priceInfo}${optionsText}
ì´ ${total.toLocaleString()}ì›

â– ë“±ë¡ë°©ë²•

1.ì˜¨ë¼ì¸ê²°ì œ - ë‚©ë¶€í•˜ëŸ¬ ê°€ê¸° í´ë¦­

2.ê³„ì¢Œì´ì²´ 469901 04 155186
[êµ­ë¯¼ì€í–‰ ìˆ˜ë¦¬ë”© êµìœ¡]
[í˜„ê¸ˆì˜ìˆ˜ì¦ ë°œê¸‰ë²ˆí˜¸ ë©”ì„¸ì§€ì£¼ì„¸ìš”.]

3.í˜„ì¥ê²°ì œ -ì§ì ‘ë°©ë¬¸`;
            
            document.getElementById('auto-message-preview').textContent=msg;
            window.autoMessageText=msg;
        }
        
        function copyAutoMessage(){
            if(!window.autoMessageText)return;
            navigator.clipboard.writeText(window.autoMessageText);
            showToast(`${autoSelectedStudent.name} ë©”ì‹œì§€ ë³µì‚¬ë¨`,'success');
        }

        function renderSeatFilter(){document.getElementById('seat-filter').innerHTML=seatTypes[currentFloor].map(t=>`<button class="seat-filter-btn ${selectedSeatFilter===t?'active':''}" onclick="filterBySeatType('${t}')">${t}</button>`).join('');}
        function filterBySeatType(t){selectedSeatFilter=t;renderSeatFilter();renderStudentList();}
        function filterStudents(){renderStudentList();}

        function renderStudentList(){
            const container=document.getElementById('student-list'),search=document.getElementById('student-search').value.toLowerCase();
            let filtered=(students[currentFloor]||[]).filter((s,i)=>{s._index=i;const nt=normalizeSeatType(s.seatType);return s.name.toLowerCase().includes(search)&&(selectedSeatFilter==='ì „ì²´'||nt===selectedSeatFilter||s.seatType===selectedSeatFilter);});
            if(!filtered.length){container.innerHTML='<div class="empty-state"><div class="icon">ğŸ”</div><p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</p></div>';return;}
            container.innerHTML=filtered.map(s=>{
                const dt=normalizeSeatType(s.seatType),st=(s.paymentStatus||'').toLowerCase();let pb='';if(st.includes('ë¯¸ë‚©'))pb='<span class="payment-badge unpaid">ë¯¸ë‚©</span>';else if(st.includes('í‡´ì›'))pb='<span class="payment-badge retired">í‡´ì›</span>';else if(st.includes('ì¹´ë“œ'))pb='<span class="payment-badge paid">ì¹´ë“œ</span>';else if(st.includes('í˜„ê¸ˆ'))pb='<span class="payment-badge paid">í˜„ê¸ˆ</span>';else if(st.includes('ì™„ë‚©'))pb='<span class="payment-badge paid">ì™„ë‚©</span>';
                const at=s.paymentAmount&&Number(s.paymentAmount)>0?`ğŸ’° ${Number(s.paymentAmount).toLocaleString()}ì›`:'',mt=s.memo?`ğŸ“ ${s.memo}`:'',lt=s.lockerNumber?`ğŸ” ${s.lockerNumber}`:'';
                return`<div class="student-item ${selectedStudent?.name===s.name?'selected':''}" onclick="selectStudent(${s._index})"><div class="student-info"><span class="student-name">${s.name} ${pb}</span><span class="student-detail">${s.seatNumber?s.seatNumber+'ë²ˆ ì¢Œì„':'ì¢Œì„ ë¯¸ì •'}</span>${at||lt?`<span class="student-sheet-info">${at} ${lt}</span>`:''}${mt?`<span class="student-memo">${mt}</span>`:''}</div><div style="display:flex;align-items:center;"><span class="seat-badge ${dt}">${dt||'ë¯¸ì •'}</span><div class="student-actions" onclick="event.stopPropagation()"><button class="student-action-btn edit" onclick="openEditModal(${s._index})">âœï¸</button><button class="student-action-btn delete" onclick="openDeleteModal(${s._index},'${s.name}')">ğŸ—‘ï¸</button></div></div></div>`;
            }).join('');
        }

        function selectStudent(idx){
            selectedStudent=students[currentFloor][idx];selectedStudent._floor=currentFloor;selectedPeriod=null;selectedDiscount=0;addToRecent(selectedStudent.name,currentFloor);
            const st=selectedStudent.paymentStatus||'',amt=selectedStudent.paymentAmount,memo=selectedStudent.memo||'',locker=selectedStudent.lockerNumber||'';
            let sheetInfo=`<div class="sheet-info"><div>ğŸ“Š ìŠ¤í”„ë ˆë“œì‹œíŠ¸: ${amt&&Number(amt)>0?Number(amt).toLocaleString()+'ì›':'ì—†ìŒ'} (${st||'ì—†ìŒ'})</div>${locker?`<div>ğŸ” ì‚¬ë¬¼í•¨: ${locker}ë²ˆ</div>`:''}${memo?`<div style="color:var(--floor-7);">ğŸ“ ${memo}</div>`:''}</div>`;
            document.getElementById('calculation-card').style.display='block';
            document.getElementById('selected-student-info').innerHTML=`<div class="name">${selectedStudent.name} (${currentFloor}ì¸µ)</div><div class="details"><div>ğŸ“ ${selectedStudent.seatType||'ë¯¸ì •'} ${selectedStudent.seatNumber?selectedStudent.seatNumber+'ë²ˆ':''}</div><div>ğŸ“± ${selectedStudent.parentPhone||selectedStudent.phone||'ë¯¸ë“±ë¡'}</div></div>${sheetInfo}`;
            document.querySelectorAll('.period-btn').forEach(b=>b.classList.remove('selected'));document.getElementById('start-day').value='1';document.getElementById('opt-locker').checked=false;document.getElementById('opt-register').checked=false;selectedTicketType='ì¢…ì¼ê¶Œ';selectedAllcare=0;selectedCalcType='daily';
            document.querySelectorAll('.ticket-btn').forEach(b=>b.classList.toggle('active',b.dataset.ticket==='ì¢…ì¼ê¶Œ'));document.querySelectorAll('.calc-type-btn').forEach(b=>b.classList.toggle('active',b.dataset.calc==='daily'));document.getElementById('allcare-select').value='0';document.getElementById('start-day-group').style.display='block';selectDiscount(0);
            document.getElementById('total-price').textContent='â‚©0';document.getElementById('price-breakdown').innerHTML='';document.getElementById('copy-btn').disabled=true;document.getElementById('kakao-btn').disabled=true;document.getElementById('save-btn').disabled=true;
            renderStudentList();document.getElementById('calculation-card').scrollIntoView({behavior:'smooth',block:'center'});
        }

        function addToRecent(name,floor){const key=`${floor}-${name}`;recentStudents=recentStudents.filter(r=>`${r.floor}-${r.name}`!==key);recentStudents.unshift({name,floor});if(recentStudents.length>5)recentStudents.pop();saveData();renderRecentStudents();}
        function renderRecentStudents(){const c=document.getElementById('recent-students');if(!recentStudents.length){c.style.display='none';return;}c.style.display='flex';c.innerHTML=recentStudents.map(r=>`<div class="recent-student-chip" onclick="selectRecentStudent('${r.name}',${r.floor})">${r.name} (${r.floor}ì¸µ)</div>`).join('');}
        function selectRecentStudent(name,floor){if(currentFloor!==floor)selectFloor(floor);const idx=students[floor].findIndex(s=>s.name===name);if(idx>=0)selectStudent(idx);}

        function selectPeriod(m){if(!selectedStudent)return;selectedPeriod=m;document.querySelectorAll('.period-btn').forEach(b=>b.classList.toggle('selected',b.dataset.period==m));calculatePrice();}
        function selectCalcType(t){selectedCalcType=t;document.querySelectorAll('.calc-type-btn').forEach(b=>b.classList.toggle('active',b.dataset.calc===t));document.getElementById('start-day-group').style.display=t==='daily'?'block':'none';if(t==='monthly')document.getElementById('start-day').value='1';calculatePrice();}
        function selectTicketType(t){selectedTicketType=t;document.querySelectorAll('.ticket-btn').forEach(b=>b.classList.toggle('active',b.dataset.ticket===t));calculatePrice();}
        function selectAllcare(v){selectedAllcare=parseInt(v);calculatePrice();}
        function toggleOption(t){const cb=document.getElementById(`opt-${t}`);cb.checked=!cb.checked;cb.closest('.option-item')?.classList.toggle('active',cb.checked);calculatePrice();}
        function selectDiscount(r){selectedDiscount=r;document.querySelectorAll('.discount-btn').forEach(b=>{b.classList.toggle('active',b.dataset.discount==r);b.classList.toggle('warning',b.dataset.discount==r&&r>0);});calculatePrice();}

        function calculatePrice(){
            if(!selectedStudent||!selectedPeriod)return;
            const startDay=parseInt(document.getElementById('start-day').value),hasLocker=document.getElementById('opt-locker').checked,hasRegister=document.getElementById('opt-register').checked,seatType=normalizeSeatType(selectedStudent.seatType);
            const today=new Date(),startMonth=today.getMonth(),startYear=today.getFullYear(),lastDay=new Date(startYear,startMonth+1,0).getDate();
            const ticketType=seatType==='í”„ë¦¬ë¯¸ì—„'?'ì¢…ì¼ê¶Œ':selectedTicketType,dailyRate=dailyRates[ticketType][seatType]||0,monthlyPrice=dailyRate*30;
            let totalSeat=0,detail='';
            if(selectedCalcType==='monthly'){totalSeat=monthlyPrice*selectedPeriod;detail=`${selectedPeriod}ê°œì›”`;}
            else{const remain=lastDay-startDay+1;if(startDay===1){totalSeat=monthlyPrice*selectedPeriod;detail=`${selectedPeriod}ê°œì›”`;}else{const first=dailyRate*remain;if(selectedPeriod===1){totalSeat=first;detail=`${remain}ì¼`;}else if(selectedPeriod===2){totalSeat=first+monthlyPrice;detail=`${remain}ì¼ + 1ê°œì›”`;}else{totalSeat=first+(monthlyPrice*2);detail=`${remain}ì¼ + 2ê°œì›”`;}}}
            const discAmt=Math.round(totalSeat*selectedDiscount/100),discSeat=totalSeat-discAmt,lockerFee=hasLocker?LOCKER_FEE*selectedPeriod:0,allcareFee=selectedAllcare*selectedPeriod,registerFee=hasRegister?REGISTER_FEE:0,total=discSeat+lockerFee+allcareFee+registerFee;
            document.getElementById('total-price').textContent=`â‚©${total.toLocaleString()}`;
            let bd=`<div class="price-breakdown-item"><span>${ticketType} ${seatType} (${detail})</span><span>${totalSeat.toLocaleString()}ì›</span></div>`;
            bd+=`<div class="price-breakdown-item" style="font-size:0.8rem;opacity:0.7;"><span>${selectedCalcType==='daily'?'ì¼ë‹¹':'ì›”'} ${(selectedCalcType==='daily'?dailyRate:monthlyPrice).toLocaleString()}ì›</span><span></span></div>`;
            if(selectedDiscount>0)bd+=`<div class="price-breakdown-item discount"><span>ğŸ·ï¸ í• ì¸ (${selectedDiscount}%)</span><span>-${discAmt.toLocaleString()}ì›</span></div>`;
            if(selectedAllcare>0)bd+=`<div class="price-breakdown-item add"><span>ğŸ¥ ì˜¬ì¼€ì–´ ${(selectedAllcare/10000).toFixed(0)}ë§Œì› (${selectedPeriod}ê°œì›”)</span><span>+${allcareFee.toLocaleString()}ì›</span></div>`;
            if(hasLocker)bd+=`<div class="price-breakdown-item add"><span>ğŸ” ì‚¬ë¬¼í•¨ (${selectedPeriod}ê°œì›”)</span><span>+${lockerFee.toLocaleString()}ì›</span></div>`;
            if(hasRegister)bd+=`<div class="price-breakdown-item add"><span>ğŸ†• ìµœì´ˆê°€ì…ë¹„</span><span>+${registerFee.toLocaleString()}ì›</span></div>`;
            bd+=`<div class="price-breakdown-item total"><span>ì´ ê²°ì œê¸ˆì•¡</span><span>${total.toLocaleString()}ì›</span></div>`;
            document.getElementById('price-breakdown').innerHTML=bd;document.getElementById('copy-btn').disabled=false;document.getElementById('kakao-btn').disabled=false;document.getElementById('save-btn').disabled=false;
        }

        function getTotalPrice(){
            if(!selectedStudent||!selectedPeriod)return 0;
            const startDay=parseInt(document.getElementById('start-day').value),hasLocker=document.getElementById('opt-locker').checked,hasRegister=document.getElementById('opt-register').checked,seatType=normalizeSeatType(selectedStudent.seatType);
            const today=new Date(),lastDay=new Date(today.getFullYear(),today.getMonth()+1,0).getDate(),remain=lastDay-startDay+1;
            const ticketType=seatType==='í”„ë¦¬ë¯¸ì—„'?'ì¢…ì¼ê¶Œ':selectedTicketType,dailyRate=dailyRates[ticketType][seatType]||0,monthlyPrice=dailyRate*30;
            let totalSeat=0;
            if(selectedCalcType==='monthly')totalSeat=monthlyPrice*selectedPeriod;
            else{if(startDay===1)totalSeat=monthlyPrice*selectedPeriod;else{const first=dailyRate*remain;totalSeat=selectedPeriod===1?first:selectedPeriod===2?first+monthlyPrice:first+(monthlyPrice*2);}}
            return(totalSeat-Math.round(totalSeat*selectedDiscount/100))+(hasLocker?LOCKER_FEE*selectedPeriod:0)+(selectedAllcare*selectedPeriod)+(hasRegister?REGISTER_FEE:0);
        }

        function copyPrice(){
            if(!selectedStudent||!selectedPeriod)return;
            const total=getTotalPrice(),startDay=parseInt(document.getElementById('start-day').value),hasLocker=document.getElementById('opt-locker').checked,hasRegister=document.getElementById('opt-register').checked,seatType=normalizeSeatType(selectedStudent.seatType);
            const today=new Date(),startMonth=today.getMonth(),startYear=today.getFullYear(),lastDay=new Date(startYear,startMonth+1,0).getDate();
            const ticketType=seatType==='í”„ë¦¬ë¯¸ì—„'?'ì¢…ì¼ê¶Œ':selectedTicketType,dailyRate=dailyRates[ticketType][seatType]||0,monthlyPrice=dailyRate*30;
            const monthNames=['1ì›”','2ì›”','3ì›”','4ì›”','5ì›”','6ì›”','7ì›”','8ì›”','9ì›”','10ì›”','11ì›”','12ì›”'];
            let periodText='',priceInfo='',seatPrice=0;
            if(selectedCalcType==='monthly'){
                const calcStartMonth=(startMonth+1)%12,calcStartYear=startMonth===11?startYear+1:startYear;
                const endDate=new Date(calcStartYear,calcStartMonth+selectedPeriod,0),endLastDay=endDate.getDate();
                periodText=`${monthNames[calcStartMonth]}1ì¼~ ${monthNames[endDate.getMonth()]}${endLastDay}ì¼ ê²°ì œê¸ˆì•¡ì…ë‹ˆë‹¤.`;
                seatPrice=monthlyPrice*selectedPeriod;priceInfo=`1ê°œì›” ${monthlyPrice.toLocaleString()}ì›\nì´ìš©ê¸°ê°„ ${selectedPeriod}ê°œì›”`;
            }else{
                const remain=lastDay-startDay+1,startMonthName=monthNames[startMonth];
                if(startDay===1&&selectedPeriod>=1){
                    const endDate=new Date(startYear,startMonth+selectedPeriod,0),endLastDay=endDate.getDate();
                    periodText=`${startMonthName}1ì¼~ ${monthNames[endDate.getMonth()]}${endLastDay}ì¼ ê²°ì œê¸ˆì•¡ì…ë‹ˆë‹¤.`;
                    seatPrice=monthlyPrice*selectedPeriod;priceInfo=`1ê°œì›” ${monthlyPrice.toLocaleString()}ì›\nì´ìš©ê¸°ê°„ ${selectedPeriod}ê°œì›”`;
                }else if(selectedPeriod===1){
                    periodText=`${startMonthName}${startDay}ì¼~ ${startMonthName}${lastDay}ì¼ ê²°ì œê¸ˆì•¡ì…ë‹ˆë‹¤.`;
                    seatPrice=dailyRate*remain;priceInfo=`1ì¼ ì´ìš©ë£Œ ${dailyRate.toLocaleString()}ì›\nì´ìš©ê¸°ê°„ ${remain}ì¼`;
                }else{
                    const addMonths=selectedPeriod-1,endDate=new Date(startYear,startMonth+selectedPeriod,0),endLastDay=endDate.getDate();
                    periodText=`${startMonthName}${startDay}ì¼~ ${monthNames[endDate.getMonth()]}${endLastDay}ì¼ ê²°ì œê¸ˆì•¡ì…ë‹ˆë‹¤.`;
                    seatPrice=(dailyRate*remain)+(monthlyPrice*addMonths);priceInfo=`1ì¼ ì´ìš©ë£Œ ${dailyRate.toLocaleString()}ì›\nì´ìš©ê¸°ê°„ ${remain}ì¼ + ${addMonths}ê°œì›”`;
                }
            }
            let optionsText='';
            if(selectedAllcare>0){const fee=selectedAllcare*selectedPeriod;optionsText+=`\nì˜¬ì¼€ì–´ ${(selectedAllcare/10000).toFixed(0)}ë§Œì› x ${selectedPeriod}ê°œì›” = ${fee.toLocaleString()}ì›`;}
            if(hasLocker){const fee=LOCKER_FEE*selectedPeriod;optionsText+=`\nì‚¬ë¬¼í•¨ ${selectedPeriod}ê°œì›” = ${fee.toLocaleString()}ì›`;}
            if(hasRegister)optionsText+=`\nìµœì´ˆê°€ì…ë¹„ = ${REGISTER_FEE.toLocaleString()}ì›`;
            if(selectedDiscount>0){const disc=Math.round(seatPrice*selectedDiscount/100);optionsText+=`\ní• ì¸ ${selectedDiscount}% = -${disc.toLocaleString()}ì›`;}
            const msg=`ì•ˆë…•í•˜ì„¸ìš”:)\nê¹€ì—„ë§ˆ ê´€ë¦¬í˜•ë…ì„œì‹¤ ì†¡ë„ì  ì…ë‹ˆë‹¤.\n\nâ–  ê²°ì œê¸ˆì•¡\n${selectedStudent.name}í•™ìƒì€ ${currentFloor}ì¸µ ${seatType} ${ticketType}\n${periodText}\n${priceInfo}${optionsText}\nì´ ${total.toLocaleString()}ì›\n\nâ– ë“±ë¡ë°©ë²•\n\n1.ì˜¨ë¼ì¸ê²°ì œ - ë‚©ë¶€í•˜ëŸ¬ ê°€ê¸° í´ë¦­\n\n2.ê³„ì¢Œì´ì²´ 469901 04 155186\n[êµ­ë¯¼ì€í–‰ ìˆ˜ë¦¬ë”© êµìœ¡]\n[í˜„ê¸ˆì˜ìˆ˜ì¦ ë°œê¸‰ë²ˆí˜¸ ë©”ì„¸ì§€ì£¼ì„¸ìš”.]\n\n3.í˜„ì¥ê²°ì œ -ì§ì ‘ë°©ë¬¸`;
            navigator.clipboard.writeText(msg);showToast('ê¸ˆì•¡ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤','success');
        }
        function copyKakaoMessage(){copyPrice();}

        function copyUnpaidMessage(i){const s=window.currentUnpaidStudents[i];if(!s)return;const msg=`ì•ˆë…•í•˜ì„¸ìš”:)\nê¹€ì—„ë§ˆ ê´€ë¦¬í˜•ë…ì„œì‹¤ ì†¡ë„ì  ì…ë‹ˆë‹¤.\n\n${s.name} í•™ìƒ ì´ìš©ë£Œ ê²°ì œ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.\n\nâ–  ê²°ì œ ì •ë³´\nâ€¢ ì¸µ: ${currentFloor}ì¸µ\nâ€¢ ì¢Œì„: ${s.seatType} ${s.seatNumber}ë²ˆ\nâ€¢ ê²°ì œê¸ˆì•¡: ${s.amount?s.amount.toLocaleString()+'ì›':'(ê¸ˆì•¡ í™•ì¸ í•„ìš”)'}\n\nâ–  ë“±ë¡ë°©ë²•\n\n1.ì˜¨ë¼ì¸ê²°ì œ - ë‚©ë¶€í•˜ëŸ¬ ê°€ê¸° í´ë¦­\n\n2.ê³„ì¢Œì´ì²´ 469901 04 155186\n[êµ­ë¯¼ì€í–‰ ìˆ˜ë¦¬ë”© êµìœ¡]\n\n3.í˜„ì¥ê²°ì œ - ì§ì ‘ë°©ë¬¸\n\nê°ì‚¬í•©ë‹ˆë‹¤ ğŸ™`;navigator.clipboard.writeText(msg);showToast(`${s.name} ë©”ì‹œì§€ ë³µì‚¬ë¨`,'success');}
        function copyAllUnpaidMessage(){const list=window.currentUnpaidStudents||[];if(!list.length)return;const today=new Date();let msg=`ğŸ“‹ ${currentFloor}ì¸µ ë¯¸ë‚©ì í˜„í™© (${today.getFullYear()}ë…„ ${today.getMonth()+1}ì›” ${today.getDate()}ì¼)\nì´ ${list.length}ëª…\n\n`;list.forEach((s,i)=>{msg+=`${i+1}. ${s.name} (${s.seatType} ${s.seatNumber}ë²ˆ)\n   ğŸ’° ${s.amount?s.amount.toLocaleString()+'ì›':'-'}\n   ğŸ“± ${s.parentPhone||s.phone||'ì—°ë½ì²˜ ì—†ìŒ'}\n\n`;});navigator.clipboard.writeText(msg);showToast(`${list.length}ëª… ë¯¸ë‚©ì ëª…ë‹¨ ë³µì‚¬ë¨`,'success');}
        function copyPendingMessage(i){const s=window.currentPendingStudents[i];if(!s)return;const dateStr=`${s.paymentDate.getMonth()+1}ì›” ${s.paymentDate.getDate()}ì¼`;const msg=`ì•ˆë…•í•˜ì„¸ìš”:)\nê¹€ì—„ë§ˆ ê´€ë¦¬í˜•ë…ì„œì‹¤ ì†¡ë„ì  ì…ë‹ˆë‹¤.\n\n${s.name} í•™ìƒ ì´ìš©ë£Œ ê²°ì œ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.\n\nâ–  ê²°ì œ ì˜ˆì •ì¼: ${dateStr}\n\nâ–  ê²°ì œ ì •ë³´\nâ€¢ ì¸µ: ${currentFloor}ì¸µ\nâ€¢ ì¢Œì„: ${s.seatType} ${s.seatNumber}ë²ˆ\nâ€¢ ê²°ì œê¸ˆì•¡: ${s.amount?s.amount.toLocaleString()+'ì›':'(ê¸ˆì•¡ í™•ì¸ í•„ìš”)'}\n\nâ–  ë“±ë¡ë°©ë²•\n\n1.ì˜¨ë¼ì¸ê²°ì œ - ë‚©ë¶€í•˜ëŸ¬ ê°€ê¸° í´ë¦­\n\n2.ê³„ì¢Œì´ì²´ 469901 04 155186\n[êµ­ë¯¼ì€í–‰ ìˆ˜ë¦¬ë”© êµìœ¡]\n\n3.í˜„ì¥ê²°ì œ - ì§ì ‘ë°©ë¬¸\n\nê°ì‚¬í•©ë‹ˆë‹¤ ğŸ™`;navigator.clipboard.writeText(msg);showToast(`${s.name} ë©”ì‹œì§€ ë³µì‚¬ë¨`,'success');}
        function copyAllPendingMessage(){const list=window.currentPendingStudents||[];if(!list.length)return;const today=new Date();let msg=`â° ${currentFloor}ì¸µ ê²°ì œ ì˜ˆì • (${today.getFullYear()}ë…„ ${today.getMonth()+1}ì›” ${today.getDate()}ì¼ ê¸°ì¤€)\nì´ ${list.length}ëª…\n\n`;list.forEach((s,i)=>{msg+=`${i+1}. ${s.name} (${s.seatType} ${s.seatNumber}ë²ˆ)\n   ğŸ“… ${s.paymentDate.getMonth()+1}/${s.paymentDate.getDate()}\n   ğŸ’° ${s.amount?s.amount.toLocaleString()+'ì›':'-'}\n   ğŸ“± ${s.parentPhone||s.phone||'ì—°ë½ì²˜ ì—†ìŒ'}\n\n`;});navigator.clipboard.writeText(msg);showToast(`${list.length}ëª… ê²°ì œ ì˜ˆì • ëª…ë‹¨ ë³µì‚¬ë¨`,'success');}

        function savePayment(){if(!selectedStudent||!selectedPeriod)return;const total=getTotalPrice(),hasLocker=document.getElementById('opt-locker').checked,hasRegister=document.getElementById('opt-register').checked,startDay=parseInt(document.getElementById('start-day').value),seatType=normalizeSeatType(selectedStudent.seatType),ticketType=seatType==='í”„ë¦¬ë¯¸ì—„'?'ì¢…ì¼ê¶Œ':selectedTicketType,today=new Date();
            const startDate=new Date(today.getFullYear(),today.getMonth(),selectedCalcType==='monthly'?1:startDay),endDate=new Date(startDate);endDate.setMonth(endDate.getMonth()+selectedPeriod);
            paymentHistory.unshift({id:Date.now(),name:selectedStudent.name,floor:currentFloor,seatType,seatNumber:selectedStudent.seatNumber,period:selectedPeriod,startDay:selectedCalcType==='monthly'?1:startDay,calcType:selectedCalcType,ticketType,amount:total,discount:selectedDiscount,locker:hasLocker,allcare:selectedAllcare,register:hasRegister,startDate:startDate.toISOString(),endDate:endDate.toISOString(),createdAt:today.toISOString()});
            saveData();showToast('ê²°ì œ ë‚´ì—­ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤','success');updateStats();}

        function updateStats(){const t8=students[8]?.length||0,t7=students[7]?.length||0;document.getElementById('stat-total').textContent=t8+t7;document.getElementById('stat-floor8').textContent=t8;document.getElementById('stat-floor7').textContent=t7;const now=new Date();document.getElementById('stat-payments').textContent=paymentHistory.filter(p=>{const d=new Date(p.createdAt);return d.getMonth()===now.getMonth()&&d.getFullYear()===now.getFullYear();}).length;renderSeatChart(8,'chart-floor8');renderSeatChart(7,'chart-floor7');}
        function renderSeatChart(floor,cid){const c=document.getElementById(cid),types=seatTypes[floor].filter(t=>t!=='ì „ì²´'),counts={};types.forEach(t=>counts[t]=0);(students[floor]||[]).forEach(s=>{const nt=normalizeSeatType(s.seatType);if(counts.hasOwnProperty(nt))counts[nt]++;else if(types.includes(s.seatType))counts[s.seatType]++;});const max=Math.max(...Object.values(counts),1);c.innerHTML=types.map(t=>`<div class="seat-chart-row"><span class="seat-chart-label">${t}</span><div class="seat-chart-bar-bg"><div class="seat-chart-bar ${t}" style="width:${(counts[t]||0)/max*100}%"></div></div><span class="seat-chart-count">${counts[t]||0}ëª…</span></div>`).join('');}

        function renderHistory(){const c=document.getElementById('history-list');if(!paymentHistory.length){c.innerHTML='<div class="empty-state"><div class="icon">ğŸ“‹</div><p>ê²°ì œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</p></div>';return;}c.innerHTML=paymentHistory.map((item,i)=>{const d=new Date(item.createdAt);let extras=[];if(item.ticketType)extras.push(item.ticketType);if(item.discount)extras.push(`${item.discount}%í• ì¸`);if(item.allcare&&item.allcare>0)extras.push(`ì˜¬ì¼€ì–´${(item.allcare/10000).toFixed(0)}ë§Œ`);if(item.locker)extras.push('ì‚¬ë¬¼í•¨');if(item.register)extras.push('ê°€ì…ë¹„');return`<div class="history-item"><div class="history-info"><h4>${item.name} (${item.floor}ì¸µ)</h4><p>${item.seatType} ${item.seatNumber}ë²ˆ Â· ${item.period}ê°œì›”${extras.length?' ('+extras.join(', ')+')':''}</p><p style="font-size:0.8rem;color:var(--gray-400);">${d.getMonth()+1}/${d.getDate()}</p></div><div style="display:flex;align-items:center;"><span class="history-amount">â‚©${item.amount.toLocaleString()}</span><button class="history-delete" onclick="deleteHistory(${i})">âœ•</button></div></div>`;}).join('');}
        function deleteHistory(i){paymentHistory.splice(i,1);saveData();renderHistory();updateStats();showToast('ë‚´ì—­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');}
        function exportHistory(){if(!paymentHistory.length){showToast('ë‚´ë³´ë‚¼ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤','error');return;}let csv='ì´ë¦„,ì¸µ,ì¢Œì„ìœ í˜•,ì¢Œì„ë²ˆí˜¸,ê¸°ê°„,ê¸ˆì•¡,ê²°ì œì¼\n';paymentHistory.forEach(item=>{const d=new Date(item.createdAt);csv+=`${item.name},${item.floor}ì¸µ,${item.seatType},${item.seatNumber},${item.period}ê°œì›”,${item.amount},${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}\n`;});const blob=new Blob(['\uFEFF'+csv],{type:'text/csv;charset=utf-8;'});const link=document.createElement('a');link.href=URL.createObjectURL(blob);link.download=`ê¹€ì—„ë§ˆë…ì„œì‹¤_ê²°ì œë‚´ì—­_${new Date().toISOString().slice(0,10)}.csv`;link.click();showToast('CSV íŒŒì¼ ë‹¤ìš´ë¡œë“œë¨','success');}

        function exportBackup(){const data={version:'v3',exportDate:new Date().toISOString(),students,paymentHistory,recentStudents};const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});const link=document.createElement('a');link.href=URL.createObjectURL(blob);link.download=`ê¹€ì—„ë§ˆë…ì„œì‹¤_ë°±ì—…_${new Date().toISOString().slice(0,10)}.json`;link.click();showToast('ë°±ì—… íŒŒì¼ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤','success');}
        function importBackup(event){const file=event.target.files[0];if(!file)return;const reader=new FileReader();reader.onload=function(e){try{const data=JSON.parse(e.target.result);if(!data.students||(!data.students[7]&&!data.students[8])){showToast('ì˜¬ë°”ë¥¸ ë°±ì—… íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤','error');return;}const cnt=(data.students[7]?.length||0)+(data.students[8]?.length||0);if(confirm(`ë°±ì—… ë°ì´í„°ë¥¼ ë³µì›í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâ€¢ í•™ìƒ ìˆ˜: ${cnt}ëª…\n\nâš ï¸ í˜„ì¬ ë°ì´í„°ê°€ ë®ì–´ì”Œì›Œì§‘ë‹ˆë‹¤!`)){students=data.students;paymentHistory=data.paymentHistory||[];recentStudents=data.recentStudents||[];saveData();updateCounts();renderStudentList();renderHistory();updateStats();renderRecentStudents();updateSummary();showToast(`ë³µì› ì™„ë£Œ! (í•™ìƒ ${cnt}ëª…)`,'success');}}catch(err){showToast('íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤','error');console.error(err);}};reader.readAsText(file);event.target.value='';}

        function renderPriceTable(){document.getElementById('price-table').innerHTML=`<div class="price-table-section"><div class="price-table-title">ğŸŒ ì¢…ì¼ê¶Œ (ë°©í•™) - ì¼ë‹¹ ìš”ê¸ˆ</div><div class="price-table-row"><span class="label">í”„ë¦¬ë¯¸ì—„/ì¹¸ë§‰ì´</span><span class="value">23,000ì›/ì¼ (ì›” 69ë§Œì›)</span></div><div class="price-table-row"><span class="label">ì˜¤í”ˆí˜•</span><span class="value">21,000ì›/ì¼ (ì›” 63ë§Œì›)</span></div><div class="price-table-row"><span class="label">ììœ ì„</span><span class="value">17,700ì›/ì¼ (ì›” 53.1ë§Œì›)</span></div></div><div class="price-table-section"><div class="price-table-title" style="color:var(--floor-7);">ğŸŒ™ ì˜¤í›„ê¶Œ (í•™ê¸°ì¤‘) - ì¼ë‹¹ ìš”ê¸ˆ</div><div class="price-table-row"><span class="label">í”„ë¦¬ë¯¸ì—„/ì¹¸ë§‰ì´</span><span class="value">18,500ì›/ì¼ (ì›” 55.5ë§Œì›)</span></div><div class="price-table-row"><span class="label">ì˜¤í”ˆí˜•</span><span class="value">16,400ì›/ì¼ (ì›” 49.2ë§Œì›)</span></div><div class="price-table-row"><span class="label">ììœ ì„</span><span class="value">13,000ì›/ì¼ (ì›” 39ë§Œì›)</span></div></div><div class="price-table-info"><strong>ğŸ“… ê³„ì‚° ë°©ì‹</strong><br>â€¢ 1ì¼ ì‹œì‘: ì›”ì •ì•¡ (ì¼ë‹¹ Ã— 30ì¼)<br>â€¢ ì¤‘ê°„ ë“±ì›: í•´ë‹¹ì›” ë‚¨ì€ ì¼ìˆ˜ Ã— ì¼ë‹¹<br><br><strong>â• ì¶”ê°€ ì˜µì…˜</strong><br>â€¢ ğŸ¥ ì˜¬ì¼€ì–´: 1ë§Œì›~20ë§Œì› (ì›”)<br>â€¢ ğŸ†• ìµœì´ˆê°€ì…ë¹„: 10ë§Œì› (1íšŒ)<br>â€¢ ğŸ” ì‚¬ë¬¼í•¨: 2ë§Œì›/ì›”<br>â€¢ ğŸ·ï¸ í• ì¸: 10% / 20%</div>`;}

        function openAddModal(){document.getElementById('modal-title').textContent='ì‹ ê·œ í•™ìƒ ì¶”ê°€';document.getElementById('edit-index').value='';document.getElementById('modal-name').value='';document.getElementById('modal-floor').value=currentFloor;document.getElementById('modal-seat-number').value='';document.getElementById('modal-student-phone').value='';document.getElementById('modal-parent-phone').value='';updateModalSeatTypes();document.getElementById('student-modal').classList.add('active');}
        function openEditModal(idx){const s=students[currentFloor][idx];document.getElementById('modal-title').textContent='í•™ìƒ ì •ë³´ ìˆ˜ì •';document.getElementById('edit-index').value=idx;document.getElementById('modal-name').value=s.name;document.getElementById('modal-floor').value=currentFloor;document.getElementById('modal-seat-number').value=s.seatNumber;document.getElementById('modal-student-phone').value=s.phone;document.getElementById('modal-parent-phone').value=s.parentPhone;updateModalSeatTypes();document.getElementById('modal-seat-type').value=s.seatType;document.getElementById('student-modal').classList.add('active');}
        function closeStudentModal(){document.getElementById('student-modal').classList.remove('active');}
        function updateModalSeatTypes(){const floor=parseInt(document.getElementById('modal-floor').value);document.getElementById('modal-seat-type').innerHTML=seatTypes[floor].filter(t=>t!=='ì „ì²´').map(t=>`<option value="${t}">${t}</option>`).join('');}
        function saveStudent(){const editIdx=document.getElementById('edit-index').value,name=document.getElementById('modal-name').value.trim(),floor=parseInt(document.getElementById('modal-floor').value),seatType=document.getElementById('modal-seat-type').value,seatNumber=document.getElementById('modal-seat-number').value.trim()||'',phone=document.getElementById('modal-student-phone').value.trim(),parentPhone=document.getElementById('modal-parent-phone').value.trim();if(!name){showToast('í•™ìƒ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”','error');return;}const data={name,phone,parentPhone,seatType,seatNumber,paymentDay:'',paymentAmount:'',paymentStatus:'',memo:'',lockerNumber:''};if(editIdx!==''){const existing=students[currentFloor][parseInt(editIdx)];students[currentFloor][parseInt(editIdx)]={...existing,...data};showToast('í•™ìƒ ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤','success');}else{if(!students[floor])students[floor]=[];students[floor].push(data);showToast(`${name} í•™ìƒì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤`,'success');}saveData();updateCounts();renderStudentList();updateStats();updateSummary();closeStudentModal();}
        function openDeleteModal(idx,name){deleteTarget={index:idx,floor:currentFloor};document.getElementById('delete-message').textContent=`"${name}" í•™ìƒì„ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;document.getElementById('delete-modal').classList.add('active');}
        function closeDeleteModal(){document.getElementById('delete-modal').classList.remove('active');deleteTarget=null;}
        function confirmDelete(){if(!deleteTarget)return;students[deleteTarget.floor].splice(deleteTarget.index,1);saveData();updateCounts();renderStudentList();updateStats();updateSummary();closeDeleteModal();showToast('í•™ìƒì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');}

        function toggleTheme(){const isDark=document.documentElement.getAttribute('data-theme')==='dark';document.documentElement.setAttribute('data-theme',isDark?'':'dark');localStorage.setItem('kimomma_theme',isDark?'':'dark');}
        function showToast(msg,type=''){const toast=document.getElementById('toast');toast.className='toast';if(type)toast.classList.add(type);document.getElementById('toast-message').textContent=msg;toast.classList.add('show');setTimeout(()=>toast.classList.remove('show'),2500);}
    </script>
</body>
</html>
